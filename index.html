<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CD0777 Royal Club - Pro Admin & Odds Update</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gold: { 100: '#FFF9C4', 300: '#FDD835', 400: '#FFD700', 500: '#FFC107', 600: '#FFB300', 700: '#FFA000', 800: '#C0A000', 900: '#3d2e07' },
                        dark: { 950: '#020617', 900: '#0f172a', 800: '#1e293b' }
                    },
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif'],
                        mono: ['Share Tech Mono', 'monospace'],
                        oswald: ['Oswald', 'sans-serif']
                    },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'shake-hard': 'shakeHard 0.4s ease-in-out',
                        'flip': 'flip 0.6s ease-in-out forwards',
                        'fade-in': 'fadeIn 0.8s ease-out forwards',
                        'float-up': 'floatUp 1.5s ease-out forwards',
                        'pulse-glow': 'pulseGlow 1.5s infinite',
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'flash-red': 'flashRed 0.5s ease-in-out',
                        'flash-green': 'flashGreen 0.5s ease-in-out',
                        'rocket-fly': 'rocketFly 2s ease-in-out infinite alternate'
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        shakeHard: { '0%, 100%': { transform: 'translateX(0)' }, '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-10px)' }, '20%, 40%, 60%, 80%': { transform: 'translateX(10px)' } },
                        flip: { '0%': { transform: 'rotateY(0)' }, '100%': { transform: 'rotateY(180deg)' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        floatUp: { '0%': { transform: 'translateY(0) scale(1)', opacity: '1' }, '100%': { transform: 'translateY(-50px) scale(1.2)', opacity: '0' } },
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 10px #FFD700' }, '50%': { boxShadow: '0 0 25px #FFD700' } },
                        slideUp: { '0%': { transform: 'translateY(50px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        flashRed: { '0%, 100%': { backgroundColor: 'transparent' }, '50%': { backgroundColor: 'rgba(239, 68, 68, 0.5)' } },
                        flashGreen: { '0%, 100%': { backgroundColor: 'transparent' }, '50%': { backgroundColor: 'rgba(34, 197, 94, 0.3)' } },
                        rocketFly: { '0%': { transform: 'translateY(0)' }, '100%': { transform: 'translateY(-20px)' } }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Oswald:wght@500&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        body { background-color: #020617; color: #fff; overflow: hidden; touch-action: manipulation; }
        .glass-panel { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.08); }
        .luxury-bg { background-image: radial-gradient(circle at center, #1e293b 0%, #020617 100%); }
        input, select, button { outline: none; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 0px; }
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%; background: #FFD700; cursor: pointer; margin-top: -10px; box-shadow: 0 0 10px #FFD700; border: 2px solid white; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px; }
        
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        
        .confetti-piece { position: absolute; width: 8px; height: 8px; background: #FFD700; animation: fall 3s linear forwards; pointer-events: none; z-index: 100; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        
        .btn-press:active { transform: scale(0.95); transition: transform 0.1s; }
        
        .slot-spin { animation: slotSpin 0.1s linear infinite; }
        @keyframes slotSpin { 0% { transform: translateY(-20px); filter: blur(5px); } 100% { transform: translateY(20px); filter: blur(5px); } }

        .coin-container { transform-style: preserve-3d; transition: transform 1s cubic-bezier(0.4, 2, 0.55, 0.44); }
        .coin-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .coin-front { background: radial-gradient(#FFD700, #B8860B); transform: rotateY(0deg); }
        .coin-back { background: radial-gradient(#C0C0C0, #808080); transform: rotateY(180deg); }
        
        .star-bg { background-image: radial-gradient(white 1px, transparent 1px); background-size: 50px 50px; opacity: 0.2; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.294.0",
                "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
            }
        }
    </script>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { User, Gamepad2, LogOut, Send, CheckCircle, XCircle, ChevronRight, ChevronLeft, Lock, Gem, Home, CreditCard, Wallet, ShieldCheck, Trophy, Instagram, Facebook, ExternalLink, Plus, Trash2, Smartphone, Zap, Check, Dices, RefreshCw, Menu, X, AlertTriangle, Settings, History, Globe, FileText, LifeBuoy, ArrowLeftRight, Bomb, ArrowUp, HelpCircle, Flame, Percent, DollarSign, Image as ImageIcon, KeyRound, Upload, Disc, Rocket, Coins, Grid3X3, Target, Crown, Banknote, Landmark, Wifi, ThumbsUp, ThumbsDown, Users, Ban, Edit3, LockKeyhole, LayoutDashboard, UserCheck } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, where, getDocs, orderBy, setDoc, getDoc, deleteDoc } from 'firebase/firestore';

        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDJ5B7MncMfyjwb0ZnZ8p3d0bsoQAFqZQY",
            authDomain: "cd0777-casino.firebaseapp.com",
            projectId: "cd0777-casino",
            storageBucket: "cd0777-casino.firebasestorage.app",
            messagingSenderId: "320546250152",
            appId: "1:320546250152:web:730f6e581267b9b315919d"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- CONSTANTS & TEXTS ---
        const TEXTS = {
            ar: {
                welcome: "مرحباً", login: "تسجيل الدخول", register: "إنشاء حساب",
                name: "الاسم الكامل", phone: "رقم الهاتف", user: "اسم المستخدم", pass: "كلمة المرور",
                home: "الرئيسية", casino: "كازينو", tasks: "المهام", wallet: "المحفظة",
                deposit: "شحن الحساب", withdraw: "سحب الارباح", offers: "العروض الخاصة",
                crash: "كراش (طيار)", slots: "سلوتس", keno: "كينو", limbo: "ليمبو", coinflip: "عملة",
                menu: "القائمة", settings: "الإعدادات", logout: "خروج",
                success: "عملية ناجحة", error: "حدث خطأ",
                you_get: "لقد ربحت", you_lose: "حظ أوفر",
                upload_proof: "رفع إثبات الدفع (سكرين شوت)", amount: "المبلغ", pay_method: "طريقة الدفع",
                inputs_err: "البيانات ناقصة", personal_info: "المعلومات الشخصية", no_tasks: "لا توجد مهام حالياً",
                cashout: "سحب", multiplier: "المضاعف", rolling: "جاري اللعب...",
                heads: "صورة", tails: "كتابة", target: "الهدف", next_round: "الجولة التالية",
                bet_placed: "تم الرهان", crashed: "تحطم", waiting: "انتظار...",
                history: "السجل", support: "الدعم الفني", lang: "اللغة", policy: "سياسة الخصوصية", terms: "الشروط والاحكام", confirm: "تأكيد",
                acc_num: "رقم الحساب / المحفظة", bank_name: "اسم البنك", proof_needed: "المرجو تحويل المبلغ ورفع الصورة", pending: "قيد المراجعة",
                recharge: "تعبئة الهاتف", network: "الشبكة", cnie: "رقم البطاقة الوطنية", rib: "رقم التعريف البنكي (RIB)",
                wallet_addr: "عنوان المحفظة (USDT/Crypto)", select_network: "اختر الشبكة",
                method_bank: "تحويل بنكي", method_cash: "كاش بلس / وافا", method_crypto: "عملات رقمية", method_recharge: "تعبئة رصيد",
                win_chance: "احتمال الفوز", odd: "المعامل (ODD)",
                pending_title: "تفعيل العضوية الملكية",
                step_1: "سجل في 1xBet بكود: CD0777",
                step_2: "ارسل الايدي للادمن في تيليجرام",
                wait_admin: "حسابك قيد المراجعة، يرجى الانتظار...",
                admin_dash: "لوحة التحكم"
            },
            en: {
                welcome: "Welcome", login: "Login", register: "Register",
                name: "Full Name", phone: "Phone", user: "Username", pass: "Password",
                home: "Home", casino: "Casino", tasks: "Tasks", wallet: "Wallet",
                deposit: "Deposit", withdraw: "Withdraw", offers: "Special Offers",
                crash: "Crash", slots: "Slots", keno: "Keno", limbo: "Limbo", coinflip: "CoinFlip",
                menu: "Menu", settings: "Settings", logout: "Logout",
                success: "Success", error: "Error",
                you_get: "YOU WIN", you_lose: "YOU LOSE",
                upload_proof: "Upload Proof", amount: "Amount", pay_method: "Payment Method",
                inputs_err: "Missing Inputs", personal_info: "Personal Info", no_tasks: "No Tasks",
                cashout: "CASHOUT", multiplier: "Multiplier", rolling: "Rolling...",
                heads: "Heads", tails: "Tails", target: "Target", next_round: "Next Round",
                bet_placed: "Bet Placed", crashed: "CRASHED", waiting: "Waiting...",
                history: "History", support: "Support", lang: "Language", policy: "Privacy Policy", terms: "Terms of Service", confirm: "Confirm",
                acc_num: "Account No.", bank_name: "Bank Name", proof_needed: "Transfer amount & upload proof", pending: "Pending",
                recharge: "Mobile Recharge", network: "Network", cnie: "National ID (CNIE)", rib: "RIB / Account Num",
                wallet_addr: "Wallet Address", select_network: "Select Network",
                method_bank: "Bank Transfer", method_cash: "Cash Plus", method_crypto: "Crypto", method_recharge: "Mobile Recharge",
                win_chance: "Win Chance", odd: "ODD",
                pending_title: "Royal Membership Activation",
                step_1: "Register 1xBet Code: CD0777",
                step_2: "Send ID to Admin on Telegram",
                wait_admin: "Account under review, please wait...",
                admin_dash: "Dashboard"
            }
        };

        // --- COMPONENTS ---
        const Button = ({ children, onClick, disabled, variant='gold', full, className='', icon: Icon }) => {
            const base = "relative font-bold py-3.5 px-6 rounded-xl transition-all flex items-center justify-center gap-2 btn-press disabled:opacity-50 disabled:grayscale select-none";
            const styles = {
                gold: 'bg-gradient-to-b from-[#FFD700] to-[#B8860B] text-black shadow-[0_4px_15px_rgba(255,215,0,0.3)] border border-[#FFD700]',
                green: 'bg-gradient-to-b from-emerald-500 to-emerald-700 text-white border border-emerald-500 shadow-[0_4px_15px_rgba(16,185,129,0.3)]',
                red: 'bg-gradient-to-b from-red-500 to-red-700 text-white border border-red-500 shadow-[0_4px_15px_rgba(239,68,68,0.3)]',
                dark: 'bg-dark-800 text-gold-500 border border-gold-500/30 hover:bg-dark-700'
            };
            return React.createElement('button', { type: "button", onClick, disabled, className: `${base} ${styles[variant]} ${full?'w-full':''} ${className}` }, 
                Icon && React.createElement(Icon, { size: 20 }),
                children
            );
        };

        const Input = (props) => React.createElement('div', { className: "relative group w-full" },
            props.icon && React.createElement(props.icon, { size: 18, className: "absolute top-1/2 -translate-y-1/2 right-4 text-gray-500 group-focus-within:text-gold-500 transition-colors" }),
            React.createElement('input', { ...props, className: `w-full bg-dark-900 border border-white/10 p-4 ${props.icon?'pr-12':''} rounded-xl text-white outline-none focus:border-gold-500 focus:shadow-[0_0_10px_rgba(255,215,0,0.2)] transition-all placeholder:text-gray-600 shadow-inner ${props.className}` })
        );

        // UPDATED: Odds Badge Component (Displays Multiplier/ODD instead of %)
        const OddsBadge = ({ value, label }) => {
             return React.createElement('div', { className: "absolute top-2 left-2 z-20 flex items-center gap-1.5 bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-full border border-gold-500/30 shadow-lg" },
                React.createElement(Target, { size: 12, className: "text-gold-500" }),
                React.createElement('div', { className: "flex flex-col leading-none" },
                    React.createElement('span', { className: "text-[8px] text-gray-400 font-bold uppercase" }, label || "ODD"),
                    React.createElement('span', { className: "text-[10px] font-mono font-bold text-white" }, value)
                )
             );
        };

        const triggerConfetti = () => {
            const colors = ['#FFD700', '#FFFFFF', '#FFA500'];
            for(let i=0; i<50; i++) {
                const el = document.createElement('div');
                el.className = 'confetti-piece';
                el.style.left = Math.random() * 100 + 'vw';
                el.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                el.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 3000);
            }
        };

        const convertToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        };

        // --- APP ROOT ---
        export default function App() {
            const [splash, setSplash] = useState(true);
            const [user, setUser] = useState(null);
            const [view, setView] = useState('auth'); 
            const [lang, setLang] = useState('ar');
            const [notify, setNotify] = useState(null);
            const [menuOpen, setMenuOpen] = useState(false);
            const [settings, setSettings] = useState({});

            const t = (k) => TEXTS[lang][k] || k;
            
            useEffect(() => { setTimeout(() => setSplash(false), 2500); }, []);
            useEffect(() => { if(db) onSnapshot(doc(db, "settings", "global"), (s) => s.exists() && setSettings(s.data())); }, []);

            useEffect(() => {
                const uid = localStorage.getItem('cd0777_uid');
                if (uid && db) {
                    if (uid === 'admin') {
                        setUser({role: 'admin', username: 'Admin'});
                        return;
                    }
                    const unsub = onSnapshot(doc(db, "users", uid), (s) => {
                        if (s.exists()) {
                            setUser({ id: s.id, ...s.data() });
                            // Banned check moved here
                            if(s.data().status === 'banned') {
                                localStorage.removeItem('cd0777_uid');
                                setUser(null);
                                setView('auth');
                                showMsg('Account Banned', 'error');
                            }
                        } else {
                            setUser(null); localStorage.removeItem('cd0777_uid'); setView('auth');
                        }
                    }, err => showMsg("Connection Error", 'error'));
                    return () => unsub();
                }
            }, []);

            useEffect(() => {
                if (user && view === 'auth') {
                    setView(user.role === 'admin' ? 'admin' : 'home');
                }
            }, [user]);

            const showMsg = (msg, type='success') => { 
                setNotify({msg, type}); 
                setTimeout(()=>setNotify(null), 3000); 
            };
            
            const navTo = (v) => { setView(v); setMenuOpen(false); };
            const logout = () => { localStorage.removeItem('cd0777_uid'); setUser(null); setView('auth'); };

            const isRTL = lang === 'ar';
            const ArrowIcon = isRTL ? ChevronRight : ChevronLeft;

            if (splash) return React.createElement(SplashScreen);

            if (!user && view === 'auth') return React.createElement(AuthScreen, { setUser, setView, showMsg, t, lang, setLang });
            if (!user && view === 'forgot') return React.createElement(ForgotPassScreen, { setView, showMsg, t, ArrowIcon });
            
            // --- CRITICAL UPDATE: PENDING CHECK BEFORE MAIN APP ---
            // This ensures users with 'pending' status CANNOT see the main app.
            if (user && user.status === 'pending') {
                return React.createElement(PendingActivationScreen, { user, logout, t, isRTL });
            }

            // --- ADMIN PANEL ---
            if (user?.role === 'admin' && view === 'admin') return React.createElement(AdminPanel, { user, logout, db, showMsg, t });

            // --- GAMES ---
            if (view === 'game-crash') return React.createElement(CrashGame, { user, back: ()=>navTo('casino'), showMsg, ArrowIcon, t, isRTL });
            if (view === 'game-slots') return React.createElement(SlotsGame, { user, back: ()=>navTo('casino'), showMsg, ArrowIcon, t });
            if (view === 'game-keno') return React.createElement(KenoGame, { user, back: ()=>navTo('casino'), showMsg, ArrowIcon, t });
            if (view === 'game-limbo') return React.createElement(LimboGame, { user, back: ()=>navTo('casino'), showMsg, ArrowIcon, t });
            if (view === 'game-coinflip') return React.createElement(CoinFlipGame, { user, back: ()=>navTo('casino'), showMsg, ArrowIcon, t });

            return React.createElement('div', { className: `h-screen flex flex-col bg-dark-950 text-white relative selection:bg-gold-500 selection:text-black`, dir: isRTL ? 'rtl' : 'ltr' },
                notify && React.createElement('div', { className: `fixed top-6 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-pop glass-panel w-max max-w-[90%] ${notify.type==='error'?'bg-red-950/90 border-red-500':'bg-green-950/90 border-green-500'}` }, 
                    notify.type==='success'?React.createElement(CheckCircle,{size:24, className:"text-green-400"}):React.createElement(XCircle,{size:24, className:"text-red-400"}), 
                    React.createElement('span', { className: "font-bold text-sm" }, notify.msg)
                ),
                
                React.createElement(Header, { user, toggleMenu: ()=>setMenuOpen(true) }),
                menuOpen && React.createElement(Sidebar, { user, close: ()=>setMenuOpen(false), navTo, t, lang, setLang, settings, logout }),
                
                React.createElement('main', { className: "flex-1 overflow-y-auto p-5 pb-28 z-10 scrollbar-hide" },
                    view === 'home' && React.createElement(HomeScreen, { user, navTo, t }),
                    view === 'casino' && React.createElement(CasinoScreen, { navTo, t }),
                    view === 'tasks' && React.createElement(TasksScreen, { user, showMsg, t }),
                    view === 'profile' && React.createElement(WalletScreen, { user, showMsg, t, isRTL, navTo }),
                    view === 'deposit' && React.createElement(DepositScreen, { user, showMsg, t, settings, back: ()=>navTo('profile') }),
                    view === 'withdraw' && React.createElement(WithdrawScreen, { user, showMsg, t, back: ()=>navTo('profile') }),
                    view === 'history' && React.createElement(HistoryScreen, { user, t, back: ()=>navTo('profile') }),
                    view === 'settings' && React.createElement(SettingsScreen, { user, showMsg, t, back: ()=>navTo('profile') }),
                    view === 'terms' && React.createElement(InfoPage, { title: t('terms'), content: settings.terms || "Terms...", back: ()=>navTo('profile') }),
                    view === 'policy' && React.createElement(InfoPage, { title: t('policy'), content: settings.policy || "Policy...", back: ()=>navTo('profile') })
                ),

                React.createElement('nav', { className: "fixed bottom-4 left-4 right-4 h-16 glass-panel rounded-2xl z-40 flex justify-around items-center shadow-2xl border border-white/10 backdrop-blur-md" },
                    React.createElement(NavBtn, { icon: Home, label: t('home'), active: view==='home', onClick:()=>navTo('home') }),
                    React.createElement(NavBtn, { icon: Dices, label: t('casino'), active: view==='casino', onClick:()=>navTo('casino') }),
                    React.createElement(NavBtn, { icon: Trophy, label: t('tasks'), active: view==='tasks', onClick:()=>navTo('tasks') }),
                    React.createElement(NavBtn, { icon: Wallet, label: t('wallet'), active: view==='profile', onClick:()=>navTo('profile') })
                )
            );
        }

        // --- PENDING SCREEN (LOCKED UNTIL ADMIN APPROVES) ---
        function PendingActivationScreen({ user, logout, t, isRTL }) {
            return React.createElement('div', { className: "h-screen bg-dark-950 flex flex-col items-center justify-center p-6 text-center animate-fade-in", dir: isRTL?'rtl':'ltr' },
                React.createElement(LockKeyhole, { size: 64, className: "text-gold-500 mb-6 animate-pulse" }),
                React.createElement('h1', { className: "text-2xl font-black text-gold-500 mb-2 font-oswald uppercase tracking-wider" }, t('pending_title')),
                React.createElement('div', { className: "bg-red-500/10 text-red-400 px-4 py-1 rounded-full text-xs font-bold mb-6 border border-red-500/20" }, "STATUS: PENDING"),
                
                React.createElement('p', { className: "text-gray-400 text-sm mb-8" }, t('wait_admin')),
                
                React.createElement('div', { className: "w-full max-w-sm bg-dark-900 border border-gold-500/30 rounded-2xl p-6 space-y-4 shadow-2xl" },
                    React.createElement('div', { className: "flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/10" },
                        React.createElement('div', { className: "w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center font-bold text-white text-xs" }, "1"),
                        React.createElement('p', { className: "text-sm font-bold text-white text-right flex-1" }, t('step_1')),
                        React.createElement('a', { href: "https://bit.ly/3X8X8X8", target: "_blank", className: "text-gold-500" }, React.createElement(ExternalLink, { size: 16 }))
                    ),
                    React.createElement('div', { className: "flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/10" },
                        React.createElement('div', { className: "w-8 h-8 rounded-full bg-blue-400 flex items-center justify-center font-bold text-white text-xs" }, "2"),
                        React.createElement('p', { className: "text-sm font-bold text-white text-right flex-1" }, t('step_2')),
                        React.createElement('a', { href: "https://t.me/CD0777VIP", target: "_blank", className: "text-gold-500" }, React.createElement(ExternalLink, { size: 16 }))
                    )
                ),

                React.createElement('button', { onClick: logout, className: "mt-8 text-red-400 text-sm font-bold flex items-center gap-2 hover:bg-red-900/20 px-4 py-2 rounded-lg transition-colors" }, 
                    React.createElement(LogOut, { size: 16 }), t('logout')
                )
            );
        }

        // --- SPLASH SCREEN ---
        function SplashScreen() {
            return React.createElement('div', { className: "fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center" },
                React.createElement('div', { className: "relative w-40 h-40 flex items-center justify-center animate-pop" },
                    React.createElement('div', { className: "absolute inset-0 border-4 border-gold-500 rotate-45 rounded-xl shadow-[0_0_50px_#FFD700]" }),
                    React.createElement('div', { className: "absolute inset-2 border-2 border-white/20 rotate-45 rounded-lg" }),
                    React.createElement('h1', { className: "text-7xl font-black text-transparent bg-clip-text bg-gradient-to-tr from-gold-300 to-gold-600 font-oswald tracking-tighter" }, "CD")
                ),
                React.createElement('div', { className: "mt-8 text-gold-500/50 text-sm tracking-[0.5em] font-light animate-pulse" }, "ROYAL CLUB")
            );
        }

        // --- COMPONENTS ---
        function Header({ user, toggleMenu }) {
            return React.createElement('div', { className: "sticky top-0 z-40 bg-dark-950/80 backdrop-blur-md border-b border-white/5 px-5 py-4 flex justify-between items-center" },
                React.createElement('div', { className: "flex items-center gap-3" },
                    React.createElement('button', { onClick: toggleMenu, className: "p-2 bg-dark-900 rounded-xl text-gold-500 border border-white/5 btn-press" }, React.createElement(Menu, { size: 24 })),
                    React.createElement('div', { className: "w-9 h-9 rounded-xl bg-gradient-to-tr from-gold-400 to-gold-600 flex items-center justify-center font-black text-black text-sm shadow-lg" }, "CD")
                ),
                React.createElement('div', { className: "bg-dark-900 border border-white/10 px-4 py-1.5 rounded-full flex items-center gap-2" }, 
                    React.createElement(Gem, { size: 16, className: "text-gold-500 animate-pulse" }), 
                    React.createElement('span', { className: "text-gold-500 font-mono font-bold text-sm" }, user.coins.toLocaleString())
                )
            );
        }

        function Sidebar({ user, close, navTo, t, lang, setLang, settings, logout }) {
            return React.createElement('div', { className: "fixed inset-0 z-50 flex" },
                React.createElement('div', { className: "absolute inset-0 bg-black/80 backdrop-blur-md transition-opacity", onClick: close }),
                React.createElement('div', { className: `relative w-72 bg-dark-900 border-l border-gold-500/20 h-full p-6 shadow-2xl flex flex-col ${lang==='ar'?'animate-slide-in-right':'animate-slide-in-left'}` },
                    React.createElement('div', { className: "flex justify-between items-center mb-8 border-b border-white/10 pb-4" }, React.createElement('h2',{className:"text-gold-500 font-bold text-2xl"}, t('menu')), React.createElement('button',{onClick:close},React.createElement(X, {className:"text-gray-400"}))),
                    React.createElement('nav', { className: "space-y-2 flex-1 overflow-y-auto" },
                        React.createElement(SidebarBtn, { icon: Home, label: t('home'), onClick:()=>navTo('home') }),
                        React.createElement(SidebarBtn, { icon: Dices, label: t('casino'), onClick:()=>navTo('casino') }),
                        React.createElement(SidebarBtn, { icon: Wallet, label: t('wallet'), onClick:()=>navTo('profile') }),
                        React.createElement('div', {className:"h-px bg-white/5 my-3"}),
                        React.createElement(SidebarBtn, { icon: History, label: t('history'), onClick:()=>navTo('history') }),
                        React.createElement(SidebarBtn, { icon: Settings, label: t('settings'), onClick:()=>navTo('settings') }),
                        React.createElement('div', {className:"h-px bg-white/5 my-3"}),
                        settings.support && React.createElement(SidebarBtn, { icon: LifeBuoy, label: t('support'), onClick:()=>window.open(settings.support) }),
                        React.createElement('button', { onClick: ()=>{const l=lang==='ar'?'en':'ar'; setLang(l); localStorage.setItem('cd0777_lang',l);}, className: "w-full flex items-center justify-between p-3.5 rounded-xl text-gray-300 hover:bg-white/5 mt-4 border border-white/5 btn-press" }, React.createElement('div', {className:"flex gap-4"}, React.createElement(Globe), t('lang')), React.createElement('span', {className:"text-gold-500 text-xs bg-black px-2 py-1 rounded"}, lang==='ar'?'English':'العربية'))
                    ),
                    React.createElement('button', { onClick:logout, className: "mt-auto w-full flex items-center justify-center gap-2 text-red-400 p-4 bg-red-900/10 rounded-2xl font-bold border border-red-900/30 btn-press" }, React.createElement(LogOut), t('logout'))
                )
            );
        }
        const SidebarBtn = ({ icon: Icon, label, onClick }) => React.createElement('button', { onClick, className: "w-full flex items-center gap-4 p-3.5 rounded-xl text-gray-300 hover:bg-white/5 btn-press" }, React.createElement(Icon, { size: 20 }), React.createElement('span', {}, label));
        const NavBtn = ({ icon: Icon, label, active, onClick }) => React.createElement('button', { onClick, className: `flex flex-col items-center gap-1 transition-all ${active?'text-gold-500 -translate-y-1 scale-110':'text-gray-500'}` }, React.createElement(Icon, { size: 24, strokeWidth: active?2.5:2 }), React.createElement('span', { className: "text-[9px] font-bold" }, label));

        // --- AUTH (UPDATED: SETS STATUS TO PENDING) ---
        function AuthScreen({ setUser, setView, showMsg, t, lang, setLang }) {
            const [isReg, setIsReg] = useState(false); const [f, setF] = useState({ u:'', p:'', n:'', ph:'' });
            const submit = async () => {
                if(!f.u || !f.p) return showMsg(t('inputs_err'), 'error');
                if(f.u==='admin' && f.p==='admin123') { localStorage.setItem('cd0777_uid', 'admin'); setUser({role:'admin'}); setView('admin'); return; }
                try {
                    if(isReg) {
                        const q = query(collection(db, "users"), where("username", "==", f.u)); if(!(await getDocs(q)).empty) throw new Error('Username taken');
                        const sz = (await getDocs(collection(db, "users"))).size;
                        // NEW: Force status to 'pending' on registration
                        const nu = { username: f.u, password: f.p, fullName: f.n, phone: f.ph, memberId: `CD${1001+sz}`, role: 'user', status: 'pending', coins: 100, balance: 0, completedTasks: [] };
                        const ref = await addDoc(collection(db, "users"), nu); localStorage.setItem('cd0777_uid', ref.id); setUser({id:ref.id, ...nu});
                    } else {
                        const q = query(collection(db, "users"), where("username", "==", f.u), where("password", "==", f.p)); const s = await getDocs(q);
                        if(s.empty) throw new Error('Invalid credentials'); const d=s.docs[0]; localStorage.setItem('cd0777_uid', d.id); setUser({id:d.id, ...d.data()});
                    }
                } catch(e) { showMsg(e.message, 'error'); }
            };
            return React.createElement('div', { className: "h-full flex flex-col items-center justify-center p-6 bg-dark-950 luxury-bg relative animate-fade-in", dir: lang==='ar'?'rtl':'ltr' },
                React.createElement('button', { onClick: ()=>setLang(lang==='ar'?'en':'ar'), className: "absolute top-6 right-6 text-xs bg-white/10 px-3 py-1 rounded-full text-gold-500 font-bold" }, lang.toUpperCase()),
                React.createElement('div', { className: "w-32 h-32 rounded-3xl bg-gradient-to-tr from-gold-400 to-gold-700 flex items-center justify-center text-6xl font-black text-black mb-8 shadow-2xl shadow-gold-500/20 border-4 border-gold-300" }, "CD"),
                React.createElement('div', { className: "w-full max-w-sm space-y-4" },
                    React.createElement('h1', { className: "text-3xl font-bold text-center text-gold-500 mb-6 font-oswald tracking-widest uppercase" }, isReg ? t('register') : t('login')),
                    isReg && React.createElement(Input, { icon: User, placeholder: t('name'), onChange: e=>setF({...f,n:e.target.value}) }),
                    isReg && React.createElement(Input, { icon: Smartphone, placeholder: t('phone'), onChange: e=>setF({...f,ph:e.target.value}) }),
                    React.createElement(Input, { icon: User, placeholder: t('user'), onChange: e=>setF({...f,u:e.target.value}) }),
                    React.createElement(Input, { icon: Lock, type: "password", placeholder: t('pass'), onChange: e=>setF({...f,p:e.target.value}) }),
                    !isReg && React.createElement('button', { onClick: ()=>setView('forgot'), className: "text-xs text-gold-500 hover:underline w-full text-right" }, t('forgot_pass')),
                    React.createElement(Button, { full: true, onClick: submit }, isReg?t('register'):t('login')),
                    React.createElement('button', { onClick: ()=>setIsReg(!isReg), className: "w-full text-center text-xs text-slate-500 mt-4 hover:text-gold-500 transition-colors" }, isReg?t('welcome'):t('register'))
                )
            );
        }

        function ForgotPassScreen({ setView, showMsg, t, ArrowIcon }) {
            const [u, setU] = useState('');
            const req = async () => {
                if(!u) return showMsg(t('inputs_err'), 'error');
                await addDoc(collection(db, "password_resets"), { username: u, status: 'pending', date: new Date().toISOString() });
                showMsg(t('success')); setView('auth');
            };
            return React.createElement('div', { className: "h-full flex flex-col items-center justify-center p-6 bg-dark-950" },
                React.createElement('button', { onClick: ()=>setView('auth'), className: "absolute top-6 left-6 text-white" }, React.createElement(ArrowIcon)),
                React.createElement('h2', { className: "text-2xl text-gold-500 font-bold mb-6" }, t('reset_req')),
                React.createElement('div', { className: "w-full max-w-sm space-y-4" },
                    React.createElement(Input, { placeholder: t('user'), value: u, onChange: e=>setU(e.target.value) }),
                    React.createElement(Button, { full: true, onClick: req }, t('confirm'))
                )
            );
        }

        // --- HOME ---
        function HomeScreen({ user, navTo, t }) {
            return React.createElement('div', { className: "space-y-6 animate-pop" },
                React.createElement('div', { className: "relative aspect-[1.58/1] rounded-2xl overflow-hidden shadow-2xl border border-white/10 hover:border-gold-500/40 transition-all transform hover:rotate-1" },
                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-br from-dark-900 to-black" },
                        React.createElement('div', { className: "absolute inset-0 opacity-20", style:{backgroundImage:'radial-gradient(#C0A000 1px, transparent 1px)', backgroundSize:'20px 20px'} })
                    ),
                    React.createElement('div', { className: "relative z-10 h-full p-6 flex flex-col justify-between" },
                        React.createElement('div', { className: "flex justify-between items-start" },
                            React.createElement('div', { className: "flex items-center gap-2" }, React.createElement(ShieldCheck, { className: "text-gold-500", size: 26 }), React.createElement('h2', { className: "text-gold-500 font-oswald text-xl tracking-widest" }, "CD0777")),
                            React.createElement('div', { className: `px-3 py-1 rounded-full text-[9px] font-black tracking-wider border border-green-500 text-green-400` }, "VIP MEMBER")
                        ),
                        React.createElement('div', { className: "flex justify-between items-center" },
                            React.createElement('div', {}, React.createElement('p', { className: "text-gray-400 text-[8px] uppercase tracking-widest mb-1 font-bold" }, "BALANCE"), React.createElement('p', { className: "font-mono text-3xl text-white flex gap-1" }, React.createElement('span', { className: "text-gold-500" }, "$"), Number(user.balance).toFixed(2))),
                            React.createElement('div', { className: "text-right" }, React.createElement('p', { className: "text-[7px] text-gold-600 uppercase mb-1 font-bold" }, "ID"), React.createElement('p', { className: "font-mono text-lg text-white border-gold-500 px-2 border-r-2" }, user.memberId))
                        ),
                        React.createElement('div', { className: "flex justify-between items-end" }, React.createElement('div', {}, React.createElement('p', { className: "text-[7px] text-gold-600 uppercase mb-0.5 font-bold" }, t('name')), React.createElement('p', { className: "font-mono text-gray-200 text-sm tracking-widest uppercase" }, user.fullName)))
                    )
                ),
                React.createElement('button', { onClick: ()=>navTo('casino'), className: "w-full h-28 relative rounded-2xl overflow-hidden group active:scale-95 transition-all border border-white/5 hover:border-gold-500/40 shadow-xl" },
                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-r from-red-900/80 to-purple-900/80" },
                        React.createElement('div', { className: "absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-30" })
                    ),
                    React.createElement('div', { className: "absolute inset-0 flex items-center justify-between p-6" },
                        React.createElement('div', {}, React.createElement('h3', { className: "text-2xl font-black italic text-white mb-1 drop-shadow-md" }, "PLAY & WIN"), React.createElement('p', { className: "text-xs text-red-200 font-bold" }, t('play'))),
                        React.createElement(Rocket, { size: 50, className: "text-white/20 animate-pulse" })
                    )
                )
            );
        }

        // --- CASINO MENU ---
        function CasinoScreen({ navTo, t }) {
            return React.createElement('div', { className: "space-y-4 animate-pop" },
                React.createElement('h2', { className: "text-gold-500 font-bold text-lg flex gap-2 items-center" }, React.createElement(Dices), t('casino')),
                React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                    React.createElement(GameCard, { title:t('crash'), sub:"3.00 ODD", color:"red", icon:Rocket, onClick:()=>navTo('game-crash') }),
                    React.createElement(GameCard, { title:t('slots'), sub:"50.0 ODD", color:"purple", icon:Gem, onClick:()=>navTo('game-slots') }),
                    React.createElement(GameCard, { title:t('limbo'), sub:"User ODD", color:"orange", icon:Target, onClick:()=>navTo('game-limbo') }),
                    React.createElement(GameCard, { title:t('keno'), sub:"High ODD", color:"emerald", icon:Grid3X3, onClick:()=>navTo('game-keno') }),
                    React.createElement(GameCard, { title:t('coinflip'), sub:"2.00 ODD", color:"blue", icon:Coins, onClick:()=>navTo('game-coinflip') })
                )
            );
        }
        const GameCard = ({ title, sub, color, icon: Icon, onClick }) => React.createElement('button', { onClick, className: `relative h-32 rounded-2xl overflow-hidden border border-white/5 bg-dark-800 hover:border-${color}-500/50 transition-all group w-full text-right active:scale-95 shadow-lg` }, React.createElement('div', { className: `absolute inset-0 bg-gradient-to-br from-${color}-900/50 to-transparent` }), React.createElement('div', { className: `absolute top-3 left-3 text-${color}-500/20 group-hover:text-${color}-500/40 transition-colors` }, React.createElement(Icon, { size: 60 })), React.createElement('div', { className: "absolute bottom-4 right-4 z-10" }, React.createElement('h3', { className: "text-xl font-black text-white italic" }, title), React.createElement('p', { className: `text-[10px] text-${color}-300 font-bold uppercase` }, sub)));

        function TasksScreen({ user, showMsg, t }) {
            return React.createElement('div', { className: "animate-pop" },
                React.createElement('h2', { className: "text-gold-500 font-bold text-lg mb-4" }, t('tasks')),
                React.createElement('div', { className: "text-center py-10 bg-dark-900 rounded-2xl border border-white/5" },
                    React.createElement(Trophy, { size: 40, className: "mx-auto text-gray-600 mb-4" }),
                    React.createElement('p', { className: "text-gray-400" }, t('no_tasks'))
                )
            );
        }

        // --- WALLET SCREEN ---
        function WalletScreen({ user, showMsg, t, isRTL, navTo }) {
            return React.createElement('div', { className: "space-y-6 animate-pop" },
                React.createElement('div', { className: "bg-gradient-to-r from-gold-600 to-gold-400 p-6 rounded-2xl shadow-lg text-black relative overflow-hidden" },
                   React.createElement('div', { className: "absolute -right-4 -top-4 text-white/20" }, React.createElement(Wallet, { size: 100 })),
                   React.createElement('p', { className: "text-xs font-black uppercase tracking-widest opacity-60" }, "Total Balance"),
                   React.createElement('h2', { className: "text-4xl font-black font-mono mt-1 mb-4" }, `$${Number(user.balance).toFixed(2)}`),
                   React.createElement('div', { className: "flex gap-2" },
                       React.createElement('button', { onClick: ()=>navTo('deposit'), className: "flex-1 bg-black/20 hover:bg-black/30 py-2 rounded-lg font-bold text-sm transition-colors" }, t('deposit')),
                       React.createElement('button', { onClick: ()=>navTo('withdraw'), className: "flex-1 bg-black/20 hover:bg-black/30 py-2 rounded-lg font-bold text-sm transition-colors" }, t('withdraw'))
                   )
                ),
                React.createElement('div', { className: "bg-dark-900 rounded-2xl p-1" },
                    React.createElement(SettingsBtn, { icon: History, label: t('history'), onClick: ()=>navTo('history'), arrow:true, isRTL }),
                    React.createElement(SettingsBtn, { icon: FileText, label: t('terms'), onClick: ()=>navTo('terms'), arrow:true, isRTL }),
                    React.createElement(SettingsBtn, { icon: ShieldCheck, label: t('policy'), onClick: ()=>navTo('policy'), arrow:true, isRTL })
                )
            );
        }

        // --- DEPOSIT SCREEN ---
        function DepositScreen({ user, showMsg, t, settings, back }) {
             const [method, setMethod] = useState(null);
             const [amount, setAmount] = useState('');
             const [imgFile, setImgFile] = useState(null);
             const [loading, setLoading] = useState(false);

             const METHODS = [
                 { id: 'attijari', name: t('method_bank'), color: 'text-orange-500', bg: 'bg-orange-500/10', icon: Landmark },
                 { id: 'cashplus', name: t('method_cash'), color: 'text-yellow-500', bg: 'bg-yellow-500/10', icon: Zap },
                 { id: 'binance', name: t('method_crypto'), color: 'text-yellow-400', bg: 'bg-yellow-400/10', icon: Disc },
                 { id: 'paypal', name: 'PayPal', color: 'text-blue-500', bg: 'bg-blue-500/10', icon: Wallet }
             ];

             const submit = async () => {
                 if(!method || !amount || !imgFile) return showMsg(t('inputs_err'), 'error');
                 setLoading(true);
                 try {
                     const base64Img = await convertToBase64(imgFile);
                     await addDoc(collection(db, "deposits"), {
                         userId: user.id, username: user.username, amount: Number(amount), method: method.name, status: 'pending', image: base64Img, date: new Date().toISOString()
                     });
                     showMsg(t('success')); back();
                 } catch(e) { showMsg(t('error'), 'error'); }
                 setLoading(false);
             };

             return React.createElement('div', { className: "animate-pop h-full flex flex-col" },
                React.createElement('button', { onClick: back, className: "mb-4 text-gold-500 flex items-center gap-2" }, React.createElement(ChevronRight), t('wallet')),
                React.createElement('h2', { className: "text-2xl font-bold mb-4" }, t('deposit')),
                
                React.createElement('div', { className: "flex-1 overflow-y-auto space-y-4 pb-20" },
                    React.createElement('div', { className: "grid grid-cols-2 gap-3" },
                        METHODS.map(m => React.createElement('button', { key: m.id, onClick: () => setMethod(m), className: `p-4 rounded-xl border flex flex-col items-center gap-2 transition-all ${method?.id === m.id ? 'border-gold-500 bg-gold-500/10' : 'border-white/10 bg-dark-900'}` }, React.createElement(m.icon, { className: m.color }), React.createElement('span', { className: "text-xs font-bold" }, m.name)))
                    ),
                    method && React.createElement('div', { className: "space-y-4 animate-slide-up" },
                        React.createElement('div', { className: "bg-dark-800 p-4 rounded-xl border border-white/5 text-center" },
                            React.createElement('p', { className: "text-xs text-gray-400 mb-2" }, t('proof_needed')),
                            React.createElement('p', { className: "font-mono text-lg text-gold-500 break-all select-text" }, settings[`${method.id}_info`] || "Ask Admin")
                        ),
                        React.createElement(Input, { placeholder: t('amount'), type: "number", value: amount, onChange: e=>setAmount(e.target.value), icon: DollarSign }),
                        React.createElement('div', { className: "bg-dark-900 border border-dashed border-white/20 rounded-xl p-6 text-center relative" },
                            React.createElement('input', { type: "file", accept: "image/*", onChange: e=>setImgFile(e.target.files[0]), className: "absolute inset-0 opacity-0 z-10 w-full h-full cursor-pointer" }),
                            React.createElement(Upload, { className: "mx-auto text-gray-500 mb-2" }),
                            React.createElement('p', { className: "text-xs text-gray-400" }, imgFile ? imgFile.name : t('upload_proof'))
                        ),
                        React.createElement(Button, { full: true, onClick: submit, disabled: loading }, loading ? "..." : t('execute'))
                    )
                )
            );
        }

        // --- WITHDRAW SCREEN ---
        function WithdrawScreen({ user, showMsg, t, back }) {
             const [method, setMethod] = useState(null);
             const [form, setForm] = useState({ amount: '', name: '', account: '', phone: '', network: 'Orange' });
             
             const METHODS = [
                 { id: 'bank', name: t('method_bank'), icon: Landmark, color: 'text-orange-500' },
                 { id: 'cash', name: t('method_cash'), icon: Zap, color: 'text-yellow-500' },
                 { id: 'recharge', name: t('method_recharge'), icon: Smartphone, color: 'text-green-500' },
                 { id: 'crypto', name: t('method_crypto'), icon: Disc, color: 'text-blue-500' }
             ];

             const submit = async () => {
                 if(!method || !form.amount) return showMsg(t('inputs_err'), 'error');
                 if(method.id==='recharge' && !form.phone) return showMsg(t('inputs_err'), 'error');
                 
                 await addDoc(collection(db, "withdraws"), {
                    userId: user.id, username: user.username, amount: Number(form.amount), method: method.name, details: form, status: 'pending', date: new Date().toISOString()
                 });
                 showMsg(t('success')); back();
             };

             return React.createElement('div', { className: "animate-pop" },
                React.createElement('button', { onClick: back, className: "mb-4 text-gold-500 flex items-center gap-2" }, React.createElement(ChevronRight), t('wallet')),
                React.createElement('h2', { className: "text-2xl font-bold mb-4" }, t('withdraw')),
                
                // Methods Grid
                React.createElement('div', { className: "grid grid-cols-2 gap-3 mb-6" },
                    METHODS.map(m => React.createElement('button', { key: m.id, onClick: () => setMethod(m), className: `p-4 rounded-xl border flex flex-col items-center gap-2 transition-all ${method?.id === m.id ? 'border-gold-500 bg-gold-500/10' : 'border-white/10 bg-dark-900'}` }, React.createElement(m.icon, { className: m.color }), React.createElement('span', { className: "text-xs font-bold" }, m.name)))
                ),

                method && React.createElement('div', { className: "bg-dark-900 p-6 rounded-2xl space-y-4 animate-slide-up" },
                    React.createElement(Input, { placeholder: t('amount'), type:"number", value: form.amount, onChange: e=>setForm({...form, amount:e.target.value}), icon: DollarSign }),
                    
                    // Dynamic Inputs
                    (method.id === 'bank') && React.createElement(React.Fragment, null,
                        React.createElement(Input, { placeholder: t('name'), value: form.name, onChange: e=>setForm({...form, name:e.target.value}), icon: User }),
                        React.createElement(Input, { placeholder: t('rib'), value: form.account, onChange: e=>setForm({...form, account:e.target.value}), icon: CreditCard }),
                        React.createElement(Input, { placeholder: t('bank_name'), value: form.bank, onChange: e=>setForm({...form, bank:e.target.value}), icon: Landmark })
                    ),
                    (method.id === 'cash') && React.createElement(React.Fragment, null,
                        React.createElement(Input, { placeholder: t('name'), value: form.name, onChange: e=>setForm({...form, name:e.target.value}), icon: User }),
                        React.createElement(Input, { placeholder: t('cnie'), value: form.account, onChange: e=>setForm({...form, account:e.target.value}), icon: CreditCard }),
                        React.createElement(Input, { placeholder: t('phone'), value: form.phone, onChange: e=>setForm({...form, phone:e.target.value}), icon: Smartphone })
                    ),
                    (method.id === 'recharge') && React.createElement(React.Fragment, null,
                         React.createElement(Input, { placeholder: t('phone'), value: form.phone, onChange: e=>setForm({...form, phone:e.target.value}), icon: Smartphone }),
                         React.createElement('div', { className: "space-y-2" },
                            React.createElement('label', {className:"text-xs text-gray-400"}, t('network')),
                            React.createElement('select', { value: form.network, onChange: e=>setForm({...form, network:e.target.value}), className: "w-full bg-dark-950 border border-white/10 p-3 rounded-xl text-white outline-none" },
                                React.createElement('option', {value:"Orange"}, "Orange"),
                                React.createElement('option', {value:"Maroc Telecom"}, "Maroc Telecom"),
                                React.createElement('option', {value:"Inwi"}, "Inwi")
                            )
                         )
                    ),
                    (method.id === 'crypto') && React.createElement(React.Fragment, null,
                        React.createElement(Input, { placeholder: t('wallet_addr'), value: form.account, onChange: e=>setForm({...form, account:e.target.value}), icon: Disc })
                    ),

                    React.createElement(Button, { full:true, onClick: submit }, t('execute'))
                )
            );
        }

        function HistoryScreen({ user, t, back }) {
            const [list, setList] = useState([]);
            useEffect(() => {
                const q = query(collection(db, "deposits"), where("userId", "==", user.id), orderBy("date", "desc"));
                onSnapshot(q, s => setList(s.docs.map(d => d.data())));
            }, []);
            return React.createElement('div', { className: "animate-pop" },
                React.createElement('div', { className: "flex items-center gap-2 mb-4" }, 
                     back && React.createElement('button', { onClick: back, className: "text-gold-500" }, React.createElement(ChevronRight)),
                    React.createElement('h2', { className: "text-gold-500 font-bold text-lg" }, t('history'))
                ),
                list.length === 0 
                ? React.createElement('div', { className: "bg-dark-900 rounded-2xl p-6 text-center text-gray-500" }, "No records found")
                : React.createElement('div', { className: "space-y-2" }, list.map((item, i) => 
                    React.createElement('div', { key: i, className: "bg-dark-900 p-4 rounded-xl flex justify-between items-center" },
                        React.createElement('div', {}, React.createElement('p', { className: "text-white font-bold" }, item.method), React.createElement('p', { className: "text-xs text-gray-500" }, new Date(item.date).toLocaleDateString())),
                        React.createElement('div', { className: "text-right" }, React.createElement('p', { className: "text-gold-500 font-mono" }, `+${item.amount}`), React.createElement('p', { className: `text-[10px] ${item.status==='pending'?'text-yellow-500':'text-green-500'}` }, item.status))
                    )
                ))
            );
        }

        function SettingsScreen({ user, showMsg, t, back }) {
             return React.createElement('div', { className: "animate-pop" },
                React.createElement('div', { className: "flex items-center gap-2 mb-4" }, 
                     back && React.createElement('button', { onClick: back, className: "text-gold-500" }, React.createElement(ChevronRight)),
                    React.createElement('h2', { className: "text-gold-500 font-bold text-lg" }, t('settings'))
                ),
                 React.createElement('div', { className: "bg-dark-900 rounded-2xl p-4 space-y-4" },
                    React.createElement(Input, { placeholder: t('old_pass'), type:"password" }),
                    React.createElement(Input, { placeholder: t('new_pass'), type:"password" }),
                    React.createElement(Button, { full:true, onClick:()=>showMsg(t('success')) }, t('change_pass'))
                )
            );
        }

        function InfoPage({ title, content, back }) {
            return React.createElement('div', { className: "animate-pop" },
                React.createElement('button', { onClick: back, className: "mb-4 text-gold-500 flex items-center gap-2" }, React.createElement(ChevronRight), "Back"),
                React.createElement('h2', { className: "text-2xl font-bold mb-4 text-gold-500" }, title),
                React.createElement('div', { className: "bg-dark-900 p-6 rounded-2xl text-gray-300 text-sm leading-relaxed whitespace-pre-wrap" }, content)
            );
        }
        
        const SettingsBtn = ({ icon: Icon, label, onClick, arrow, isRTL }) => React.createElement('button', { onClick, className: "w-full flex items-center justify-between p-4 hover:bg-white/5 rounded-xl group transition-all" }, React.createElement('div', { className: "flex items-center gap-3" }, React.createElement('div', { className: "p-2 bg-dark-950 rounded-lg text-gold-500 group-hover:scale-110 transition-transform" }, React.createElement(Icon, { size: 18 })), React.createElement('span', { className: "font-medium text-sm" }, label)), arrow && (isRTL ? React.createElement(ChevronLeft, { size: 16, className: "text-gray-600" }) : React.createElement(ChevronRight, { size: 16, className: "text-gray-600" })));


        // --- ADMIN PANEL (SURGICALLY UPDATED: DASHBOARD & ACTIVATION) ---
        function AdminPanel({ user, logout, db, showMsg, t }) {
            const [tab, setTab] = useState('req'); // req, users, settings
            const [reqs, setReqs] = useState([]);
            const [users, setUsers] = useState([]);
            const [conf, setConf] = useState({ attijari_info: '', cashplus_info: '', paypal_info: '', binance_info: '' });
            const [editingUser, setEditingUser] = useState(null); // ID
            const [newBalance, setNewBalance] = useState('');

            useEffect(() => {
                const q = query(collection(db, "deposits"), where("status", "==", "pending"));
                const unsubReq = onSnapshot(q, s => setReqs(s.docs.map(d => ({id: d.id, ...d.data()}))));
                
                const unsubUsers = onSnapshot(collection(db, "users"), s => setUsers(s.docs.map(d => ({id: d.id, ...d.data()}))));
                
                getDoc(doc(db, "settings", "global")).then(s => s.exists() && setConf(s.data()));

                return () => { unsubReq(); unsubUsers(); };
            }, []);

            const saveSettings = async () => {
                await setDoc(doc(db, "settings", "global"), conf, { merge: true });
                showMsg(t('success'));
            };

            const handleReq = async (r, action) => {
                try {
                    if (action === 'approve') {
                        const uRef = doc(db, "users", r.userId);
                        const uSnap = await getDoc(uRef);
                        if(uSnap.exists()) {
                            await updateDoc(uRef, { coins: Number(uSnap.data().coins) + Number(r.amount), balance: Number(uSnap.data().balance) + Number(r.amount) });
                            await updateDoc(doc(db, "deposits", r.id), { status: 'approved' });
                            showMsg('Approved & Coins Added');
                        }
                    } else {
                        await updateDoc(doc(db, "deposits", r.id), { status: 'rejected' });
                        showMsg('Rejected');
                    }
                } catch(e) { showMsg('Error', 'error'); }
            };

            const updateUser = async (uid, data) => {
                await updateDoc(doc(db, "users", uid), data);
                showMsg("Updated User");
                setEditingUser(null);
            };

            const deleteUser = async (uid) => {
                if(!confirm("Are you sure? This deletes the user permanently.")) return;
                await deleteDoc(doc(db, "users", uid));
                showMsg("User Deleted", 'error');
            };

            return React.createElement('div', { className: "min-h-screen bg-dark-950 p-6" },
                // Header
                React.createElement('div', { className: "flex justify-between items-center mb-8" },
                    React.createElement('h1', { className: "text-3xl font-bold text-gold-500 flex items-center gap-2" }, React.createElement(LayoutDashboard), "DASHBOARD"),
                    React.createElement('button', { onClick: logout, className: "bg-red-900/20 text-red-500 p-2 rounded-lg" }, React.createElement(LogOut))
                ),
                
                // Stats Cards
                React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-8" },
                    React.createElement('div', { className: "bg-dark-900 p-4 rounded-xl border border-white/5" },
                        React.createElement('p', { className: "text-gray-400 text-xs uppercase" }, "Total Users"),
                        React.createElement('p', { className: "text-2xl font-bold text-white" }, users.length)
                    ),
                    React.createElement('div', { className: "bg-dark-900 p-4 rounded-xl border border-white/5" },
                        React.createElement('p', { className: "text-gray-400 text-xs uppercase" }, "Pending Deposits"),
                        React.createElement('p', { className: "text-2xl font-bold text-gold-500" }, reqs.length)
                    ),
                    React.createElement('div', { className: "bg-dark-900 p-4 rounded-xl border border-white/5" },
                        React.createElement('p', { className: "text-gray-400 text-xs uppercase" }, "Pending Users"),
                        React.createElement('p', { className: "text-2xl font-bold text-yellow-500" }, users.filter(u=>u.status==='pending').length)
                    )
                ),

                // Navigation Tabs
                React.createElement('div', { className: "flex gap-2 mb-6 border-b border-white/10 pb-2" },
                    React.createElement('button', { onClick: ()=>setTab('req'), className: `px-6 py-2 rounded-lg font-bold transition-all ${tab==='req'?'bg-gold-500 text-black':'text-gray-400 hover:bg-white/5'}` }, "Requests"),
                    React.createElement('button', { onClick: ()=>setTab('users'), className: `px-6 py-2 rounded-lg font-bold transition-all ${tab==='users'?'bg-gold-500 text-black':'text-gray-400 hover:bg-white/5'}` }, "Users"),
                    React.createElement('button', { onClick: ()=>setTab('settings'), className: `px-6 py-2 rounded-lg font-bold transition-all ${tab==='settings'?'bg-gold-500 text-black':'text-gray-400 hover:bg-white/5'}` }, "Settings")
                ),

                // --- TAB: REQUESTS ---
                tab === 'req' && React.createElement('div', { className: "space-y-4" },
                    reqs.length === 0 && React.createElement('div', { className: "text-center text-gray-500 py-10 italic" }, "No pending deposit requests"),
                    reqs.map(r => React.createElement('div', { key: r.id, className: "bg-dark-900 p-4 rounded-xl border border-white/5 flex flex-col md:flex-row gap-4" },
                        r.image && React.createElement('img', { src: r.image, className: "w-full md:w-32 h-32 object-cover rounded-lg bg-black" }),
                        React.createElement('div', { className: "flex-1" },
                            React.createElement('div', { className: "flex justify-between mb-2" },
                                React.createElement('span', { className: "font-bold text-white text-lg" }, r.username),
                                React.createElement('span', { className: "text-gold-500 font-mono text-xl" }, `+${r.amount}`)
                            ),
                            React.createElement('div', { className: "text-sm text-gray-400 mb-4" },
                                React.createElement('p', {}, `Method: ${r.method}`),
                                React.createElement('p', {}, `Date: ${new Date(r.date).toLocaleString()}`)
                            ),
                            React.createElement('div', { className: "flex gap-2" },
                                React.createElement(Button, { onClick: ()=>handleReq(r, 'approve'), variant: 'green', className: "py-2 px-6 text-xs" }, t('approve')),
                                React.createElement(Button, { onClick: ()=>handleReq(r, 'reject'), variant: 'red', className: "py-2 px-6 text-xs" }, t('reject'))
                            )
                        )
                    ))
                ),

                // --- TAB: USERS (WITH ACTIVATION) ---
                tab === 'users' && React.createElement('div', { className: "space-y-2" },
                    users.map(u => React.createElement('div', { key: u.id, className: "bg-dark-900 p-4 rounded-xl border border-white/5 flex items-center justify-between gap-4" },
                        React.createElement('div', {}, 
                            React.createElement('div', { className: "flex items-center gap-2" },
                                React.createElement('p', { className: "text-white font-bold" }, u.username),
                                u.status === 'pending' && React.createElement('span', { className: "bg-yellow-500/20 text-yellow-500 text-[10px] px-2 py-0.5 rounded font-bold" }, "PENDING"),
                                u.status === 'banned' && React.createElement('span', { className: "bg-red-500/20 text-red-500 text-[10px] px-2 py-0.5 rounded font-bold" }, "BANNED")
                            ),
                            React.createElement('p', { className: "text-xs text-gray-500" }, u.memberId || 'No ID'),
                            React.createElement('p', { className: "text-gold-500 font-mono font-bold text-sm" }, `${u.coins} Coins`)
                        ),
                        
                        editingUser === u.id ? React.createElement('div', { className: "flex gap-2 items-center bg-black/20 p-2 rounded-lg" },
                            React.createElement('input', { type:"number", placeholder:"New Balance", className:"bg-black border border-white/20 p-2 rounded w-20 text-white text-xs", onChange:e=>setNewBalance(e.target.value) }),
                            React.createElement(Button, { onClick:()=>updateUser(u.id, {coins: Number(newBalance)}), variant:'green', className:"py-1 px-3 text-xs" }, "Save"),
                            React.createElement('button', { onClick:()=>setEditingUser(null), className:"text-gray-400" }, React.createElement(X, {size:16}))
                        ) : React.createElement('div', { className: "flex gap-2" },
                            React.createElement('button', { onClick:()=>{setEditingUser(u.id); setNewBalance(u.coins)}, className: "bg-blue-500/10 text-blue-500 p-2 rounded-lg hover:bg-blue-500/20" }, React.createElement(Edit3, {size:16})),
                            
                            // ACTIVATION BUTTON
                            u.status === 'pending' && React.createElement('button', { onClick:()=>updateUser(u.id, {status:'active'}), className: "bg-green-500/10 text-green-500 py-1 px-3 rounded-lg font-bold text-xs flex items-center gap-1 border border-green-500/30 hover:bg-green-500/20" }, React.createElement(CheckCircle, {size:14}), "ACTIVATE"),
                            
                            u.status !== 'banned' 
                                ? React.createElement('button', { onClick:()=>updateUser(u.id, {status:'banned'}), className: "bg-orange-500/10 text-orange-500 p-2 rounded-lg hover:bg-orange-500/20" }, React.createElement(Ban, {size:16}))
                                : React.createElement('button', { onClick:()=>updateUser(u.id, {status:'active'}), className: "bg-green-500/10 text-green-500 p-2 rounded-lg hover:bg-green-500/20" }, React.createElement(CheckCircle, {size:16})),
                            
                            React.createElement('button', { onClick:()=>deleteUser(u.id), className: "bg-red-500/10 text-red-500 p-2 rounded-lg hover:bg-red-500/20" }, React.createElement(Trash2, {size:16}))
                        )
                    ))
                ),

                // --- TAB: SETTINGS ---
                tab === 'settings' && React.createElement('div', { className: "space-y-4 max-w-md mx-auto" },
                    React.createElement('p', { className: "text-gray-400 text-sm mb-4" }, "Configure Deposit Account Info"),
                    React.createElement(Input, { placeholder: "Attijari RIB/Info", value: conf.attijari_info, onChange: e=>setConf({...conf, attijari_info:e.target.value}) }),
                    React.createElement(Input, { placeholder: "Cash Plus Info", value: conf.cashplus_info, onChange: e=>setConf({...conf, cashplus_info:e.target.value}) }),
                    React.createElement(Input, { placeholder: "PayPal Email", value: conf.paypal_info, onChange: e=>setConf({...conf, paypal_info:e.target.value}) }),
                    React.createElement(Input, { placeholder: "Binance Wallet Address", value: conf.binance_info, onChange: e=>setConf({...conf, binance_info:e.target.value}) }),
                    React.createElement(Button, { onClick: saveSettings, full:true }, "Save Changes")
                )
            );
        }

        // --- UPDATED GAME: CRASH (ODD UPDATE) ---
        function CrashGame({ user, back, showMsg, ArrowIcon, t, isRTL }) {
            const [gameState, setGameState] = useState('BETTING'); // BETTING, FLYING, CRASHED
            const [countdown, setCountdown] = useState(5);
            const [multiplier, setMultiplier] = useState(1.00);
            const [betAmount, setBetAmount] = useState(100);
            const [activeBet, setActiveBet] = useState(null);
            const [history, setHistory] = useState([1.5, 2.3]);
            const [cashoutWin, setCashoutWin] = useState(0);

            const reqRef = useRef(null);
            const crashPointRef = useRef(0);
            const startTimeRef = useRef(0);

            useEffect(() => {
                let timer;
                if (gameState === 'BETTING') {
                    setMultiplier(1.00);
                    setCashoutWin(0);
                    if (countdown > 0) {
                        timer = setTimeout(() => setCountdown(c => c - 1), 1000);
                    } else {
                        startFlight();
                    }
                }
                return () => clearTimeout(timer);
            }, [gameState, countdown]);

            const startFlight = () => {
                const r = Math.random();
                let cp = 1;
                if (r < 0.1) cp = 1.0 + Math.random() * 0.1; 
                else if (r < 0.5) cp = 1.1 + Math.random(); 
                else cp = 2 + Math.random() * 10; 
                crashPointRef.current = cp;
                startTimeRef.current = Date.now();
                setGameState('FLYING');
                loop();
            };

            const loop = () => {
                const elapsed = (Date.now() - startTimeRef.current) / 1000;
                const nextMult = 1 + (elapsed * 0.2) + (elapsed * elapsed * 0.05);
                if (nextMult >= crashPointRef.current) {
                    crash(crashPointRef.current);
                } else {
                    setMultiplier(nextMult);
                    reqRef.current = requestAnimationFrame(loop);
                }
            };

            const crash = (finalValue) => {
                cancelAnimationFrame(reqRef.current);
                setMultiplier(finalValue);
                setGameState('CRASHED');
                setActiveBet(null);
                setHistory(h => [finalValue, ...h].slice(0, 5));
                setTimeout(() => {
                    setCountdown(5);
                    setGameState('BETTING');
                }, 3000);
            };

            const placeBet = async (e) => {
                e.preventDefault();
                if(Number(user.coins) < betAmount) return showMsg("No Balance", "error");
                await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)-betAmount});
                setActiveBet(betAmount);
            };

            const cashout = async (e) => {
                e.preventDefault();
                if (!activeBet || gameState !== 'FLYING') return;
                const win = Math.floor(activeBet * multiplier);
                await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)+win});
                setCashoutWin(win);
                setActiveBet(null);
                showMsg(`${t('you_get')} ${win}`, 'success');
                triggerConfetti();
            };

            useEffect(() => { return () => cancelAnimationFrame(reqRef.current); }, []);

            return React.createElement('div', { className: `fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up`, dir:'ltr' },
                React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900 border-b border-white/5", dir: isRTL?'rtl':'ltr' }, 
                    React.createElement('button', { onClick: back, className: "text-slate-400 btn-press" }, React.createElement(ArrowIcon)), 
                    React.createElement('span', { className: "font-bold text-red-500 tracking-widest" }, "CRASH (FIXED)"), 
                    React.createElement('span', { className: "text-xs font-mono bg-black px-2 py-1 rounded text-gold-500" }, user.coins)
                ),
                React.createElement('div', { className: "flex-1 relative flex flex-col items-center justify-center overflow-hidden star-bg" },
                    // ODD Badge
                    React.createElement(OddsBadge, { value: "3.00x", label: "Max ODD" }), // Example static high ODD hint
                    
                    gameState === 'FLYING' && React.createElement('div', { className: "animate-rocket-fly mb-10 transition-transform duration-75", style: { transform: `scale(${1 + multiplier/10})` } },
                         React.createElement(Rocket, { size: 100, className: "text-red-500 drop-shadow-[0_0_30px_rgba(239,68,68,0.8)] fill-red-600 rotate-[-45deg]" })
                    ),
                    gameState === 'CRASHED' && React.createElement('div', { className: "animate-pop flex flex-col items-center" },
                         React.createElement('div', { className: "text-6xl mb-4" }, "💥"),
                         React.createElement('h2', { className: "text-4xl font-black text-red-500 uppercase" }, t('crashed'))
                    ),
                    React.createElement('div', { className: `z-10 font-mono font-black text-6xl drop-shadow-2xl ${gameState==='CRASHED'?'text-red-500':'text-white'}` }, 
                        gameState === 'BETTING' ? `00:0${countdown}` : `${multiplier.toFixed(2)}x`
                    ),
                    gameState === 'BETTING' && React.createElement('p', { className: "mt-4 text-blue-400 font-bold animate-pulse" }, t('next_round')),
                    cashoutWin > 0 && React.createElement('div', { className: "absolute top-20 bg-green-500 text-black font-bold px-6 py-3 rounded-full animate-float-up shadow-lg z-30 text-xl" }, `+${cashoutWin} C`)
                ),
                React.createElement('div', { className: "p-4 bg-dark-900 border-t border-white/10 flex gap-4 pb-safe", dir: isRTL?'rtl':'ltr' }, 
                    React.createElement('div', { className: "relative w-28" }, React.createElement('input', { type: "number", value: betAmount, onChange: e=>setBetAmount(Number(e.target.value)), disabled: gameState!=='BETTING' || activeBet, className: "w-full bg-black border border-white/20 rounded-xl text-center text-white font-bold p-3 outline-none" }), React.createElement(DollarSign, { size: 14, className: "absolute top-1/2 -translate-y-1/2 left-3 text-gold-500" })),
                    gameState === 'BETTING' 
                    ? (activeBet 
                        ? React.createElement(Button, { full: true, variant: 'dark', disabled: true }, t('bet_placed'))
                        : React.createElement(Button, { full: true, onClick: placeBet }, t('play')))
                    : (gameState === 'FLYING' && activeBet
                        ? React.createElement(Button, { full: true, variant: 'green', onClick: cashout }, `${t('cashout')} (${Math.floor(activeBet*multiplier)})`)
                        : React.createElement(Button, { full: true, disabled: true, variant: 'dark' }, gameState==='CRASHED' ? t('crashed') : t('waiting')))
                )
            );
        }

        // --- UPDATED GAME: COINFLIP (ODD UPDATE) ---
        function CoinFlipGame({ user, back, showMsg, ArrowIcon, t }) {
            const [bet, setBet] = useState(100);
            const [choice, setChoice] = useState('Heads'); 
            const [flipping, setFlipping] = useState(false);
            const [rotation, setRotation] = useState(0);
            const [winAmt, setWinAmt] = useState(0);
            const [shake, setShake] = useState(false);

            const flip = async (e) => {
                e.preventDefault();
                if(Number(user.coins) < bet) return showMsg("No Balance", "error");
                if(flipping) return;
                
                setFlipping(true); setWinAmt(0); setShake(false);
                await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)-bet});

                const isHeads = Math.random() > 0.5;
                const result = isHeads ? 'Heads' : 'Tails';
                const currentBase = rotation - (rotation % 360); 
                const targetOffset = isHeads ? 0 : 180; 
                const newRotation = currentBase + 1800 + targetOffset; 
                setRotation(newRotation);

                setTimeout(async () => {
                    setFlipping(false);
                    if(result === choice) {
                        const win = bet * 2;
                        await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)+win});
                        setWinAmt(win);
                        triggerConfetti();
                        showMsg(`WIN! ${result}`, 'success');
                    } else {
                        showMsg(`LOSE. It was ${result}`, 'error');
                        setShake(true); 
                        setTimeout(()=>setShake(false), 500);
                    }
                }, 1000);
            };

            return React.createElement('div', { className: `fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up ${shake ? 'animate-shake-hard animate-flash-red' : ''}` },
                React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900" }, 
                    React.createElement('button', { onClick: back, className: "text-slate-400" }, React.createElement(ArrowIcon)), 
                    React.createElement('span', { className: "font-bold text-blue-500" }, "COIN FLIP"), 
                    React.createElement('span', { className: "text-xs bg-black px-2 py-1 rounded text-gold-500" }, user.coins)
                ),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center gap-10 perspective-1000 relative" },
                    // ODD Badge
                    React.createElement(OddsBadge, { value: "2.00x", label: "Fixed ODD" }),
                    
                    winAmt > 0 && React.createElement('div', { className: "absolute top-20 text-green-500 font-bold text-4xl animate-pop z-20 drop-shadow-lg" }, `+${winAmt}`),
                    React.createElement('div', { className: "relative w-48 h-48 coin-container", style: { transform: `rotateY(${rotation}deg)` } },
                        React.createElement('div', { className: "coin-face coin-front border-4 border-yellow-300 flex flex-col" }, 
                            React.createElement(Crown, { size: 60, className: "text-yellow-900 mb-2" }),
                            React.createElement('span', { className: "font-black text-yellow-900" }, "HEADS")
                        ),
                        React.createElement('div', { className: "coin-face coin-back border-4 border-gray-400 flex flex-col" }, 
                            React.createElement(Coins, { size: 60, className: "text-gray-800 mb-2" }),
                            React.createElement('span', { className: "font-black text-gray-800" }, "TAILS")
                        )
                    ),
                    React.createElement('div', { className: "flex bg-dark-800 p-1 rounded-xl gap-2" },
                        React.createElement('button', { onClick: ()=>setChoice('Heads'), className: `px-8 py-3 rounded-lg font-bold transition-all flex flex-col items-center ${choice==='Heads'?'bg-gold-500 text-black scale-105 shadow-lg':'text-gray-400 hover:bg-white/5'}` }, React.createElement(Crown, {size:20}), "Heads"),
                        React.createElement('button', { onClick: ()=>setChoice('Tails'), className: `px-8 py-3 rounded-lg font-bold transition-all flex flex-col items-center ${choice==='Tails'?'bg-gray-300 text-black scale-105 shadow-lg':'text-gray-400 hover:bg-white/5'}` }, React.createElement(Coins, {size:20}), "Tails")
                    )
                ),
                React.createElement('div', { className: "p-4 bg-dark-900 flex gap-4 pb-safe" }, 
                    React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), disabled: flipping, className: "w-24 bg-black border border-white/20 rounded-xl text-center text-white font-bold" }), 
                    React.createElement(Button, { full: true, onClick: flip, disabled: flipping }, flipping ? "FLIPPING..." : t('play'))
                )
            );
        }

        // --- UPDATED GAME: SLOTS ---
        function SlotsGame({ user, back, showMsg, ArrowIcon, t }) {
            const [bet, setBet] = useState(100);
            const [reels, setReels] = useState(['🍒','🍋','🍇']);
            const [spinning, setSpinning] = useState(false);
            const [status, setStatus] = useState("READY"); 
            const SYMBOLS = ['🍒', '🍋', '🍇', '💎', '7️⃣']; 
            
            const spin = async (e) => {
                e.preventDefault();
                if(Number(user.coins) < bet) return showMsg("No Balance", "error");
                if(spinning) return;
                setSpinning(true); setStatus("SPINNING");
                await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)-bet});
                let interval = setInterval(() => {
                    setReels([
                        SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)],
                        SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)],
                        SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)]
                    ]);
                }, 100);
                setTimeout(async () => {
                    clearInterval(interval);
                    const res = [
                        Math.random() > 0.8 ? '7️⃣' : (Math.random()>0.6 ? '💎' : SYMBOLS[Math.floor(Math.random()*3)]),
                        Math.random() > 0.8 ? '7️⃣' : (Math.random()>0.6 ? '💎' : SYMBOLS[Math.floor(Math.random()*3)]),
                        Math.random() > 0.8 ? '7️⃣' : (Math.random()>0.6 ? '💎' : SYMBOLS[Math.floor(Math.random()*3)])
                    ];
                    if(Math.random() < 0.25) { res[1] = res[0]; }
                    setReels(res);
                    setSpinning(false);
                    let win = 0;
                    if(res[0] === res[1] && res[1] === res[2]) {
                        if(res[0] === '7️⃣') win = bet * 50;
                        else if(res[0] === '💎') win = bet * 20;
                        else win = bet * 10;
                    } else if (res[0] === res[1] || res[1] === res[2] || res[0] === res[2]) {
                        win = Math.floor(bet * 1.5);
                    }
                    if(win > 0) {
                        await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)+win});
                        setStatus(`WIN +${win}`);
                        triggerConfetti();
                    } else {
                        setStatus("NO LUCK");
                    }
                }, 2000);
            };

            return React.createElement('div', { className: `fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up` },
                React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900 border-b border-white/5" }, 
                    React.createElement('button', { onClick: back, className: "text-slate-400 btn-press" }, React.createElement(ArrowIcon)), 
                    React.createElement('span', { className: "font-bold text-purple-500 tracking-widest" }, "ROYAL SLOTS"), 
                    React.createElement('span', { className: "text-xs font-mono bg-black px-2 py-1 rounded text-gold-500" }, user.coins)
                ),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-6 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')] relative" },
                    // ODD Badge
                    React.createElement(OddsBadge, { value: "50.0x", label: "Max ODD" }),
                    React.createElement('div', { className: `mb-8 px-8 py-3 rounded-full font-black text-xl shadow-xl transition-all ${status.includes('WIN') ? 'bg-green-500 text-black scale-110' : (status==='NO LUCK' ? 'bg-red-500 text-white' : 'bg-dark-800 text-gold-500')}` }, status),
                    React.createElement('div', { className: "bg-gradient-to-b from-purple-900 to-black p-4 rounded-3xl border-4 border-gold-500 shadow-[0_0_50px_rgba(234,179,8,0.3)]" },
                          React.createElement('div', { className: "flex gap-2 bg-black/50 p-4 rounded-xl border border-white/10" },
                           reels.map((r, i) => React.createElement('div', { key: i, className: "w-20 h-28 bg-white rounded-lg flex items-center justify-center text-5xl shadow-inner relative overflow-hidden" }, 
                               React.createElement('div', { className: `absolute inset-0 bg-gradient-to-b from-black/10 to-transparent pointer-events-none` }),
                               React.createElement('div', { className: spinning ? 'slot-spin' : 'animate-pop' }, r)
                           ))
                          )
                    )
                ),
                React.createElement('div', { className: "p-4 bg-dark-900 border-t border-white/10 flex gap-4 pb-safe" }, 
                    React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), disabled: spinning, className: "w-24 bg-black border border-white/20 rounded-xl text-center text-white font-bold p-3" }), 
                    React.createElement(Button, { full: true, onClick: spin, disabled: spinning }, spinning ? t('rolling') : "SPIN")
                )
            );
        }

        // --- UPDATED GAME: LIMBO (ODD LOGIC) ---
        function LimboGame({ user, back, showMsg, ArrowIcon, t }) {
            const [target, setTarget] = useState(2.0);
            const [bet, setBet] = useState(100);
            const [result, setResult] = useState(null); 
            const [playing, setPlaying] = useState(false);
            
            const play = async (e) => {
                e.preventDefault();
                if(Number(user.coins) < bet) return showMsg("No Balance", "error");
                setPlaying(true); setResult(null);
                await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)-bet});
                
                const r = Math.random() * 100; // 0.0 to 100.0
                const rawOutcome = 99 / (r + 0.01); 
                const outcome = Math.max(1.00, rawOutcome).toFixed(2);
                let count = 1.00;
                
                const interval = setInterval(() => {
                    count += (Math.random() + (count * 0.1)); 
                    if(count >= outcome) {
                        clearInterval(interval);
                        const isWin = Number(outcome) >= target; 
                        const winAmt = isWin ? Math.floor(bet * target) : 0;
                        setResult({ val: Number(outcome), win: isWin });
                        setPlaying(false);
                        if(isWin) {
                            updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)+winAmt});
                            triggerConfetti();
                        }
                    } else {
                         document.getElementById('limbo-counter').innerText = count.toFixed(2) + 'x';
                    }
                }, 30);
            };

            return React.createElement('div', { className: `fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up` },
                React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900" }, 
                    React.createElement('button', { onClick: back, className: "text-slate-400" }, React.createElement(ArrowIcon)), 
                    React.createElement('span', { className: "font-bold text-orange-500" }, "LIMBO"), 
                    React.createElement('span', { className: "text-xs bg-black px-2 py-1 rounded text-gold-500" }, user.coins)
                ),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-6 text-center relative" },
                    // ODD Badge (Dynamic based on Target)
                    React.createElement(OddsBadge, { value: `${target.toFixed(2)}x`, label: "Target ODD" }),
                    
                    React.createElement('div', { className: "mb-10 relative" },
                        React.createElement('div', { className: "text-xs text-gray-500 font-bold mb-2 uppercase" }, "RESULT"),
                        React.createElement('div', { id: 'limbo-counter', className: `text-7xl font-black font-mono transition-all ${result ? (result.win ? 'text-green-500 drop-shadow-[0_0_20px_#22c55e]' : 'text-red-500 drop-shadow-[0_0_20px_#ef4444]') : 'text-white'}` }, 
                            result ? result.val.toFixed(2)+'x' : "0.00x"
                        ),
                        result && React.createElement('div', { className: `mt-2 font-bold text-xl ${result.win ? 'text-green-400' : 'text-red-400'}` }, 
                            result.win ? "WINNER!" : "CRASHED"
                        )
                    ),
                    React.createElement('div', { className: "w-full h-4 bg-dark-800 rounded-full overflow-hidden relative border border-white/10" },
                        React.createElement('div', { className: "absolute top-0 bottom-0 w-1 bg-white z-10", style: { left: `${Math.min(90, (target/10)*100)}%` } }),
                        React.createElement('div', { className: `h-full transition-all duration-100 ${result?.win ? 'bg-green-500' : 'bg-red-500'}`, style: { width: result ? '100%' : '0%' } })
                    )
                ),
                React.createElement('div', { className: "p-6 bg-dark-900 space-y-4 pb-safe" },
                    React.createElement('div', { className: "flex justify-between text-sm text-gray-400" }, 
                        React.createElement('span',{}, "Target Multiplier (ODD)"), 
                        React.createElement('span',{}, `${target.toFixed(2)}x`)
                    ),
                    React.createElement('input', { type: "range", min: "1.1", max: "10", step: "0.1", value: target, onChange: e=>setTarget(Number(e.target.value)) }),
                    React.createElement('div', { className: "flex gap-4" }, 
                        React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), disabled: playing, className: "w-24 bg-black border border-white/20 rounded-xl text-center text-white font-bold" }), 
                        React.createElement(Button, { full: true, onClick: play, disabled: playing }, t('play'))
                    )
                )
            );
        }

        // --- UPDATED GAME: KENO ---
        function KenoGame({ user, back, showMsg, ArrowIcon, t }) {
            const [selected, setSelected] = useState([]);
            const [drawn, setDrawn] = useState([]);
            const [bet, setBet] = useState(100);
            const [playing, setPlaying] = useState(false);
            const [gameResult, setGameResult] = useState(null);

            const toggle = (n) => {
                if(playing) return;
                if(selected.includes(n)) setSelected(selected.filter(i=>i!==n));
                else if(selected.length < 10) setSelected([...selected, n]);
            }

            const play = async (e) => {
                e.preventDefault();
                if(selected.length === 0) return showMsg("Pick numbers", "error");
                if(Number(user.coins) < bet) return showMsg("No Balance", "error");
                setPlaying(true); setDrawn([]); setGameResult(null);
                await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)-bet});
                const draws = [];
                while(draws.length < 10) {
                    const r = Math.ceil(Math.random() * 40);
                    if(!draws.includes(r)) draws.push(r);
                }
                let i = 0;
                const int = setInterval(() => {
                    setDrawn(prev => [...prev, draws[i]]);
                    i++;
                    if(i >= 10) {
                        clearInterval(int);
                        finish(draws);
                    }
                }, 200); 
            };

            const finish = async (finalDraws) => {
                const matches = selected.filter(s => finalDraws.includes(s)).length;
                let mult = 0;
                if(matches >= 3) mult = 1.5;
                if(matches >= 5) mult = 3;
                if(matches >= 7) mult = 10;
                if(matches >= 9) mult = 50;
                const win = Math.floor(bet * mult);
                setGameResult({ hits: matches, win: win });
                setPlaying(false);
                if(win > 0) {
                    await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)+win});
                    triggerConfetti();
                }
            };

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up" },
                React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900" }, 
                    React.createElement('button', { onClick: back, className: "text-slate-400" }, React.createElement(ArrowIcon)), 
                    React.createElement('span', { className: "font-bold text-emerald-500" }, "KENO"), 
                    React.createElement('span', { className: "text-xs bg-black px-2 py-1 rounded text-gold-500" }, user.coins)
                ),
                gameResult && React.createElement('div', { className: "absolute inset-0 z-20 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fade-in", onClick: ()=>setGameResult(null) },
                    React.createElement('div', { className: "bg-dark-900 p-8 rounded-2xl border border-white/20 text-center animate-pop" },
                        React.createElement('h2', { className: "text-2xl font-black text-white mb-2" }, gameResult.win > 0 ? "WINNER!" : "TRY AGAIN"),
                        React.createElement('p', { className: "text-gray-400 mb-4" }, `${gameResult.hits} Hits`),
                        gameResult.win > 0 && React.createElement('p', { className: "text-4xl font-mono text-green-500 font-bold" }, `+${gameResult.win}`),
                        React.createElement('button', { className: "mt-6 text-sm text-gray-500 underline" }, "Tap to close")
                    )
                ),
                React.createElement('div', { className: "flex-1 p-4 flex flex-col items-center justify-center relative" },
                    // ODD Badge
                    React.createElement(OddsBadge, { value: "Up to 50x", label: "Max ODD" }),
                    React.createElement('div', { className: "grid grid-cols-5 gap-2 w-full max-w-sm" },
                        Array(40).fill(0).map((_, i) => {
                            const n = i+1;
                            const isSel = selected.includes(n);
                            const isDrawn = drawn.includes(n);
                            const isHit = isSel && isDrawn;
                            let classes = "h-10 rounded-lg font-bold text-sm transition-all duration-300 ";
                            if (isHit) classes += "bg-green-500 text-black scale-110 shadow-[0_0_15px_#22c55e] z-10 animate-pop";
                            else if (isDrawn) classes += "bg-red-900/50 text-red-200";
                            else if (isSel) classes += "bg-white text-black";
                            else classes += "bg-dark-800 text-gray-600";
                            return React.createElement('button', { key: n, onClick: ()=>toggle(n), className: classes }, n);
                        })
                    )
                ),
                React.createElement('div', { className: "p-4 bg-dark-900 flex gap-4 pb-safe border-t border-white/10" }, 
                    React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), disabled: playing, className: "w-24 bg-black border border-white/20 rounded-xl text-center text-white font-bold" }), 
                    React.createElement(Button, { full: true, onClick: play, disabled: playing }, playing ? "Drawing..." : "PLAY")
                )
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
