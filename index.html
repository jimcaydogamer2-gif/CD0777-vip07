<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CD0777 Royal Club - Casino Enhanced</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gold: { 100: '#FFF9C4', 300: '#FDD835', 400: '#FFD700', 500: '#FFC107', 600: '#FFB300', 700: '#FFA000', 800: '#C0A000', 900: '#3d2e07' },
                        dark: { 950: '#020617', 900: '#0f172a', 800: '#1e293b' }
                    },
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif'],
                        mono: ['Share Tech Mono', 'monospace'],
                        oswald: ['Oswald', 'sans-serif']
                    },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'shake-hard': 'shakeHard 0.4s ease-in-out',
                        'flip': 'flip 0.6s ease-in-out forwards',
                        'fade-in': 'fadeIn 1s ease-out forwards',
                        'pulse-glow': 'pulseGlow 1.5s infinite',
                        'slide-up': 'slideUp 0.3s ease-out forwards'
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        shakeHard: { '0%, 100%': { transform: 'translateX(0)' }, '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-5px)' }, '20%, 40%, 60%, 80%': { transform: 'translateX(5px)' } },
                        flip: { '0%': { transform: 'rotateY(0)' }, '100%': { transform: 'rotateY(180deg)' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 10px #FFD700' }, '50%': { boxShadow: '0 0 25px #FFD700' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Oswald:wght@500&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        body { background-color: #020617; color: #fff; overflow: hidden; touch-action: manipulation; }
        .glass-panel { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(16px); border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .gold-glow { text-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
        .luxury-bg { background-image: radial-gradient(circle at center, #1e293b 0%, #000 100%); }
        input, select, button { outline: none; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 0px; }
        
        /* 3D Card Flip Essentials */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }

        /* Effects */
        .confetti-piece { position: absolute; width: 10px; height: 10px; background: #FFD700; animation: fall 3s linear forwards; pointer-events: none; z-index: 100; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.294.0",
                "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
            }
        }
    </script>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { User, Gamepad2, LogOut, Send, CheckCircle, XCircle, ChevronRight, ChevronLeft, Lock, Gem, Home, CreditCard, Wallet, ShieldCheck, Trophy, Instagram, Facebook, ExternalLink, Plus, Trash2, Smartphone, Zap, Check, Dices, RefreshCw, Menu, X, AlertTriangle, Settings, History, Globe, FileText, LifeBuoy, ArrowLeftRight, Bomb, ArrowUp, HelpCircle, Flame, Timer } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, where, getDocs, orderBy, setDoc, getDoc } from 'firebase/firestore';

        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDJ5B7MncMfyjwb0ZnZ8p3d0bsoQAFqZQY",
            authDomain: "cd0777-casino.firebaseapp.com",
            projectId: "cd0777-casino",
            storageBucket: "cd0777-casino.firebasestorage.app",
            messagingSenderId: "320546250152",
            appId: "1:320546250152:web:730f6e581267b9b315919d"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- CONSTANTS ---
        const COUNTRIES = [
            { code: 'MA', name: 'Morocco', dial: '+212', flag: 'ðŸ‡²ðŸ‡¦' },
            { code: 'DZ', name: 'Algeria', dial: '+213', flag: 'ðŸ‡©ðŸ‡¿' },
            { code: 'EG', name: 'Egypt', dial: '+20', flag: 'ðŸ‡ªðŸ‡¬' },
            { code: 'SA', name: 'Saudi Arabia', dial: '+966', flag: 'ðŸ‡¸ðŸ‡¦' },
            { code: 'AE', name: 'UAE', dial: '+971', flag: 'ðŸ‡¦ðŸ‡ª' },
            { code: 'KW', name: 'Kuwait', dial: '+965', flag: 'ðŸ‡°ðŸ‡¼' },
            { code: 'QA', name: 'Qatar', dial: '+974', flag: 'ðŸ‡¶ðŸ‡¦' },
            { code: 'US', name: 'USA', dial: '+1', flag: 'ðŸ‡ºðŸ‡¸' },
            { code: 'EU', name: 'Europe', dial: '+', flag: 'ðŸŒ' }
        ];

        const TEXTS = {
            ar: {
                welcome: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ", login: "Ø¯Ø®ÙˆÙ„", register: "ØªØ³Ø¬ÙŠÙ„",
                name: "Ø§Ù„Ø§Ø³Ù…", phone: "Ø§Ù„Ù‡Ø§ØªÙ", user: "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", pass: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
                country: "Ø§Ù„Ø¯ÙˆÙ„Ø©", home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", casino: "ÙƒØ§Ø²ÙŠÙ†Ùˆ", tasks: "Ø§Ù„Ù…Ù‡Ø§Ù…", wallet: "Ø§Ù„Ù…Ø­ÙØ¸Ø©",
                balance: "Ø§Ù„Ø±ØµÙŠØ¯", id: "Ø§Ù„Ù…Ø¹Ø±Ù", active: "Ù†Ø´Ø·", review: "Ù…Ø±Ø§Ø¬Ø¹Ø©",
                play: "Ù„Ø¹Ø¨", withdraw: "Ø³Ø­Ø¨", convert: "ØªØ­ÙˆÙŠÙ„",
                crash: "ØµØ§Ø±ÙˆØ®", plinko: "Ø¥Ø³Ù‚Ø§Ø·", mines: "Ø§Ù„Ø£Ù„ØºØ§Ù…",
                menu: "Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©", lang: "Ø§Ù„Ù„ØºØ©", confirm: "ØªØ£ÙƒÙŠØ¯", cancel: "Ø¥Ù„ØºØ§Ø¡",
                inputs_err: "Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©", success: "ØªÙ… Ø¨Ù†Ø¬Ø§Ø­", no_balance: "Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ",
                support: "Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ", help: "Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©", terms: "Ø§Ù„Ø´Ø±ÙˆØ·", policy: "Ø§Ù„Ø³ÙŠØ§Ø³Ø©",
                conv_rate: "1000 Ù†Ù‚Ø·Ø© = 1$", from_usd: "Ù…Ù† Ø¯ÙˆÙ„Ø§Ø± Ø¥Ù„Ù‰ Ù†Ù‚Ø§Ø·", from_pts: "Ù…Ù† Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ø¯ÙˆÙ„Ø§Ø±",
                mines_desc: "Ø§Ø­Ø°Ø± Ø§Ù„Ù…ØªÙØ¬Ø±Ø§Øª", next_round: "Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©", bet: "Ø±Ø§Ù‡Ù†",
                max_bet: "Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø±Ù‡Ø§Ù†"
            },
            en: {
                welcome: "Welcome", login: "Login", register: "Register",
                name: "Name", phone: "Phone", user: "User", pass: "Pass",
                country: "Country", home: "Home", casino: "Casino", tasks: "Tasks", wallet: "Wallet",
                balance: "Balance", id: "ID", active: "Active", review: "Review",
                play: "Play", withdraw: "Withdraw", convert: "Convert",
                crash: "Crash", plinko: "Plinko", mines: "Mines",
                menu: "Menu", lang: "Language", confirm: "Confirm", cancel: "Cancel",
                inputs_err: "Missing info", success: "Success", no_balance: "Insufficient funds",
                support: "Support", help: "Help", terms: "Terms", policy: "Policy",
                conv_rate: "1000 Pts = $1", from_usd: "USD to Points", from_pts: "Points to USD",
                mines_desc: "Avoid the bombs", next_round: "Next Round", bet: "Bet",
                max_bet: "Max Bet is"
            }
        };

        const LINKS = {
            TELEGRAM: "https://t.me/cd0777cc",
            ONEXBET: "https://1xlite-81807.bar/mobile?bf=cb1696c403824_11662230653",
            INSTAGRAM: "https://www.instagram.com/p/DSEHfeWiAWo/?igsh=bWMxZTMxcGJoMWx6",
            FACEBOOK: "https://www.facebook.com/share/p/17gNCDYUYs/"
        };

        // --- COMPONENTS ---
        const Button = ({ children, onClick, disabled, variant='gold', full, className='' }) => {
            const styles = {
                gold: 'bg-gradient-to-b from-[#FFD700] to-[#B8860B] text-black shadow-lg shadow-yellow-900/40 border border-[#FFD700] hover:brightness-110 active:scale-95',
                green: 'bg-green-600 text-white border border-green-500 shadow-lg active:scale-95',
                red: 'bg-red-600 text-white border border-red-500 shadow-lg active:scale-95',
                dark: 'bg-dark-800 text-gold-500 border border-gold-500/30 active:scale-95'
            };
            return React.createElement('button', { onClick, disabled, className: `relative font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:grayscale disabled:shadow-none disabled:translate-y-0 ${styles[variant]} ${full?'w-full':''} ${className}` }, children);
        };

        const Input = (props) => React.createElement('input', { ...props, className: `w-full bg-dark-900 border border-white/10 p-4 rounded-xl text-white outline-none focus:border-gold-500 transition-all placeholder:text-gray-600 shadow-inner ${props.className}` });

        // --- EFFECTS UTILS ---
        const triggerConfetti = () => {
            const colors = ['#FFD700', '#FFFFFF', '#FFA500'];
            for(let i=0; i<50; i++) {
                const el = document.createElement('div');
                el.className = 'confetti-piece';
                el.style.left = Math.random() * 100 + 'vw';
                el.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                el.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 3000);
            }
        };

        // --- APP ROOT ---
        export default function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('auth'); 
            const [lang, setLang] = useState('ar');
            const [notify, setNotify] = useState(null);
            const [menuOpen, setMenuOpen] = useState(false);
            const [settings, setSettings] = useState({});

            const t = (k) => TEXTS[lang][k] || k;
            
            const isFirstLoad = useRef(true);

            // Fetch Settings
            useEffect(() => {
                if(db) onSnapshot(doc(db, "settings", "global"), (s) => s.exists() && setSettings(s.data()));
            }, []);

            // Auth Listener
            useEffect(() => {
                const uid = localStorage.getItem('cd0777_uid');
                const sl = localStorage.getItem('cd0777_lang');
                if(sl) setLang(sl);

                if (uid && db) {
                    const unsub = onSnapshot(doc(db, "users", uid), (s) => {
                        if (s.exists()) {
                            setUser({ id: s.id, ...s.data() });
                            if (isFirstLoad.current) {
                                setView(s.data().role === 'admin' ? 'admin' : 'home');
                                isFirstLoad.current = false;
                            }
                        } else {
                            setUser(null);
                            localStorage.removeItem('cd0777_uid');
                            setView('auth');
                        }
                    });
                    return () => unsub();
                } else {
                    setView('auth');
                }
            }, []);

            const showMsg = (msg, type='success') => { setNotify({msg, type}); setTimeout(()=>setNotify(null), 3000); };
            const navTo = (v) => { setView(v); setMenuOpen(false); };
            const logout = () => { localStorage.removeItem('cd0777_uid'); setUser(null); setView('auth'); isFirstLoad.current = true; };

            const isRTL = lang === 'ar';
            const ArrowIcon = isRTL ? ChevronRight : ChevronLeft;

            if (!user && view === 'auth') return React.createElement(AuthScreen, { setUser, setView, showMsg, t, lang, setLang });
            if (user?.role === 'admin' && view === 'admin') return React.createElement(AdminPanel, { user, logout });

            // Games Views
            if (view === 'game-crash') return React.createElement(CrashGame, { user, back: ()=>navTo('casino'), showMsg, ArrowIcon, t });
            if (view === 'game-plinko') return React.createElement(PlinkoGame, { user, back: ()=>navTo('casino'), showMsg, ArrowIcon, t });
            if (view === 'game-mines') return React.createElement(MinesGame, { user, back: ()=>navTo('casino'), showMsg, ArrowIcon, t });

            return React.createElement('div', { className: `h-screen flex flex-col bg-dark-950 text-white relative selection:bg-gold-500 selection:text-black`, dir: isRTL ? 'rtl' : 'ltr' },
                notify && React.createElement('div', { className: `fixed top-6 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-xl shadow-2xl border flex items-center gap-2 animate-pop glass-panel w-max ${notify.type==='error'?'bg-red-950/90 border-red-500':'bg-green-950/90 border-green-500'}` }, 
                    notify.type==='success'?React.createElement(CheckCircle,{size:20}):React.createElement(XCircle,{size:20}), React.createElement('span', { className: "font-bold text-sm" }, notify.msg)
                ),
                
                React.createElement(Header, { user, toggleMenu: ()=>setMenuOpen(true) }),
                menuOpen && React.createElement(Sidebar, { user, close: ()=>setMenuOpen(false), navTo, t, lang, setLang, settings, logout }),
                
                React.createElement('main', { className: "flex-1 overflow-y-auto p-5 pb-28 z-10 scrollbar-hide" },
                    view === 'home' && React.createElement(HomeScreen, { user, navTo, t, isRTL, settings }),
                    view === 'casino' && React.createElement(CasinoScreen, { navTo, t }),
                    view === 'tasks' && React.createElement(TasksScreen, { user, showMsg, t }),
                    view === 'profile' && React.createElement(WalletScreen, { user, showMsg, t, isRTL }),
                    view === 'history' && React.createElement(HistoryScreen, { user, t }),
                    view === 'settings' && React.createElement(SettingsScreen, { user, showMsg, t }),
                    view === 'terms' && React.createElement(InfoPage, { title: t('terms'), content: settings.terms || "Terms..." }),
                    view === 'policy' && React.createElement(InfoPage, { title: t('policy'), content: settings.policy || "Policy..." })
                ),

                React.createElement('nav', { className: "fixed bottom-4 left-4 right-4 h-16 glass-panel rounded-2xl z-40 flex justify-around items-center shadow-2xl border border-white/10" },
                    React.createElement(NavBtn, { icon: Home, label: t('home'), active: view==='home', onClick:()=>navTo('home') }),
                    React.createElement(NavBtn, { icon: Dices, label: t('casino'), active: view==='casino', onClick:()=>navTo('casino') }),
                    React.createElement(NavBtn, { icon: Trophy, label: t('tasks'), active: view==='tasks', onClick:()=>navTo('tasks') }),
                    React.createElement(NavBtn, { icon: Wallet, label: t('wallet'), active: view==='profile', onClick:()=>navTo('profile') })
                )
            );
        }

        // --- SUB COMPONENTS ---
        function Header({ user, toggleMenu }) {
            return React.createElement('div', { className: "sticky top-0 z-40 bg-dark-950/80 backdrop-blur-md border-b border-white/5 px-5 py-4 flex justify-between items-center" },
                React.createElement('div', { className: "flex items-center gap-3" },
                    React.createElement('button', { onClick: toggleMenu, className: "p-2 bg-dark-900 rounded-xl text-gold-500 border border-white/5 active:scale-90 transition-transform" }, React.createElement(Menu, { size: 24 })),
                    React.createElement('div', { className: "w-9 h-9 rounded-xl bg-gradient-to-tr from-gold-400 to-gold-600 flex items-center justify-center font-black text-black text-sm shadow-lg" }, "CD")
                ),
                React.createElement('div', { className: "bg-dark-900 border border-white/10 px-4 py-1.5 rounded-full flex items-center gap-2" }, 
                    React.createElement(Gem, { size: 16, className: "text-gold-500 animate-pulse" }), 
                    React.createElement('span', { className: "text-gold-500 font-mono font-bold text-sm" }, user.coins.toLocaleString())
                )
            );
        }

        function Sidebar({ user, close, navTo, t, lang, setLang, settings, logout }) {
            return React.createElement('div', { className: "fixed inset-0 z-50 flex" },
                React.createElement('div', { className: "absolute inset-0 bg-black/80 backdrop-blur-md transition-opacity", onClick: close }),
                React.createElement('div', { className: `relative w-72 bg-dark-900 border-l border-gold-500/20 h-full p-6 shadow-2xl flex flex-col ${lang==='ar'?'animate-slide-in-right':'animate-slide-in-left'}` },
                    React.createElement('div', { className: "flex justify-between items-center mb-8 border-b border-white/10 pb-4" }, React.createElement('h2',{className:"text-gold-500 font-bold text-2xl"}, t('menu')), React.createElement('button',{onClick:close},React.createElement(X, {className:"text-gray-400"}))),
                    React.createElement('nav', { className: "space-y-2 flex-1 overflow-y-auto" },
                        React.createElement(SidebarBtn, { icon: Home, label: t('home'), onClick:()=>navTo('home') }),
                        React.createElement(SidebarBtn, { icon: Dices, label: t('casino'), onClick:()=>navTo('casino') }),
                        React.createElement(SidebarBtn, { icon: Wallet, label: t('wallet'), onClick:()=>navTo('profile') }),
                        React.createElement('div', {className:"h-px bg-white/5 my-3"}),
                        React.createElement(SidebarBtn, { icon: History, label: t('history'), onClick:()=>navTo('history') }),
                        React.createElement(SidebarBtn, { icon: Settings, label: t('settings'), onClick:()=>navTo('settings') }),
                        React.createElement('div', {className:"h-px bg-white/5 my-3"}),
                        settings.support && React.createElement(SidebarBtn, { icon: LifeBuoy, label: t('support'), onClick:()=>window.open(settings.support) }),
                        settings.help && React.createElement(SidebarBtn, { icon: HelpCircle, label: t('help'), onClick:()=>window.open(settings.help) }),
                        React.createElement('button', { onClick: ()=>{const l=lang==='ar'?'en':'ar'; setLang(l); localStorage.setItem('cd0777_lang',l);}, className: "w-full flex items-center justify-between p-3.5 rounded-xl text-gray-300 hover:bg-white/5 mt-4 border border-white/5" }, React.createElement('div', {className:"flex gap-4"}, React.createElement(Globe), t('lang')), React.createElement('span', {className:"text-gold-500 text-xs bg-black px-2 py-1 rounded"}, lang==='ar'?'English':'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'))
                    ),
                    React.createElement('button', { onClick:logout, className: "mt-auto w-full flex items-center justify-center gap-2 text-red-400 p-4 bg-red-900/10 rounded-2xl font-bold border border-red-900/30" }, React.createElement(LogOut), t('logout'))
                )
            );
        }
        const SidebarBtn = ({ icon: Icon, label, onClick }) => React.createElement('button', { onClick, className: "w-full flex items-center gap-4 p-3.5 rounded-xl text-gray-300 hover:bg-white/5" }, React.createElement(Icon, { size: 20 }), React.createElement('span', {}, label));
        const NavBtn = ({ icon: Icon, label, active, onClick }) => React.createElement('button', { onClick, className: `flex flex-col items-center gap-1 ${active?'text-gold-500 -translate-y-1 scale-110':'text-gray-500'}` }, React.createElement(Icon, { size: 24, strokeWidth: active?2.5:2 }), React.createElement('span', { className: "text-[9px] font-bold" }, label));

        // --- AUTH ---
        function AuthScreen({ setUser, setView, showMsg, t, lang, setLang }) {
            const [isReg, setIsReg] = useState(false); const [country, setCountry] = useState(COUNTRIES[0]); const [f, setF] = useState({ u:'', p:'', n:'', ph:'' });
            const submit = async () => {
                if(!f.u || !f.p) return showMsg(t('inputs_err'), 'error');
                if(f.u==='admin' && f.p==='admin123') { localStorage.setItem('cd0777_uid', 'admin'); setUser({role:'admin'}); setView('admin'); return; }
                try {
                    if(isReg) {
                        const q = query(collection(db, "users"), where("username", "==", f.u)); if(!(await getDocs(q)).empty) throw new Error('Exists');
                        const sz = (await getDocs(collection(db, "users"))).size;
                        const nu = { username: f.u, password: f.p, fullName: f.n, phone: `${country.dial}${f.ph}`, country: country.name, memberId: `CD${1001+sz}`, role: 'user', status: 'pending', coins: 100, balance: 0, completedTasks: [] };
                        const ref = await addDoc(collection(db, "users"), nu); localStorage.setItem('cd0777_uid', ref.id); setUser({id:ref.id, ...nu}); setView('home');
                    } else {
                        const q = query(collection(db, "users"), where("username", "==", f.u), where("password", "==", f.p)); const s = await getDocs(q);
                        if(s.empty) throw new Error('Error'); const d=s.docs[0]; localStorage.setItem('cd0777_uid', d.id); setUser({id:d.id, ...d.data()}); setView('home');
                    }
                } catch(e) { showMsg(e.message, 'error'); }
            };
            return React.createElement('div', { className: "h-full flex flex-col items-center justify-center p-6 bg-dark-950 luxury-bg relative", dir: lang==='ar'?'rtl':'ltr' },
                React.createElement('button', { onClick: ()=>setLang(lang==='ar'?'en':'ar'), className: "absolute top-6 right-6 text-xs bg-white/10 px-3 py-1 rounded-full text-gold-500 font-bold" }, lang.toUpperCase()),
                React.createElement('div', { className: "w-32 h-32 rounded-3xl bg-gradient-to-tr from-gold-400 to-gold-700 flex items-center justify-center text-6xl font-black text-black mb-10 shadow-2xl shadow-gold-500/20 animate-pop border-4 border-gold-300" }, "CD"),
                React.createElement('div', { className: "w-full max-w-sm space-y-5 animate-fade-in" },
                    React.createElement('h1', { className: "text-3xl font-bold text-center text-gold-500 mb-8 font-oswald tracking-widest uppercase" }, isReg ? t('register') : t('login')),
                    isReg && React.createElement(Input, { placeholder: t('name'), onChange: e=>setF({...f,n:e.target.value}) }),
                    isReg && React.createElement('div', { className: "flex gap-2" }, React.createElement('select', { className: "bg-dark-900 border border-white/10 p-4 rounded-xl text-white w-24", onChange: e=>setCountry(COUNTRIES[e.target.value]) }, COUNTRIES.map((c,i)=>React.createElement('option',{key:i,value:i},c.flag))), React.createElement(Input, { placeholder: t('phone'), onChange: e=>setF({...f,ph:e.target.value}) })),
                    React.createElement(Input, { placeholder: t('user'), onChange: e=>setF({...f,u:e.target.value}) }),
                    React.createElement(Input, { type: "password", placeholder: t('pass'), onChange: e=>setF({...f,p:e.target.value}) }),
                    React.createElement(Button, { full: true, onClick: submit }, isReg?t('register'):t('login')),
                    React.createElement('button', { onClick: ()=>setIsReg(!isReg), className: "w-full text-center text-xs text-slate-500 mt-4 hover:text-gold-500 transition-colors" }, isReg?t('haveAcc'):t('noAcc'))
                )
            );
        }

        // --- HOME ---
        function HomeScreen({ user, navTo, t, isRTL }) {
            const isPending = user.status === 'pending';
            return React.createElement('div', { className: "space-y-6 animate-pop" },
                React.createElement('div', { className: "relative aspect-[1.58/1] rounded-2xl overflow-hidden shadow-2xl border border-white/10 hover:border-gold-500/40 transition-all transform hover:rotate-1" },
                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-br from-dark-900 to-black" }),
                    React.createElement('div', { className: "absolute inset-0 opacity-20", style:{backgroundImage:'radial-gradient(#C0A000 1px, transparent 1px)', backgroundSize:'20px 20px'} }),
                    React.createElement('div', { className: "relative z-10 h-full p-6 flex flex-col justify-between" },
                        React.createElement('div', { className: "flex justify-between items-start" },
                            React.createElement('div', { className: "flex items-center gap-2" }, React.createElement(ShieldCheck, { className: "text-gold-500", size: 26 }), React.createElement('h2', { className: "text-gold-500 font-oswald text-xl tracking-widest" }, "CD0777")),
                            React.createElement('div', { className: `px-3 py-1 rounded-full text-[9px] font-black tracking-wider border ${!isPending?'border-green-500 text-green-400':'border-yellow-600 text-yellow-500'}` }, !isPending ? t('active') : t('review'))
                        ),
                        React.createElement('div', { className: "flex justify-between items-center" },
                            React.createElement('div', {}, React.createElement('p', { className: "text-gray-400 text-[8px] uppercase tracking-widest mb-1 font-bold" }, t('balance')), React.createElement('p', { className: "font-mono text-3xl text-white flex gap-1" }, React.createElement('span', { className: "text-gold-500" }, "$"), Number(user.balance).toFixed(2))),
                            React.createElement('div', { className: "text-right" }, React.createElement('p', { className: "text-[7px] text-gold-600 uppercase mb-1 font-bold" }, t('id')), React.createElement('p', { className: "font-mono text-lg text-white border-gold-500 px-2 border-r-2" }, user.memberId))
                        ),
                        React.createElement('div', { className: "flex justify-between items-end" }, React.createElement('div', {}, React.createElement('p', { className: "text-[7px] text-gold-600 uppercase mb-0.5 font-bold" }, t('holder')), React.createElement('p', { className: "font-mono text-gray-200 text-sm tracking-widest uppercase" }, user.fullName)))
                    )
                ),
                React.createElement('button', { onClick: ()=>navTo('casino'), className: "w-full h-28 relative rounded-2xl overflow-hidden group active:scale-95 transition-all border border-white/5 hover:border-gold-500/40 shadow-xl" },
                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-r from-purple-900/80 to-indigo-900/80" }),
                    React.createElement('div', { className: "absolute inset-0 flex items-center justify-between p-6" },
                        React.createElement('div', {}, React.createElement('h3', { className: "text-2xl font-black italic text-white mb-1 drop-shadow-md" }, "PLAY & WIN"), React.createElement('p', { className: "text-xs text-purple-200 font-bold" }, t('play'))),
                        React.createElement(Gamepad2, { size: 50, className: "text-white/20" })
                    )
                ),
                isPending && React.createElement('div', { className: "space-y-2" },
                    React.createElement('button', { onClick: ()=>window.open(LINKS.ONEXBET), className: "w-full bg-[#1a2b3c] p-4 rounded-2xl flex items-center gap-4 border border-white/5 active:scale-95 transition-all shadow-lg group hover:border-gold-500/50" },
                        React.createElement('div', { className: "w-10 h-10 bg-white rounded-lg flex items-center justify-center font-black text-[#1a2b3c] text-xs shadow-md" }, "1X"),
                        React.createElement('div', { className: "text-right flex-1" }, React.createElement('div', { className: "font-bold text-white text-sm" }, "ØªÙØ¹ÙŠÙ„ 1XBET"), React.createElement('div', { className: "text-[10px] text-blue-200" }, "ÙƒÙˆØ¯: CD0777")), React.createElement(ExternalLink, { size: 18, className: "text-gray-500" })
                    ),
                    React.createElement('button', { onClick: ()=>window.open(LINKS.TELEGRAM), className: "w-full bg-[#229ED9]/10 p-4 rounded-2xl flex items-center gap-4 border border-white/5 active:scale-95 transition-all shadow-lg group hover:border-gold-500/50" },
                        React.createElement('div', { className: "w-10 h-10 bg-[#229ED9] rounded-lg flex items-center justify-center text-white shadow-md" }, React.createElement(Send, { size: 18 })),
                        React.createElement('div', { className: "text-right flex-1" }, React.createElement('div', { className: "font-bold text-white text-sm" }, "Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…"), React.createElement('div', { className: "text-[10px] text-gray-400" }, "Ù…Ø·Ù„ÙˆØ¨")), React.createElement(ExternalLink, { size: 18, className: "text-gray-500" })
                    )
                )
            );
        }

        // --- CASINO ---
        function CasinoScreen({ navTo, t }) {
            return React.createElement('div', { className: "space-y-4 animate-pop" },
                React.createElement('h2', { className: "text-gold-500 font-bold text-lg flex gap-2 items-center" }, React.createElement(Dices), t('casino')),
                React.createElement('div', { className: "grid gap-4" },
                    React.createElement(GameCard, { title:t('crash'), sub:"ROCKET â€¢ LIVE", color:"red", icon:Zap, onClick:()=>navTo('game-crash') }),
                    React.createElement(GameCard, { title:t('plinko'), sub:"DROP â€¢ HIGH WIN", color:"purple", icon:Gem, onClick:()=>navTo('game-plinko') }),
                    React.createElement(GameCard, { title:t('mines'), sub:TEXTS.ar.mines_desc, color:"emerald", icon:Bomb, onClick:()=>navTo('game-mines') })
                )
            );
        }
        const GameCard = ({ title, sub, color, icon: Icon, onClick }) => React.createElement('button', { onClick, className: `relative h-44 rounded-2xl overflow-hidden border border-white/5 bg-dark-800 hover:border-${color}-500/50 transition-all group w-full text-right active:scale-95 shadow-lg` }, React.createElement('div', { className: `absolute inset-0 bg-gradient-to-t from-${color}-900/80 to-transparent` }), React.createElement('div', { className: `absolute top-4 left-4 text-${color}-500/20 group-hover:text-${color}-500/40 transition-colors transform group-hover:scale-110 duration-500` }, React.createElement(Icon, { size: 90 })), React.createElement('div', { className: "absolute bottom-5 right-5 z-10" }, React.createElement('h3', { className: "text-4xl font-black text-white italic drop-shadow-md" }, title), React.createElement('p', { className: `text-xs text-${color}-300 font-bold uppercase tracking-widest` }, sub)));

        // --- ENHANCED GAMES ---
        
        // 1. Crash (Simulation Loop + Live Feel - Fixed Timer/Betting)
        function CrashGame({ user, back, showMsg, ArrowIcon, t }) {
            const cvsRef = useRef(null); 
            const [bet, setBet] = useState(100); 
            const [status, setStatus] = useState('CONNECTING'); // CONNECTING, COUNTDOWN, RUNNING, CRASHED
            const [cashed, setCashed] = useState(false);
            const [timer, setTimer] = useState(0);
            const [nextBet, setNextBet] = useState(0); // Bet for NEXT round
            const [activeBet, setActiveBet] = useState(0); // Bet for CURRENT round
            const [winAmt, setWinAmt] = useState(0);
            const gm = useRef({s:0, c:0, a:null, m:1.0});
            const [fakeTick, setFakeTick] = useState("CD8832 Joined...");
            
            // Timer Ref to avoid closures issues
            const timerRef = useRef(null);

            // Fake Live Feed
            useEffect(() => {
                const interval = setInterval(() => {
                    const ids = ['CD9921', 'CD1022', 'CD8744', 'CD3321', 'CD5512'];
                    const acts = ['Won 200C', 'Bet 500C', 'Cashed 1.2x', 'Lost'];
                    const rId = ids[Math.floor(Math.random()*ids.length)];
                    const rAct = acts[Math.floor(Math.random()*acts.length)];
                    setFakeTick(`${rId} ${rAct}`);
                }, 2000);
                return () => clearInterval(interval);
            }, []);

            // Game Logic
            useEffect(() => {
                startCountDown();
                return () => { 
                    cancelAnimationFrame(gm.current.a); 
                    clearInterval(timerRef.current);
                };
            }, []);

            const startCountDown = () => {
                setStatus('COUNTDOWN');
                let count = 5;
                setTimer(count);
                
                if(timerRef.current) clearInterval(timerRef.current);
                
                timerRef.current = setInterval(() => {
                    count--;
                    setTimer(count);
                    if(count <= 0) {
                        clearInterval(timerRef.current);
                        beginFlight();
                    }
                }, 1000);
            };

            const beginFlight = () => {
                // Check for next bet
                // Access state via a trick or check the DOM input? No, we use a ref if needed, but here we can just check state logic
                // React state inside interval might be stale, so we rely on the state update triggering a re-eval in a robust way? 
                // Actually, since we trigger beginFlight from the interval closure, 'nextBet' might be stale.
                // We will use a ref for nextBet.
                
                const currentNextBet = Number(document.getElementById('hidden-next-bet').value || 0);
                
                if (currentNextBet > 0) {
                    if (Number(user.coins) >= currentNextBet) {
                        updateDoc(doc(db, "users", user.id), { coins: Number(user.coins) - currentNextBet });
                        setActiveBet(currentNextBet);
                        setNextBet(0); // Clear next bet
                    } else {
                        setActiveBet(0);
                        showMsg(t('no_balance'), 'error');
                    }
                } else {
                    setActiveBet(0);
                }

                setCashed(false);
                setStatus('RUNNING');
                
                let multiplierLimit = 0.99/(1-Math.random());
                if(Math.random()<0.05) multiplierLimit=1.0; 
                if(multiplierLimit>50) multiplierLimit=50;
                
                gm.current = { s: Date.now(), c: Math.max(1.0, multiplierLimit), a: null, m: 1.0 };
                loop();
            };

            const loop = () => { 
                const ctx = cvsRef.current?.getContext('2d'); 
                if(!ctx) return; 
                const { width: w, height: h } = cvsRef.current; 
                const el = (Date.now() - gm.current.s) / 1000; 
                const nm = 1.0 + el * el * 0.1 + el * 0.05; 
                gm.current.m = nm; 
                
                if(nm >= gm.current.c) { 
                    setStatus('CRASHED'); 
                    draw(ctx, w, h, gm.current.c, true); 
                    setTimeout(() => startCountDown(), 3000);
                    return; 
                } 
                draw(ctx, w, h, nm, false); 
                gm.current.a = requestAnimationFrame(loop); 
            };

            const handleBetClick = () => {
                if(Number(user.coins) < bet) return showMsg(t('no_balance'), 'error');
                
                if (status === 'COUNTDOWN') {
                    // Bet for current round
                    setNextBet(bet); // Will be picked up by beginFlight
                    showMsg("Bet Placed", "success");
                } else {
                    // Bet for NEXT round
                    setNextBet(bet);
                    showMsg("Bet queued for next round", "success");
                }
            };

            const cash = async () => { 
                if(status!=='RUNNING'||cashed||activeBet===0) return; 
                const w = Math.floor(activeBet * gm.current.m); 
                await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins) + w}); 
                setCashed(true); 
                setWinAmt(w); 
                triggerConfetti(); 
                showMsg(`${TEXTS.ar.success} +${w}`); 
            };
            
            const draw = (ctx, w, h, val, isCr) => { 
                ctx.fillStyle = '#020617'; ctx.fillRect(0,0,w,h);
                // Grid
                ctx.strokeStyle = '#1e293b'; ctx.lineWidth = 1;
                for(let i=0; i<w; i+=40) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,h); ctx.stroke(); }
                for(let i=0; i<h; i+=40) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(w,i); ctx.stroke(); }
                
                // Text
                if (status === 'RUNNING' || status === 'CRASHED') {
                    ctx.fillStyle = isCr ? '#ef4444' : (cashed ? '#10b981' : '#fff'); 
                    ctx.font = 'bold 60px monospace'; ctx.textAlign = 'center'; 
                    ctx.fillText(`${val.toFixed(2)}x`, w/2, h/2);
                    if(isCr) { ctx.font='20px Cairo'; ctx.fillStyle='#ef4444'; ctx.fillText('CRASHED', w/2, h/2+40); }
                }

                // Graph
                if (status === 'RUNNING' || status === 'CRASHED') {
                    const t = Math.min((val-1)/5, 1); 
                    const x = t*(w*0.8); 
                    const y = h - t*(h*0.8); 
                    ctx.beginPath(); ctx.moveTo(0,h); ctx.quadraticCurveTo(w/4, h, x, y); 
                    ctx.strokeStyle = isCr ? '#ef4444' : (cashed ? '#10b981' : '#FFD700'); ctx.lineWidth = 5; ctx.stroke(); 
                    
                    if(!isCr) {
                        ctx.save(); ctx.translate(x,y); ctx.rotate(-Math.PI/4); ctx.font='30px serif'; ctx.fillText('ðŸš€',0,0); ctx.restore();
                    } else {
                        ctx.font='40px serif'; ctx.fillText('ðŸ’¥', x, y);
                    }
                }
            };
            
            useEffect(()=>{ if(cvsRef.current){cvsRef.current.width=cvsRef.current.offsetWidth; cvsRef.current.height=cvsRef.current.offsetHeight;} },[]);
            
            return React.createElement('div', { className: `fixed inset-0 bg-dark-950 z-50 flex flex-col h-full ${status==='CRASHED'?'animate-shake-hard':''}` }, 
                // Hidden input to bridge state to interval loop
                React.createElement('input', { id: 'hidden-next-bet', type: 'hidden', value: nextBet }),
                
                React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900 border-b border-white/5 shrink-0" }, React.createElement('button', { onClick: back, className: "text-slate-400 active:scale-90" }, React.createElement(ArrowIcon)), React.createElement('div',{className:"flex flex-col items-center"}, React.createElement('span', { className: "font-bold text-gold-500 tracking-widest" }, "CRASH LIVE"), React.createElement('span', { className: "text-[10px] text-gray-500 animate-pulse" }, fakeTick)), React.createElement('span', { className: "text-xs font-mono bg-black px-2 py-1 rounded text-gold-500" }, user.coins)), 
                
                React.createElement('div', { className: "flex-1 relative w-full" }, 
                    React.createElement('canvas', { ref: cvsRef, className: "w-full h-full block" }), 
                    
                    // Countdown Overlay - Completely separate layer
                    status==='COUNTDOWN' && React.createElement('div',{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-20 backdrop-blur-sm"}, 
                        React.createElement('div',{className:"text-gold-500 text-xl font-bold mb-2"}, "NEXT ROUND IN"),
                        React.createElement('div',{className:"text-8xl font-black text-white animate-pop font-mono"}, timer)
                    ),

                    // Win Overlay
                    cashed && React.createElement('div',{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none z-10 bg-black/20"},React.createElement('div',{className:"text-green-500 text-6xl font-black animate-pop"},"WIN"), React.createElement('div',{className:"text-white text-3xl font-mono mt-4 font-bold"}, `+${winAmt}`))
                ), 
                
                React.createElement('div', { className: "p-4 bg-dark-900 border-t border-white/10 flex gap-4 shrink-0 pb-safe z-30 relative" }, 
                    React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), className: "w-24 bg-black border border-white/20 rounded-xl text-center text-white font-bold" }), 
                    status === 'RUNNING' && activeBet > 0 && !cashed ? 
                        React.createElement(Button, { full: true, variant: "green", onClick: cash }, t('withdraw') + ` (${(activeBet * gm.current.m).toFixed(0)})`) 
                        : React.createElement(Button, { full: true, disabled: nextBet > 0, onClick: handleBetClick }, nextBet > 0 ? "Bet Queued..." : (status === 'RUNNING' ? "Bet (Next Round)" : "Bet"))
                )
            );
        }

        // 2. Plinko (Max Bet 100 limit added)
        function PlinkoGame({ user, back, showMsg, ArrowIcon, t }) {
            const cvsRef = useRef(null); const [bet, setBet] = useState(100); const eng = useRef({ balls: [] });
            
            const drop = async () => { 
                if(bet > 100) return showMsg(t('max_bet') + ' 100', 'error');
                if(Number(user.coins) < bet) return showMsg(t('no_balance'), 'error'); 
                await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)-bet}); 
                eng.current.balls.push({x:cvsRef.current.width/2+(Math.random()*4-2), y:30, vx:Math.random()*2-1, vy:0, bet, trail:[], done: false}); 
            };
            
            useEffect(() => { 
                const cvs=cvsRef.current; if(!cvs) return; 
                cvs.width=cvs.offsetWidth; cvs.height=cvs.offsetHeight; 
                const ctx=cvs.getContext('2d'); const {width:w,height:h}=cvs; 
                const ROWS=10; const GAP=w/(ROWS+2); 
                const pegs=[]; for(let r=0;r<ROWS;r++) for(let c=0;c<=r;c++) pegs.push({x:w/2+(c-r/2)*GAP, y:50+r*GAP}); 
                const buckets=[10, 5, 2, 1.5, 1.2, 1.2, 1.5, 2, 5, 10].map((v,i)=>({x:(w-10*GAP)/2+i*GAP, y:50+ROWS*GAP+30, w:GAP, h:40, v, active:0})); 
                let anim; 
                
                const update=()=>{ 
                    ctx.clearRect(0,0,w,h); 
                    ctx.fillStyle='#fff'; pegs.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,3,0,Math.PI*2);ctx.fill()}); 
                    buckets.forEach(b=>{ 
                        if(b.active > 0) b.active--;
                        const isFlash = b.active > 0;
                        const c = isFlash ? '#fff' : (b.v<1 ? '#222' : (b.v>=5 ? '#9333ea' : '#eab308')); 
                        if(isFlash) { ctx.shadowBlur=30; ctx.shadowColor='#FFD700'; } else { ctx.shadowBlur=0; }
                        ctx.fillStyle=c; 
                        const hMod = isFlash ? 5 : 0;
                        ctx.fillRect(b.x+2,b.y-hMod,b.w-4,b.h+hMod); 
                        ctx.fillStyle= isFlash ? '#000' : '#fff'; ctx.font='bold 10px Arial'; ctx.textAlign='center'; ctx.fillText(`${b.v}x`, b.x+b.w/2, b.y+24); 
                        ctx.shadowBlur=0; 
                    }); 
                    eng.current.balls.forEach((b, idx)=>{ 
                        if(b.done) return;
                        b.vy+=0.25; b.vx*=0.98; b.x+=b.vx; b.y+=b.vy; 
                        b.trail.push({x:b.x, y:b.y}); if(b.trail.length>10) b.trail.shift();
                        pegs.forEach(p=>{
                            const dist = Math.sqrt((b.x-p.x)**2+(b.y-p.y)**2);
                            if(dist<8){
                                const bias = (w/2 - b.x) * 0.02; 
                                b.vx=(Math.random()-0.5)*4 + bias; 
                                b.vy*=0.6; b.y+=2; 
                                ctx.fillStyle='#fff'; ctx.beginPath();ctx.arc(p.x,p.y,5,0,Math.PI*2);ctx.fill(); 
                            }
                        }); 
                        if(b.y > 50+ROWS*GAP+10) {
                            const hit = buckets.find(k=>b.x>k.x && b.x<k.x+k.w);
                            if(hit) {
                                hit.active = 20; 
                                b.done = true; 
                                const win = Math.floor(b.bet * hit.v);
                                updateDoc(doc(db,"users",user.id),{coins: Number(user.coins) + win});
                                if(win > b.bet) { showMsg(`+${win}`, 'success'); triggerConfetti(); }
                            }
                        }
                        ctx.strokeStyle='rgba(234, 179, 8, 0.5)'; ctx.lineWidth=2; ctx.beginPath(); b.trail.forEach((t,i)=>{if(i===0)ctx.moveTo(t.x,t.y);else ctx.lineTo(t.x,t.y);}); ctx.stroke();
                        ctx.fillStyle='#FFD700'; ctx.beginPath(); ctx.arc(b.x,b.y,6,0,Math.PI*2); ctx.fill(); 
                    }); 
                    eng.current.balls = eng.current.balls.filter(b=>!b.done && b.y < h+50);
                    anim=requestAnimationFrame(update); 
                }; update(); return ()=>cancelAnimationFrame(anim); 
            }, [user.coins]); 
            
            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full" }, React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900 shrink-0" }, React.createElement('button',{onClick:back,className:"text-slate-400 active:scale-90"},React.createElement(ArrowIcon)), React.createElement('span',{className:"font-bold text-purple-500"},TEXTS.ar.plinko), React.createElement('span',{className:"text-xs font-mono bg-black px-2 py-1 rounded text-white"},user.coins)), React.createElement('div', { className: "flex-1 relative w-full" }, React.createElement('canvas', { ref: cvsRef, className: "w-full h-full block" })), React.createElement('div', { className: "p-4 bg-dark-900 border-t border-white/10 flex gap-4 shrink-0 pb-safe" }, React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), className: "w-24 bg-black border border-white/20 rounded-xl text-center text-white font-bold" }), React.createElement(Button, { full: true, onClick: drop }, TEXTS.ar.play)));
        }

        // 3. Mines (Replaces Tower - Professional Grid)
        function MinesGame({ user, back, showMsg, ArrowIcon, t }) {
            const [grid, setGrid] = useState(Array(25).fill(null)); // null = covered, 'gem', 'bomb'
            const [revealed, setRevealed] = useState(Array(25).fill(false));
            const [mineCount, setMineCount] = useState(3);
            const [bet, setBet] = useState(100);
            const [playing, setPlaying] = useState(false);
            const [mines, setMines] = useState([]); // Indices of mines
            const [gameOver, setGameOver] = useState(false); // 'won' or 'lost'
            
            // Generate board on play
            const startGame = async () => {
                if(Number(user.coins) < bet) return showMsg(TEXTS.ar.no_balance, 'error');
                await updateDoc(doc(db,"users",user.id),{coins: Number(user.coins) - bet});
                
                // Randomly place mines
                const newMines = [];
                while(newMines.length < mineCount) {
                    const r = Math.floor(Math.random() * 25);
                    if(!newMines.includes(r)) newMines.push(r);
                }
                setMines(newMines);
                setRevealed(Array(25).fill(false));
                setGameOver(false);
                setPlaying(true);
            };

            const handleTileClick = (idx) => {
                if(!playing || revealed[idx] || gameOver) return;
                
                const newRevealed = [...revealed];
                newRevealed[idx] = true;
                setRevealed(newRevealed);

                if(mines.includes(idx)) {
                    // Hit Mine
                    setGameOver('lost');
                    setPlaying(false);
                    // Reveal all mines
                    setRevealed(Array(25).fill(true)); 
                } else {
                    // Hit Gem
                    // Check if all gems found
                    const revealedCount = newRevealed.filter((r, i) => r && !mines.includes(i)).length;
                    const totalGems = 25 - mineCount;
                    if(revealedCount === totalGems) {
                        cashout(newRevealed);
                    }
                }
            };

            const getMultiplier = () => {
                const moves = revealed.filter((r, i) => r && !mines.includes(i)).length;
                // Simple simplified multiplier logic for demo
                // Actual formula: Multiplier * (25 - mines) / (25 - mines - moves)
                // We'll use a progressive approximation
                let m = 1.0;
                for(let i=0; i<moves; i++) {
                    m = m * (1 + (mineCount / (25 - mineCount - i)));
                }
                return m;
            };

            const currentMultiplier = getMultiplier();
            const currentWin = Math.floor(bet * currentMultiplier);

            const cashout = async () => {
                if(!playing) return;
                await updateDoc(doc(db,"users",user.id),{coins: Number(user.coins) + currentWin});
                setPlaying(false);
                setGameOver('won');
                setRevealed(Array(25).fill(true)); // Reveal all
                showMsg(`${TEXTS.ar.success} +${currentWin}`, 'success');
                triggerConfetti();
            };

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full" },
                React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900 shrink-0" }, 
                    React.createElement('button',{onClick:back,className:"text-slate-400"},React.createElement(ArrowIcon)), 
                    React.createElement('span',{className:"font-bold text-emerald-500"}, TEXTS.ar.mines), 
                    React.createElement('span',{className:"text-xs bg-black px-2 py-1 rounded"},user.coins)
                ),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-4 relative" },
                    // Multiplier Badge
                    playing && React.createElement('div', { className: "mb-4 bg-emerald-900/50 px-4 py-2 rounded-xl border border-emerald-500/30" },
                        React.createElement('span', { className: "text-2xl font-bold text-white" }, `x${currentMultiplier.toFixed(2)}`),
                        React.createElement('div', { className: "text-xs text-emerald-400 text-center" }, `Win: ${currentWin}`)
                    ),

                    // GRID
                    React.createElement('div', { className: "grid grid-cols-5 gap-2 w-full max-w-sm aspect-square" },
                        Array(25).fill(0).map((_, i) => {
                            const isRevealed = revealed[i];
                            const isMine = mines.includes(i);
                            let content = null;
                            let style = "bg-dark-800 hover:bg-dark-700 border-white/10";
                            
                            if (isRevealed) {
                                if (isMine) {
                                    content = React.createElement(Bomb, { className: "text-red-500 animate-pop", size: 24 });
                                    style = "bg-red-900/20 border-red-500";
                                } else {
                                    content = React.createElement(Gem, { className: "text-emerald-400 animate-pop", size: 24 });
                                    style = "bg-emerald-900/20 border-emerald-500";
                                }
                            }
                            
                            return React.createElement('button', {
                                key: i,
                                onClick: () => handleTileClick(i),
                                disabled: !playing || isRevealed,
                                className: `rounded-lg border flex items-center justify-center transition-all active:scale-95 ${style}`
                            }, content);
                        })
                    )
                ),
                
                // CONTROLS
                React.createElement('div', { className: "p-4 bg-dark-900 border-t border-white/10 space-y-3 pb-safe" },
                    !playing ? React.createElement('div', { className: "flex gap-4" },
                        React.createElement('div', { className: "flex-1" },
                            React.createElement('label', { className: "text-xs text-gray-500 mb-1 block" }, "Mines (1-24)"),
                            React.createElement('input', { type: "number", min: 1, max: 24, value: mineCount, onChange: e=>setMineCount(Math.min(24, Math.max(1, Number(e.target.value)))), className: "w-full bg-black border border-white/20 rounded-xl p-3 text-center text-white font-bold" })
                        ),
                        React.createElement('div', { className: "flex-1" },
                            React.createElement('label', { className: "text-xs text-gray-500 mb-1 block" }, "Bet"),
                            React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), className: "w-full bg-black border border-white/20 rounded-xl p-3 text-center text-white font-bold" })
                        )
                    ) : React.createElement(Button, { full: true, variant: "green", onClick: cashout }, `CASHOUT ${currentWin}`),
                    
                    !playing && React.createElement(Button, { full: true, onClick: startGame }, "PLAY")
                )
            );
        }

        // --- 4. TASKS ---
        function TasksScreen({ user, showMsg, t }) {
            const [tasks, setTasks] = useState([]);
            useEffect(() => { if(db) getDocs(collection(db, "tasks")).then(s => setTasks(s.docs.map(d=>({id:d.id, ...d.data()})))); }, []);
            const handleTask = (task) => { 
                window.open(task.url, '_blank'); 
                setTimeout(async () => { 
                    if(!db)return; 
                    const comp = user.completedTasks || []; 
                    if(!comp.includes(task.id)) { 
                        await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)+Number(task.reward),completedTasks:[...comp,task.id]}); 
                        showMsg(TEXTS.ar.success); 
                    } 
                }, 3000); 
            };
            const comp = user.completedTasks || [];
            return React.createElement('div', { className: "space-y-4" }, React.createElement('h2', { className: "text-gold-500 font-bold text-lg" }, TEXTS.ar.tasks), tasks.map(task => { const isDone = comp.includes(task.id); return React.createElement('div', { key: task.id, className: `bg-dark-800 border p-4 rounded-xl flex justify-between items-center ${isDone?'border-white/5 opacity-50':'border-gold-500/30'}` }, React.createElement('div', { className: "flex items-center gap-3" }, React.createElement('div', { className: "w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-xl" }, task.icon==='IG'?React.createElement(Instagram):React.createElement(Facebook)), React.createElement('div', {}, React.createElement('div', { className: "font-bold text-sm" }, task.title), React.createElement('div', { className: "text-xs text-gold-500" }, `+${task.reward} C`))), isDone ? React.createElement('span', { className: "text-green-500 text-xs font-bold bg-green-900/10 px-3 py-1 rounded-lg flex items-center gap-1" }, React.createElement(Check), t('done')) : React.createElement('button', { onClick: ()=>handleTask(task), className: "bg-gold-500 text-black px-4 py-2 rounded-lg text-xs font-bold active:scale-95 transition-transform" }, t('execute'))); }));
        }

        // --- 5. WALLET ---
        function WalletScreen({ user, showMsg, t, isRTL }) {
            const [mod, setMod] = useState(false); const [method, setMethod] = useState(''); const [val1, setVal1] = useState(''); const [val2, setVal2] = useState('IAM'); const [convAmt, setConvAmt] = useState(''); const [wAmt, setWAmt] = useState('');
            const [mode, setMode] = useState('toDollar'); 
            
            const convert = async () => { 
                if(user.status!=='active') return showMsg(TEXTS.ar.review,'error'); 
                const amt = parseFloat(convAmt); if(!amt) return; 
                if (mode === 'toDollar') {
                     if(Number(user.coins)<amt) return showMsg(TEXTS.ar.no_balance,'error'); 
                     const d = amt / 1000; 
                     await updateDoc(doc(db,"users",user.id),{coins:Number(user.coins)-amt,balance:Number(user.balance)+d});
                } else {
                     if(Number(user.balance) < amt) return showMsg(TEXTS.ar.no_balance,'error'); 
                     const pts = amt * 1000;
                     await updateDoc(doc(db,"users",user.id),{balance:Number(user.balance)-amt,coins:Number(user.coins)+pts});
                }
                setConvAmt(''); showMsg(TEXTS.ar.success); 
            };
            const withdraw = async () => { 
                if(!val1) return showMsg(TEXTS.ar.inputs_err,'error'); 
                const amount = Number(wAmt);
                if(!amount || amount > Number(user.balance)) return showMsg(TEXTS.ar.no_balance,'error'); 
                let det = val1; if(method==='Mobile') det=`${val1} (${val2})`; 
                await addDoc(collection(db,"withdrawals"),{userId:user.id, userName:user.fullName, memberId:user.memberId, amount, method, details:det, status:'pending', date:new Date().toLocaleDateString()}); 
                await updateDoc(doc(db,"users",user.id),{balance:Number(user.balance)-amount}); 
                setMod(false); showMsg(TEXTS.ar.success); 
            };
            return React.createElement('div', { className: "space-y-6" },
                React.createElement('div', { className: "bg-gradient-to-br from-dark-900 to-black p-6 rounded-2xl border border-white/10 text-center shadow-lg" }, React.createElement('div', { className: "text-xs text-slate-500 uppercase tracking-widest" }, t('balance')), React.createElement('div', { className: "text-5xl font-mono font-bold text-gold-500 gold-glow" }, `$${Number(user.balance).toFixed(2)}`)),
                React.createElement('div', { className: "bg-dark-800 p-4 rounded-2xl border border-white/5" }, 
                    React.createElement('div',{className:"flex justify-between mb-2"}, React.createElement('h3', { className: "text-sm font-bold text-white flex items-center gap-2" }, React.createElement(RefreshCw, {size:14}), t('convert')), React.createElement('button',{onClick:()=>setMode(m=>m==='toDollar'?'toCoins':'toDollar'),className:"text-xs text-gold-500 bg-black px-2 rounded flex gap-1 items-center"}, React.createElement(ArrowLeftRight,{size:14}), mode==='toDollar' ? 'Ø¥Ù„Ù‰ $' : 'Ø¥Ù„Ù‰ C')),
                    React.createElement('div', { className: "flex gap-2 mb-1" }, React.createElement('input', { type: "number", placeholder: mode==='toDollar'?"Ù†Ù‚Ø§Ø·...":"Ø¯ÙˆÙ„Ø§Ø±...", value: convAmt, onChange: e=>setConvAmt(e.target.value), className: "bg-black border border-white/10 rounded-lg p-2 flex-1 text-white text-center outline-none" }), React.createElement('button', { onClick: convert, className: "bg-gold-500 text-black font-bold px-4 rounded-lg text-xs active:scale-95" }, t('convert'))), React.createElement('p', { className: "text-[9px] text-slate-500 text-center mt-1" }, t('conv_rate'))
                ),
                React.createElement('div', { className: "space-y-2" }, ['1XBET','Mobile','PayPal'].map(m => React.createElement('button', { key: m, disabled: user.status!=='active', onClick: ()=>{setMethod(m);setMod(true);setVal1('');setWAmt('');}, className: "w-full flex justify-between p-4 bg-dark-800 border border-white/5 rounded-xl disabled:opacity-50 active:scale-95 transition-transform hover:border-gold-500/30" }, React.createElement('span', { className: "font-bold text-white" }, m), user.status==='active' ? React.createElement(isRTL ? ChevronLeft : ChevronRight,{size:16}) : React.createElement(Lock,{size:16,className:"text-red-500"})))),
                mod && React.createElement('div', { className: "fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-6 animate-in fade-in" }, React.createElement('div', { className: "w-full bg-dark-800 p-6 rounded-2xl space-y-4 border border-gold-500/30 shadow-2xl" }, React.createElement('h3', { className: "text-gold-500 font-bold text-lg" }, `${TEXTS.ar.withdraw} ${method}`), React.createElement(Input, { placeholder: "$", type: "number", value: wAmt, onChange: e=>setWAmt(e.target.value) }), React.createElement(Input, { placeholder: method==='Mobile'?TEXTS.ar.phone:'ID/Email', value: val1, onChange: e=>setVal1(e.target.value) }), method==='Mobile' && React.createElement('select', { value: val2, onChange: e=>setVal2(e.target.value), className: "w-full bg-dark-900 p-3 rounded-xl border border-white/10 text-white" }, React.createElement('option',{value:"IAM"},"IAM"), React.createElement('option',{value:"Orange"},"Orange"), React.createElement('option',{value:"Inwi"},"Inwi")), React.createElement('div', { className: "flex gap-2" }, React.createElement(Button, { full: true, onClick: withdraw }, TEXTS.ar.confirm), React.createElement('button', { onClick: ()=>setMod(false), className: "w-full py-3 bg-white/5 rounded-xl text-xs active:scale-95" }, TEXTS.ar.cancel))))
            );
        }

        // --- HISTORY ---
        function HistoryScreen({ user, t }) {
            const [list, setList] = useState([]);
            useEffect(() => { if(db) { const q = query(collection(db, "withdrawals"), where("userId", "==", user.id)); onSnapshot(q, s => setList(s.docs.map(d=>d.data()).reverse())); } }, []);
            return React.createElement('div', { className: "space-y-4" }, React.createElement('h2', { className: "text-gold-500 font-bold text-lg" }, TEXTS.ar.history), list.map((w,i)=>React.createElement('div', { key: i, className: "bg-dark-800 p-4 rounded-xl border border-white/5 flex justify-between items-center" }, React.createElement('div',{},React.createElement('div',{className:"font-bold text-white"},w.method),React.createElement('div',{className:"text-xs text-gray-500"},w.date)), React.createElement('div',{className:"text-right"},React.createElement('div',{className:"font-mono text-gold-500"},`$${w.amount}`),React.createElement('div',{className:`text-[10px] font-bold ${w.status==='paid'?'text-green-500':'text-yellow-500'}`},w.status==='paid'?TEXTS.ar.success:TEXTS.ar.review)))));
        }

        function SettingsScreen({ user, showMsg, t }) {
            const [f, setF] = useState({ fullName: user.fullName, phone: user.phone });
            const save = async () => { await updateDoc(doc(db,"users",user.id), f); showMsg(TEXTS.ar.success); };
            return React.createElement('div', { className: "space-y-4" }, React.createElement('h2', { className: "text-gold-500 font-bold text-lg" }, TEXTS.ar.settings), React.createElement('div', { className: "space-y-3" }, React.createElement('label',{className:"text-xs text-gray-500"},TEXTS.ar.name), React.createElement(Input, { value: f.fullName, onChange: e=>setF({...f,fullName:e.target.value}) }), React.createElement('label',{className:"text-xs text-gray-500"},TEXTS.ar.phone), React.createElement(Input, { value: f.phone, onChange: e=>setF({...f,phone:e.target.value}) }), React.createElement(Button, { full: true, onClick: save }, TEXTS.ar.confirm)));
        }

        // --- PAGES ---
        function InfoPage({ title, content }) {
            return React.createElement('div', { className: "p-4 space-y-4" }, React.createElement('h1', { className: "text-2xl text-gold-500 font-bold" }, title), React.createElement('p', { className: "text-gray-300 leading-relaxed" }, content));
        }

        function AdminPanel({ user, logout }) {
            const [tab, setTab] = useState('users'); const [data, setData] = useState({u:[], w:[], t:[]}); const [settings, setSettings] = useState({support:'', help:''});
            useEffect(() => { 
                if(db) {
                    onSnapshot(collection(db,"users"), s=>setData(p=>({...p, u:s.docs.map(d=>({id:d.id,...d.data()})).filter(x=>x.role!=='admin')})));
                    onSnapshot(collection(db,"withdrawals"), s=>setData(p=>({...p, w:s.docs.map(d=>({id:d.id,...d.data()}))})));
                }
            }, []);
            const saveSettings = async () => { await setDoc(doc(db,"settings","global"), settings); alert('Saved'); };
            return React.createElement('div', { className: "min-h-screen bg-dark-900 p-4 text-xs space-y-4" }, 
                React.createElement('div', { className: "flex justify-between" }, React.createElement('h1', { className: "text-lg text-gold-500" }, "ADMIN"), React.createElement('button', { onClick: logout }, "Exit")),
                React.createElement('div', { className: "flex gap-2" }, ['users','withdrawals','settings'].map(t=>React.createElement('button',{key:t, onClick:()=>setTab(t), className:`flex-1 py-2 border ${tab===t?'bg-gold-500 text-black':'text-white'}`},t))),
                tab==='settings' && React.createElement('div', {className:"space-y-3"}, React.createElement(Input,{placeholder:"Support URL", value:settings.support, onChange:e=>setSettings({...settings, support:e.target.value})}), React.createElement(Input,{placeholder:"Help URL", value:settings.help, onChange:e=>setSettings({...settings, help:e.target.value})}), React.createElement(Button,{full:true, onClick:saveSettings},"Save")),
                tab==='withdrawals' && data.w.map(w => React.createElement('div', { key: w.id, className: "bg-dark-800 p-3 border mb-2" }, React.createElement('div',{},`${w.userName} - $${w.amount}`), React.createElement('div',{className:"text-gray-500"},w.details), w.status==='pending' && React.createElement(Button,{onClick:()=>updateDoc(doc(db,"withdrawals",w.id),{status:'paid'})},"Pay"))),
                tab==='users' && data.u.map(u => React.createElement('div', { key: u.id, className: "bg-dark-800 p-3 rounded flex justify-between items-center border border-white/5" }, React.createElement('div', {}, React.createElement('div', { className: "text-gold-500 font-bold" }, u.memberId), React.createElement('div', { className: "text-slate-400" }, u.fullName)), React.createElement('button', { onClick: ()=>updateDoc(doc(db,"users",u.id),{status:u.status==='active'?'pending':'active'}), className: `px-3 py-1 rounded font-bold ${u.status==='active'?'bg-red-900/20 text-red-500':'bg-green-900/20 text-green-500'}` }, u.status==='active'?'ØªØ¬Ù…ÙŠØ¯':'ØªÙØ¹ÙŠÙ„')))
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
