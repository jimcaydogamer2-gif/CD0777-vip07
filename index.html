<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casino Royal | Pro Secure Platform</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gold: { 
                            400: '#FFD700', 
                            500: '#FFC107', 
                            600: '#FFB300', 
                            700: '#FFA000',
                            glow: 'rgba(255, 215, 0, 0.5)' 
                        },
                        dark: { 
                            800: '#1e293b', 
                            900: '#0f172a', 
                            950: '#020617' 
                        },
                        house: '#ef4444', // Red for losses
                        player: '#10b981', // Green for wins
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        display: ['Oswald', 'sans-serif']
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'bounce-slight': 'bounce 1s infinite',
                        'pulse-glow': 'pulseGlow 2s infinite',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'plinko-drop': 'plinkoDrop 0.5s ease-in forwards',
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 10px #FFD700' }, '50%': { boxShadow: '0 0 25px #FFD700' } },
                        shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } }
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;800&family=Oswald:wght@600&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #020617; color: #fff; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        
        /* Glassmorphism */
        .glass { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .glass-strong { background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.08); }
        
        /* Inputs & Ranges */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #FFD700; cursor: pointer; margin-top: -8px; box-shadow: 0 0 10px #FFD700; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #334155; border-radius: 2px; }

        /* Game Specifics */
        .wheel-segment { transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1); }
        .dice-face { display: grid; grid-template-areas: "a . c" "e g f" "d . b"; flex: 0 0 100%; padding: 10px; }
        .pip { display: block; align-self: center; justify-self: center; width: 12px; height: 12px; border-radius: 50%; background-color: #000; box-shadow: inset 0 3px #111, inset 0 -3px #555; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        /* 3D Coin Flip */
        .coin { transform-style: preserve-3d; transition: transform 1s ease-in; }
        .coin div { backface-visibility: hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; }
        .side-a { z-index: 100; }
        .side-b { transform: rotateY(-180deg); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.294.0",
                "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
            }
        }
    </script>

    <script type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Gamepad2, Home, Wallet, History, User, Settings, LogOut, ChevronLeft, 
            ChevronRight, Play, AlertTriangle, CheckCircle, XCircle, DollarSign, 
            Target, Dices, Bomb, Coins, ArrowUp, ArrowDown, Repeat, ShieldCheck,
            Menu, Loader2, Trophy, Lock, BarChart3, RotateCw, Gem, Zap
        } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { 
            getFirestore, collection, addDoc, doc, updateDoc, 
            onSnapshot, query, where, getDocs, orderBy, limit, serverTimestamp 
        } from 'firebase/firestore';

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDJ5B7MncMfyjwb0ZnZ8p3d0bsoQAFqZQY", // Replace if needed
            authDomain: "cd0777-casino.firebaseapp.com",
            projectId: "cd0777-casino",
            storageBucket: "cd0777-casino.firebasestorage.app",
            messagingSenderId: "320546250152",
            appId: "1:320546250152:web:730f6e581267b9b315919d"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- GLOBAL HELPER FUNCTIONS ---

        // 1. CRITICAL: Security Logging
        const logGame = async (userId, username, game, bet, win, profit) => {
            try {
                // Ensure numbers
                const betVal = parseFloat(bet);
                const winVal = parseFloat(win);
                const profitVal = parseFloat(profit);

                await addDoc(collection(db, "game_logs"), {
                    userId,
                    username,
                    game,
                    bet: betVal,
                    win: winVal,
                    profit: profitVal,
                    result: profitVal > 0 ? 'WIN' : 'LOSS',
                    timestamp: serverTimestamp(), // Server-side time for security
                    date: new Date().toISOString() // Client-side backup
                });
                console.log(`[SECURE LOG] ${game}: Bet ${betVal} -> Profit ${profitVal}`);
            } catch (error) {
                console.error("CRITICAL ERROR: Failed to log game", error);
                // In a strict prod env, you might block play if logs fail
            }
        };

        const formatMoney = (amount) => {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(amount);
        };

        const generateRandom = (min, max) => {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        };

        // House Edge Math Helper (Return true if House Wins forced)
        // A 5% chance the house forces a loss regardless of logic (Simple implementation)
        const checkHouseEdge = (percentage = 0.05) => {
            return Math.random() < percentage;
        };

        // --- SHARED UI COMPONENTS ---

        const Button = ({ children, onClick, variant = 'gold', className = '', disabled, loading, full }) => {
            const baseStyle = "relative font-bold py-3 px-6 rounded-xl transition-all active:scale-95 flex items-center justify-center gap-2 disabled:opacity-50 disabled:pointer-events-none select-none";
            const variants = {
                gold: "bg-gradient-to-b from-gold-400 to-gold-600 text-black shadow-[0_0_15px_rgba(255,215,0,0.3)] border border-gold-400/50",
                green: "bg-gradient-to-b from-emerald-500 to-emerald-700 text-white shadow-[0_0_15px_rgba(16,185,129,0.3)] border border-emerald-500/50",
                red: "bg-gradient-to-b from-red-500 to-red-700 text-white shadow-[0_0_15px_rgba(239,68,68,0.3)] border border-red-500/50",
                dark: "bg-dark-800 text-gray-300 border border-white/10 hover:bg-dark-700",
                ghost: "bg-transparent text-gray-400 hover:text-white"
            };

            return React.createElement('button', {
                onClick,
                disabled: disabled || loading,
                className: `${baseStyle} ${variants[variant]} ${full ? 'w-full' : ''} ${className}`
            }, 
                loading ? React.createElement(Loader2, { className: "animate-spin", size: 20 }) : children
            );
        };

        const Input = ({ value, onChange, type = "text", placeholder, icon: Icon, disabled, className="" }) => {
            return React.createElement('div', { className: `relative w-full ${className}` },
                Icon && React.createElement(Icon, { size: 18, className: "absolute left-4 top-1/2 -translate-y-1/2 text-gray-500" }),
                React.createElement('input', {
                    value,
                    onChange,
                    type,
                    disabled,
                    placeholder,
                    className: `w-full bg-dark-900 border border-white/10 rounded-xl py-3 ${Icon ? 'pl-12' : 'pl-4'} pr-4 text-white placeholder:text-gray-600 focus:border-gold-500 focus:outline-none transition-colors`
                })
            );
        };

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return React.createElement('div', { className: "fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-pop" },
                React.createElement('div', { className: "bg-dark-900 border border-white/10 w-full max-w-md rounded-2xl overflow-hidden shadow-2xl" },
                    React.createElement('div', { className: "flex justify-between items-center p-4 border-b border-white/5 bg-dark-800" },
                        React.createElement('h3', { className: "font-bold text-gold-500 font-display tracking-wide" }, title),
                        React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(XCircle, { size: 20 }))
                    ),
                    React.createElement('div', { className: "p-6" }, children)
                )
            );
        };

        const Card = ({ title, icon: Icon, color, onClick, isNew }) => {
            return React.createElement('button', {
                onClick,
                className: "relative group w-full h-28 bg-dark-800 rounded-2xl border border-white/5 overflow-hidden hover:border-gold-500/50 transition-all active:scale-95 text-left p-4 shadow-lg"
            },
                React.createElement('div', { className: `absolute inset-0 bg-gradient-to-br from-${color}-500/10 to-transparent opacity-50 group-hover:opacity-100 transition-opacity` }),
                React.createElement(Icon, { size: 48, className: `absolute -right-4 -bottom-4 text-${color}-500/20 group-hover:rotate-12 transition-transform` }),
                isNew && React.createElement('span', { className: "absolute top-2 right-2 bg-red-500 text-white text-[9px] font-bold px-2 py-0.5 rounded-full animate-pulse" }, "NEW"),
                React.createElement('div', { className: "relative z-10 h-full flex flex-col justify-end" },
                    React.createElement('h3', { className: "text-lg font-bold text-white font-display uppercase italic" }, title),
                    React.createElement('div', { className: `h-1 w-8 bg-${color}-500 rounded-full mt-1` })
                )
            );
        };

        const BetControls = ({ bet, setBet, balance, onPlay, playing, loading, profit }) => {
            return React.createElement('div', { className: "p-4 bg-dark-800 border-t border-white/10 flex flex-col gap-3" },
                profit > 0 && React.createElement('div', { className: "absolute bottom-full left-0 w-full bg-emerald-500/90 text-white text-center py-2 font-bold animate-slide-up backdrop-blur-md" },
                    `YOU WON +${profit.toFixed(2)} COINS`
                ),
                React.createElement('div', { className: "flex gap-2" },
                    React.createElement(Input, { 
                        type: "number", 
                        value: bet, 
                        onChange: (e) => setBet(Math.max(0, Number(e.target.value))), 
                        disabled: playing,
                        icon: Coins,
                        className: "flex-1"
                    }),
                    React.createElement(Button, { onClick: () => setBet(bet * 2), disabled: playing, variant: 'dark', className: "w-14" }, "2x"),
                    React.createElement(Button, { onClick: () => setBet(Math.floor(bet / 2)), disabled: playing, variant: 'dark', className: "w-14" }, "Â½")
                ),
                React.createElement(Button, { 
                    full: true, 
                    onClick: onPlay, 
                    disabled: playing || loading,
                    loading: loading
                }, playing ? "PLAYING..." : "BET NOW")
            );
        };

        // End of PART 1// --- GAME 1: CRASH (The Pilot) ---
        const CrashGame = ({ user, onClose, onUpdateBalance }) => {
            const [multiplier, setMultiplier] = useState(1.00);
            const [gameState, setGameState] = useState('IDLE'); // IDLE, FLYING, CRASHED, CASHOUT
            const [bet, setBet] = useState(100);
            const [history, setHistory] = useState([]);
            const [profit, setProfit] = useState(0);
            
            const reqRef = useRef();
            const startTimeRef = useRef();
            const crashPointRef = useRef(0);

            // House Edge: 4% chance to crash instantly at 1.00x
            // General math: 0.99 / (1 - random) = fairly standard crash curve
            const generateCrashPoint = () => {
                if (checkHouseEdge(0.04)) return 1.00; 
                const r = Math.random();
                const crash = 0.99 / (1 - r);
                return Math.max(1.00, Math.floor(crash * 100) / 100);
            };

            const startGame = async () => {
                if (user.coins < bet) return alert("Insufficient funds");
                
                // Deduct Bet
                await onUpdateBalance(-bet);
                setGameState('FLYING');
                setMultiplier(1.00);
                setProfit(0);
                
                crashPointRef.current = generateCrashPoint();
                startTimeRef.current = Date.now();
                
                // Start Loop
                loop();
            };

            const loop = () => {
                const now = Date.now();
                const elapsed = (now - startTimeRef.current) / 1000; // seconds
                
                // Exponential growth formula
                const currentMult = 1 + (0.1 * elapsed) + (0.08 * Math.pow(elapsed, 2)); // Slightly aggressive curve
                
                if (currentMult >= crashPointRef.current) {
                    crash(crashPointRef.current);
                } else {
                    setMultiplier(currentMult);
                    reqRef.current = requestAnimationFrame(loop);
                }
            };

            const crash = (finalValue) => {
                cancelAnimationFrame(reqRef.current);
                setMultiplier(finalValue);
                setGameState('CRASHED');
                setHistory(prev => [finalValue, ...prev].slice(0, 10));
                
                // Log Loss
                logGame(user.id, user.username || 'User', 'Crash', bet, 0, -bet);
            };

            const cashOut = async () => {
                cancelAnimationFrame(reqRef.current);
                const winAmount = bet * multiplier;
                const profitAmount = winAmount - bet;
                
                setGameState('CASHOUT');
                setProfit(profitAmount);
                
                // Add Winnings
                await onUpdateBalance(winAmount);
                setHistory(prev => [multiplier, ...prev].slice(0, 10));

                // Log Win
                logGame(user.id, user.username || 'User', 'Crash', bet, winAmount, profitAmount);
            };

            useEffect(() => {
                return () => cancelAnimationFrame(reqRef.current);
            }, []);

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-950" },
                // Header
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-red-500 font-display font-bold text-xl tracking-widest" }, "CRASH PROTOCOL"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, "EDGE: 4%")
                ),

                // Game Area
                React.createElement('div', { className: "relative flex-1 flex flex-col items-center justify-center overflow-hidden" },
                    // Background Grid
                    React.createElement('div', { className: "absolute inset-0 opacity-20", style: { backgroundImage: 'radial-gradient(#334155 1px, transparent 1px)', backgroundSize: '30px 30px' } }),
                    
                    // Rocket/Multiplier
                    React.createElement('div', { className: "z-10 text-center" },
                        gameState === 'FLYING' && React.createElement(Rocket, { size: 64, className: "text-red-500 mb-4 animate-bounce-slight mx-auto" }),
                        gameState === 'CRASHED' && React.createElement(Bomb, { size: 64, className: "text-gray-500 mb-4 mx-auto animate-pulse" }),
                        gameState === 'CASHOUT' && React.createElement(Trophy, { size: 64, className: "text-gold-500 mb-4 mx-auto animate-pop" }),
                        
                        React.createElement('div', { className: `text-6xl font-black font-mono transition-colors ${gameState === 'CRASHED' ? 'text-red-600' : gameState === 'CASHOUT' ? 'text-green-500' : 'text-white'}` }, 
                            multiplier.toFixed(2) + "x"
                        ),
                        gameState === 'CRASHED' && React.createElement('div', { className: "text-red-500 font-bold mt-2" }, "CRASHED"),
                        gameState === 'CASHOUT' && React.createElement('div', { className: "text-green-500 font-bold mt-2" }, `WON +${profit.toFixed(2)}`)
                    ),

                    // History Bar
                    React.createElement('div', { className: "absolute top-4 right-4 flex flex-col gap-2" },
                        history.map((h, i) => React.createElement('div', { key: i, className: `text-xs font-mono px-2 py-1 rounded ${h >= 2 ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}` }, h.toFixed(2) + "x"))
                    )
                ),

                // Controls
                React.createElement(BetControls, {
                    bet, setBet, balance: user.coins,
                    loading: gameState === 'FLYING',
                    playing: gameState === 'FLYING',
                    onPlay: gameState === 'FLYING' ? cashOut : startGame
                })
            );
        };
        
        // Helper Icon for Crash
        const Rocket = ({ size, className }) => React.createElement('svg', { 
            xmlns: "http://www.w3.org/2000/svg", width: size, height: size, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", className: className 
        }, React.createElement('path', { d: "M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z" }), React.createElement('path', { d: "m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z" }), React.createElement('path', { d: "M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0" }), React.createElement('path', { d: "M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5" }));

        // --- GAME 2: SLOTS (Royal 777) ---
        const SlotsGame = ({ user, onClose, onUpdateBalance }) => {
            const [reels, setReels] = useState(['ðŸ’', 'ðŸ’', 'ðŸ’']);
            const [spinning, setSpinning] = useState(false);
            const [bet, setBet] = useState(50);
            const [msg, setMsg] = useState("PRESS SPIN");
            const [lastWin, setLastWin] = useState(0);

            // Symbols & Weights (House Edge: High value symbols are rare)
            const SYMBOLS = [
                { icon: 'ðŸ’', weight: 40, val: 2 },
                { icon: 'ðŸ‹', weight: 30, val: 3 },
                { icon: 'ðŸ‡', weight: 15, val: 5 },
                { icon: 'ðŸ’Ž', weight: 10, val: 10 },
                { icon: '7ï¸âƒ£', weight: 5, val: 50 } // Jackpot
            ];

            const getRandomSymbol = () => {
                let r = Math.random() * 100;
                for (let s of SYMBOLS) {
                    if (r < s.weight) return s.icon;
                    r -= s.weight;
                }
                return 'ðŸ’';
            };

            const getSymbolValue = (icon) => SYMBOLS.find(s => s.icon === icon)?.val || 0;

            const spin = async () => {
                if (user.coins < bet) return alert("Insufficient coins");
                
                await onUpdateBalance(-bet);
                setSpinning(true);
                setMsg("SPINNING...");
                setLastWin(0);

                // Animation Effect
                let interval = setInterval(() => {
                    setReels([getRandomSymbol(), getRandomSymbol(), getRandomSymbol()]);
                }, 100);

                setTimeout(async () => {
                    clearInterval(interval);
                    
                    // Final Logic
                    const r1 = getRandomSymbol();
                    const r2 = getRandomSymbol();
                    const r3 = getRandomSymbol();
                    
                    setReels([r1, r2, r3]);
                    
                    let winMult = 0;
                    
                    // Win Conditions
                    if (r1 === r2 && r2 === r3) {
                        // 3 of a kind
                        winMult = getSymbolValue(r1) * 3; // Bonus multiplier for 3 matches
                        if (r1 === '7ï¸âƒ£') winMult = 100; // Jackpot
                    } else if (r1 === r2 || r2 === r3) {
                        // 2 of a kind (Small win to keep them playing)
                        winMult = 1.5; 
                    }

                    const winAmount = Math.floor(bet * winMult);
                    const profit = winAmount - bet;

                    if (winAmount > 0) {
                        setMsg(`WINNER! +${winAmount}`);
                        setLastWin(winAmount);
                        await onUpdateBalance(winAmount);
                        logGame(user.id, user.username, 'Slots', bet, winAmount, profit);
                    } else {
                        setMsg("TRY AGAIN");
                        logGame(user.id, user.username, 'Slots', bet, 0, -bet);
                    }

                    setSpinning(false);
                }, 2000);
            };

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-900" },
                // Header
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-purple-500 font-display font-bold text-xl tracking-widest" }, "ROYAL SLOTS"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, "RTP: 92%")
                ),

                // Machine Area
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-6 bg-gradient-to-b from-purple-900/20 to-black" },
                    
                    // Status
                    React.createElement('div', { className: `mb-8 text-2xl font-black font-display tracking-widest ${lastWin > 0 ? 'text-green-400 animate-pulse' : 'text-gold-500'}` }, msg),

                    // Reels Container
                    React.createElement('div', { className: "bg-gold-600 p-2 rounded-2xl shadow-[0_0_50px_rgba(234,179,8,0.2)]" },
                        React.createElement('div', { className: "bg-black border-4 border-gold-400 rounded-xl p-4 flex gap-2 sm:gap-4" },
                            reels.map((symbol, i) => 
                                React.createElement('div', { key: i, className: "w-20 h-28 sm:w-24 sm:h-32 bg-white rounded-lg flex items-center justify-center text-5xl sm:text-6xl shadow-inner relative overflow-hidden" },
                                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-b from-black/20 to-transparent pointer-events-none" }),
                                    React.createElement('span', { className: spinning ? 'animate-bounce' : 'animate-pop' }, symbol)
                                )
                            )
                        )
                    ),
                    
                    // Paytable hint
                    React.createElement('div', { className: "mt-8 flex gap-4 text-xs text-gray-500" },
                        React.createElement('div', {}, "7ï¸âƒ£7ï¸âƒ£7ï¸âƒ£ = 100x"),
                        React.createElement('div', {}, "ðŸ’ŽðŸ’ŽðŸ’Ž = 30x"),
                        React.createElement('div', {}, "ðŸ’ðŸ’ðŸ’ = 6x")
                    )
                ),

                // Controls
                React.createElement(BetControls, {
                    bet, setBet, balance: user.coins,
                    playing: spinning,
                    onPlay: spin,
                    profit: lastWin > 0 ? lastWin : 0
                })
            );
        };

        // --- GAME 3: LIMBO (The Greedy Game) ---
        const LimboGame = ({ user, onClose, onUpdateBalance }) => {
            const [target, setTarget] = useState(2.0);
            const [bet, setBet] = useState(100);
            const [result, setResult] = useState(null);
            const [rolling, setRolling] = useState(false);
            const [profit, setProfit] = useState(0);

            // House Edge logic:
            // Win Chance = 95 / Target (5% House Edge built-in mathematically)
            // Example: Target 2.0 -> 47.5% win chance (instead of 50%)
            const winChance = useMemo(() => (95 / target).toFixed(2), [target]);
            const potentialWin = useMemo(() => (bet * target).toFixed(2), [bet, target]);

            const roll = async () => {
                if (user.coins < bet) return alert("Insufficient coins");
                
                await onUpdateBalance(-bet);
                setRolling(true);
                setResult(null);
                setProfit(0);

                // Determine result
                // Generate a number between 1.00 and 1000000
                // We use a cryptographically insecure but functional logic for demo
                // To force house edge, we simply check if Math.random() < winChance/100
                
                const isWin = Math.random() * 100 < (95 / target);
                
                let finalNumber;
                if (isWin) {
                    // Generate a number ABOVE target
                    // Random float between Target and Target * 2 (visual fluff)
                    finalNumber = target + (Math.random() * target); 
                } else {
                    // Generate a number BELOW target
                    // Random float between 1.00 and Target - 0.01
                    finalNumber = 1.00 + (Math.random() * (target - 1.01));
                }

                // Animation
                let current = 1.00;
                let step = (finalNumber - 1) / 20;
                
                const interval = setInterval(() => {
                    current += step;
                    // Randomize step slightly for effect
                    step *= 1.1; 
                    
                    // Visual cap for animation
                    let display = current;
                    if (display > finalNumber) display = finalNumber;

                    // Update UI temporarily
                    const el = document.getElementById('limbo-display');
                    if (el) el.innerText = display.toFixed(2) + 'x';

                    if (current >= finalNumber) {
                        clearInterval(interval);
                        finishGame(finalNumber, isWin);
                    }
                }, 50);
            };

            const finishGame = async (finalNumber, isWin) => {
                setRolling(false);
                setResult(finalNumber);

                if (isWin) {
                    const winAmt = bet * target;
                    const prof = winAmt - bet;
                    setProfit(prof);
                    await onUpdateBalance(winAmt);
                    logGame(user.id, user.username, 'Limbo', bet, winAmt, prof);
                } else {
                    logGame(user.id, user.username, 'Limbo', bet, 0, -bet);
                }
            };

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-950" },
                // Header
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-green-500 font-display font-bold text-xl tracking-widest" }, "LIMBO"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, "EDGE: 5%")
                ),

                // Game Area
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-6 relative" },
                    
                    // Main Number Display
                    React.createElement('div', { className: "relative mb-12" },
                        React.createElement('div', { 
                            id: "limbo-display",
                            className: `text-7xl font-black font-mono transition-colors ${
                                result !== null 
                                    ? (result >= target ? 'text-green-500 drop-shadow-[0_0_15px_rgba(34,197,94,0.5)]' : 'text-red-500') 
                                    : 'text-white'
                            }` 
                        }, result !== null ? result.toFixed(2) + 'x' : "1.00x"),
                        
                        // Target Indicator
                        React.createElement('div', { className: "absolute -bottom-8 left-1/2 -translate-x-1/2 text-gray-500 font-mono text-sm whitespace-nowrap" }, 
                            `Target: ${target.toFixed(2)}x`
                        )
                    ),

                    // Target Slider Control
                    React.createElement('div', { className: "w-full max-w-md bg-dark-900 p-6 rounded-2xl border border-white/10" },
                        React.createElement('div', { className: "flex justify-between text-sm mb-4" },
                            React.createElement('span', { className: "text-gray-400" }, "Target Multiplier"),
                            React.createElement('span', { className: "text-white font-bold" }, winChance + "% Chance")
                        ),
                        React.createElement('input', {
                            type: "range",
                            min: "1.01",
                            max: "100",
                            step: "0.01",
                            value: target,
                            onChange: (e) => setTarget(parseFloat(e.target.value)),
                            className: "w-full mb-4 accent-green-500"
                        }),
                        React.createElement('div', { className: "flex gap-2" },
                            React.createElement(Input, { 
                                type: "number", 
                                value: target, 
                                onChange: (e) => setTarget(parseFloat(e.target.value)),
                                icon: Target
                            }),
                            React.createElement('div', { className: "flex-1 bg-dark-800 rounded-xl border border-white/5 flex flex-col items-center justify-center p-2" },
                                React.createElement('span', { className: "text-[10px] text-gray-500 uppercase" }, "Payout"),
                                React.createElement('span', { className: "text-green-400 font-bold font-mono" }, potentialWin)
                            )
                        )
                    )
                ),

                // Controls
                React.createElement(BetControls, {
                    bet, setBet, balance: user.coins,
                    playing: rolling,
                    onPlay: roll,
                    profit: profit
                })
            );
        };// --- GAME 4: KENO (Classic) ---
        const KenoGame = ({ user, onClose, onUpdateBalance }) => {
            const [selected, setSelected] = useState([]);
            const [drawn, setDrawn] = useState([]);
            const [bet, setBet] = useState(50);
            const [playing, setPlaying] = useState(false);
            const [msg, setMsg] = useState("PICK UP TO 10 NUMBERS");
            const [profit, setProfit] = useState(0);

            // House Edge: Payouts are slightly adjusted below probability
            const PAYOUTS = {
                1: [0, 1.8], // 1 pick: 0 hits=0x, 1 hit=1.8x
                2: [0, 0, 3.6],
                3: [0, 0, 1.1, 14],
                4: [0, 0, 0, 4, 30],
                5: [0, 0, 0, 1.5, 10, 50],
                6: [0, 0, 0, 0, 5, 25, 100],
                7: [0, 0, 0, 0, 2, 10, 50, 250],
                8: [0, 0, 0, 0, 0, 5, 20, 100, 500],
                9: [0, 0, 0, 0, 0, 2, 10, 50, 200, 800],
                10: [0, 0, 0, 0, 0, 0, 5, 25, 100, 400, 1000]
            };

            const toggleNumber = (n) => {
                if (playing) return;
                if (selected.includes(n)) {
                    setSelected(selected.filter(i => i !== n));
                } else {
                    if (selected.length < 10) setSelected([...selected, n]);
                }
            };

            const play = async () => {
                if (selected.length === 0) return alert("Pick at least 1 number");
                if (user.coins < bet) return alert("Insufficient coins");

                await onUpdateBalance(-bet);
                setPlaying(true);
                setDrawn([]);
                setProfit(0);
                setMsg("DRAWING...");

                // Generate 10 random numbers (1-40)
                const draws = [];
                while (draws.length < 10) {
                    const r = Math.ceil(Math.random() * 40);
                    if (!draws.includes(r)) draws.push(r);
                }

                // Animation loop
                let i = 0;
                const interval = setInterval(async () => {
                    setDrawn(prev => [...prev, draws[i]]);
                    i++;
                    if (i >= 10) {
                        clearInterval(interval);
                        
                        // Calculate Win
                        const hits = selected.filter(s => draws.includes(s)).length;
                        const table = PAYOUTS[selected.length] || [];
                        const multiplier = table[hits] || 0;
                        const winAmt = bet * multiplier;
                        const prof = winAmt - bet;

                        setPlaying(false);
                        
                        if (winAmt > 0) {
                            setMsg(`HIT ${hits}! WON +${winAmt}`);
                            setProfit(winAmt); // Just for UI display
                            await onUpdateBalance(winAmt);
                            logGame(user.id, user.username, 'Keno', bet, winAmt, prof);
                        } else {
                            setMsg(`HIT ${hits}. TRY AGAIN.`);
                            logGame(user.id, user.username, 'Keno', bet, 0, -bet);
                        }
                    }
                }, 200); // Draw speed
            };

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-900" },
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-emerald-500 font-display font-bold text-xl tracking-widest" }, "KENO CLASSIC"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, `RISK: MEDIUM`)
                ),

                React.createElement('div', { className: "flex-1 overflow-y-auto p-4 flex flex-col items-center" },
                    // Status
                    React.createElement('div', { className: `mb-6 font-bold font-mono text-xl ${profit > 0 ? 'text-green-500 animate-pulse' : 'text-white'}` }, msg),

                    // The Grid
                    React.createElement('div', { className: "grid grid-cols-5 gap-2 sm:gap-3 w-full max-w-sm mb-6" },
                        Array.from({ length: 40 }, (_, i) => i + 1).map(n => {
                            const isSelected = selected.includes(n);
                            const isDrawn = drawn.includes(n);
                            const isHit = isSelected && isDrawn;
                            
                            let bg = "bg-dark-800 border-white/5 text-gray-400"; // Default
                            if (isHit) bg = "bg-green-500 text-black shadow-[0_0_15px_#22c55e] scale-110 z-10 font-bold";
                            else if (isDrawn) bg = "bg-red-500/50 text-white";
                            else if (isSelected) bg = "bg-white text-black font-bold";

                            return React.createElement('button', {
                                key: n,
                                onClick: () => toggleNumber(n),
                                disabled: playing,
                                className: `h-10 sm:h-12 rounded-lg border transition-all duration-300 ${bg}`
                            }, n);
                        })
                    ),

                    // Payout Info
                    selected.length > 0 && React.createElement('div', { className: "w-full max-w-sm bg-dark-800 p-4 rounded-xl text-xs text-gray-400" },
                        React.createElement('div', { className: "flex justify-between mb-2 border-b border-white/5 pb-1" }, React.createElement('span', {}, "Hits"), React.createElement('span', {}, "Payout")),
                        PAYOUTS[selected.length].map((m, i) => 
                            m > 0 && React.createElement('div', { key: i, className: "flex justify-between" }, 
                                React.createElement('span', {}, `${i} Hits`), 
                                React.createElement('span', { className: "text-gold-500" }, `${m}x`)
                            )
                        )
                    )
                ),

                // Controls
                React.createElement(BetControls, {
                    bet, setBet, balance: user.coins,
                    playing: playing,
                    onPlay: play,
                    profit: profit
                })
            );
        };


        // --- GAME 5: COIN FLIP (3D Animation) ---
        const CoinFlipGame = ({ user, onClose, onUpdateBalance }) => {
            const [side, setSide] = useState('HEADS'); // HEADS or TAILS
            const [bet, setBet] = useState(100);
            const [flipping, setFlipping] = useState(false);
            const [rotation, setRotation] = useState(0);
            const [lastWin, setLastWin] = useState(0);

            // House Edge: Payout is 1.95x (instead of 2.0x) = 2.5% Edge
            const PAYOUT_MULT = 1.95; 

            const flip = async () => {
                if (user.coins < bet) return alert("Insufficient coins");
                
                await onUpdateBalance(-bet);
                setFlipping(true);
                setLastWin(0);

                // Math
                const isHeads = Math.random() < 0.5;
                const result = isHeads ? 'HEADS' : 'TAILS';
                
                // Animation Calculation
                // Base rotation (5 full spins) + Result adjustment
                const extra = isHeads ? 0 : 180;
                const newRotation = rotation + 1800 + extra; 
                setRotation(newRotation);

                setTimeout(async () => {
                    setFlipping(false);
                    const win = result === side;
                    
                    if (win) {
                        const winAmt = bet * PAYOUT_MULT;
                        const prof = winAmt - bet;
                        setLastWin(prof); // Display profit
                        await onUpdateBalance(winAmt);
                        logGame(user.id, user.username, 'CoinFlip', bet, winAmt, prof);
                    } else {
                        logGame(user.id, user.username, 'CoinFlip', bet, 0, -bet);
                    }
                }, 1100); // Sync with CSS transition duration
            };

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-950" },
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-blue-500 font-display font-bold text-xl tracking-widest" }, "COIN FLIP"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, `PAY: 1.95x`)
                ),

                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center relative perspective-1000" },
                    
                    // Win Notification
                    lastWin > 0 && React.createElement('div', { className: "absolute top-10 text-4xl font-black text-green-500 animate-pop z-20" }, `+${lastWin.toFixed(0)}`),

                    // The 3D Coin
                    React.createElement('div', { 
                        className: "relative w-48 h-48 coin mb-12",
                        style: { transform: `rotateY(${rotation}deg)` }
                    },
                        // Front (Heads)
                        React.createElement('div', { className: "side-a rounded-full bg-gradient-to-br from-yellow-300 to-yellow-600 border-4 border-yellow-700 shadow-xl flex items-center justify-center backface-hidden" },
                            React.createElement(Target, { size: 80, className: "text-yellow-900" })
                        ),
                        // Back (Tails)
                        React.createElement('div', { className: "side-b rounded-full bg-gradient-to-br from-gray-300 to-gray-500 border-4 border-gray-700 shadow-xl flex items-center justify-center backface-hidden" },
                            React.createElement(Coins, { size: 80, className: "text-gray-800" })
                        )
                    ),

                    // Side Selection
                    React.createElement('div', { className: "flex bg-dark-800 p-1 rounded-xl border border-white/10" },
                        ['HEADS', 'TAILS'].map(s => React.createElement('button', {
                            key: s,
                            onClick: () => setSide(s),
                            disabled: flipping,
                            className: `px-8 py-3 rounded-lg font-bold transition-all ${side === s ? 'bg-gold-500 text-black shadow-lg' : 'text-gray-400 hover:bg-white/5'}`
                        }, s))
                    )
                ),

                React.createElement(BetControls, {
                    bet, setBet, balance: user.coins,
                    playing: flipping,
                    onPlay: flip,
                    profit: lastWin
                })
            );
        };


        // --- GAME 6: MINES (Grid Logic) ---
        const MinesGame = ({ user, onClose, onUpdateBalance }) => {
            const [grid, setGrid] = useState(Array(25).fill({ revealed: false, value: 'safe' }));
            const [minesCount, setMinesCount] = useState(3);
            const [gameState, setGameState] = useState('IDLE'); // IDLE, PLAYING, CASHED_OUT, BOOM
            const [bet, setBet] = useState(100);
            const [currentMult, setCurrentMult] = useState(1.00);
            const [profit, setProfit] = useState(0);

            // House Edge: 3% reduction on the mathematically fair multiplier
            const calculateNextMultiplier = (currentM, remainingTiles, remainingSafe) => {
                const probability = remainingSafe / remainingTiles;
                const fairMult = currentM * (1 / probability);
                return fairMult * 0.97; // Apply 3% House Edge
            };

            const startGame = async () => {
                if (user.coins < bet) return alert("Insufficient funds");
                await onUpdateBalance(-bet);

                // Setup Grid
                const newGrid = Array(25).fill(null).map((_, i) => ({ id: i, revealed: false, value: 'safe' }));
                
                // Place Mines randomly (Hidden)
                let placed = 0;
                while (placed < minesCount) {
                    const idx = Math.floor(Math.random() * 25);
                    if (newGrid[idx].value !== 'mine') {
                        newGrid[idx].value = 'mine';
                        placed++;
                    }
                }

                setGrid(newGrid);
                setGameState('PLAYING');
                setCurrentMult(1.00);
                setProfit(0);
            };

            const handleTileClick = (index) => {
                if (gameState !== 'PLAYING') return;
                const tile = grid[index];
                if (tile.revealed) return;

                const newGrid = [...grid];
                newGrid[index].revealed = true;

                if (tile.value === 'mine') {
                    // BOOM
                    setGameState('BOOM');
                    setGrid(newGrid.map(t => ({ ...t, revealed: true }))); // Reveal all
                    logGame(user.id, user.username, 'Mines', bet, 0, -bet);
                } else {
                    // GEM
                    setGrid(newGrid);
                    
                    // Calc math
                    const revealedCount = newGrid.filter(t => t.revealed).length;
                    const remainingTiles = 25 - (revealedCount - 1); // tiles before this click
                    const remainingSafe = (25 - minesCount) - (revealedCount - 1);
                    
                    const nextM = calculateNextMultiplier(currentMult, remainingTiles, remainingSafe);
                    setCurrentMult(nextM);
                }
            };

            const cashOut = async () => {
                if (gameState !== 'PLAYING') return;
                
                const winAmt = bet * currentMult;
                const prof = winAmt - bet;
                
                await onUpdateBalance(winAmt);
                setGameState('CASHED_OUT');
                setProfit(prof);
                setGrid(grid.map(t => ({ ...t, revealed: true }))); // Reveal all for transparency
                
                logGame(user.id, user.username, 'Mines', bet, winAmt, prof);
            };

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-950" },
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-rose-500 font-display font-bold text-xl tracking-widest" }, "MINES SWEEPER"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, `MINES: ${minesCount}`)
                ),

                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-4" },
                    
                    // Multiplier Badge
                    React.createElement('div', { className: `mb-6 text-3xl font-black font-mono ${gameState === 'BOOM' ? 'text-red-500' : 'text-green-400'}` }, 
                        `${currentMult.toFixed(2)}x`
                    ),

                    // The Grid
                    React.createElement('div', { className: "grid grid-cols-5 gap-2 sm:gap-3 w-full max-w-sm" },
                        grid.map((tile, i) => {
                            let content = null;
                            let style = "bg-dark-800 hover:bg-dark-700 border-white/10"; // Hidden state

                            if (tile.revealed) {
                                if (tile.value === 'mine') {
                                    style = "bg-red-500/80 border-red-500 shadow-[0_0_15px_#ef4444]";
                                    content = React.createElement(Bomb, { size: 24, className: "text-white animate-pop" });
                                } else {
                                    style = "bg-green-500/20 border-green-500";
                                    content = React.createElement(Gem, { size: 24, className: "text-green-400 animate-pop" });
                                }
                            }

                            return React.createElement('button', {
                                key: i,
                                onClick: () => handleTileClick(i),
                                disabled: gameState !== 'PLAYING' && !tile.revealed,
                                className: `aspect-square rounded-xl border flex items-center justify-center transition-all duration-200 active:scale-95 ${style}`
                            }, content);
                        })
                    ),

                    // Mines Config (Only when IDLE)
                    gameState === 'IDLE' && React.createElement('div', { className: "mt-8 w-full max-w-sm bg-dark-900 p-4 rounded-xl border border-white/5" },
                        React.createElement('div', { className: "flex justify-between text-xs text-gray-400 mb-2" }, React.createElement('span', {}, "Mines Amount"), React.createElement('span', {}, minesCount)),
                        React.createElement('input', { 
                            type: "range", min: "1", max: "24", value: minesCount, 
                            onChange: (e) => setMinesCount(Number(e.target.value)),
                            className: "w-full accent-rose-500" 
                        })
                    )
                ),

                // Dynamic Controls
                React.createElement('div', { className: "p-4 bg-dark-800 border-t border-white/10 flex flex-col gap-3" },
                    gameState === 'PLAYING' 
                        ? React.createElement(Button, { 
                            full: true, 
                            variant: 'green',
                            onClick: cashOut 
                          }, `CASHOUT ${(bet * currentMult).toFixed(0)} (${currentMult.toFixed(2)}x)`)
                        : React.createElement(BetControls, {
                            bet, setBet, balance: user.coins,
                            playing: gameState === 'PLAYING',
                            onPlay: startGame,
                            profit: profit
                          })
                )
            );
        };// --- GAME 7: PLINKO (Simplified Physics) ---
        const PlinkoGame = ({ user, onClose, onUpdateBalance }) => {
            const [bet, setBet] = useState(50);
            const [balls, setBalls] = useState([]); // Array of active balls
            const [history, setHistory] = useState([]);
            
            // Configuration: 8 Rows
            const ROWS = 8;
            // Multipliers for 8 rows (High variance edges, low middle)
            const MULTIPLIERS = [29, 4, 1.5, 0.3, 0.3, 1.5, 4, 29];
            
            const dropBall = async () => {
                if (user.coins < bet) return alert("Insufficient coins");
                await onUpdateBalance(-bet);

                // 1. Pre-calculate path (The "Physics")
                // House Edge: Slight weight towards center (0.3x)
                let currentPos = 0; // Center relative index
                const path = [];
                
                for (let i = 0; i < ROWS; i++) {
                    // Random Left (0) or Right (1)
                    // 50/50 normally, but we tweak slightly for House Edge
                    const dir = Math.random() < 0.52 ? 0.5 : -0.5; // Slight bias to center
                    currentPos += dir;
                    path.push(currentPos);
                }

                // Map final position to bin index (0 to 8)
                // Normalize currentPos (-4 to +4) to Index (0 to 8)
                const finalIndex = Math.floor(currentPos + (ROWS / 2));
                const clampedIndex = Math.max(0, Math.min(MULTIPLIERS.length - 1, finalIndex));
                const outcomeMult = MULTIPLIERS[clampedIndex];
                
                const ballId = Date.now();
                
                // Add ball to state to trigger render
                setBalls(prev => [...prev, { id: ballId, row: 0, pos: 0 }]);

                // Animate ball drop
                let currentRow = 0;
                const interval = setInterval(() => {
                    currentRow++;
                    if (currentRow <= ROWS) {
                        setBalls(prev => prev.map(b => 
                            b.id === ballId ? { ...b, row: currentRow, pos: path[currentRow - 1] } : b
                        ));
                    } else {
                        clearInterval(interval);
                        // Finish
                        handleFinish(ballId, outcomeMult);
                    }
                }, 300); // Speed of drop per row
            };

            const handleFinish = async (id, multiplier) => {
                // Remove ball
                setTimeout(() => setBalls(prev => prev.filter(b => b.id !== id)), 500);
                
                const winAmt = bet * multiplier;
                const profit = winAmt - bet;

                if (winAmt > 0) await onUpdateBalance(winAmt);
                
                setHistory(prev => [multiplier, ...prev].slice(0, 5));
                
                // Log (Consolidate profit logic: loss is negative profit)
                logGame(user.id, user.username, 'Plinko', bet, winAmt, profit);
            };

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-950" },
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-pink-500 font-display font-bold text-xl tracking-widest" }, "PLINKO"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, "ROWS: 8")
                ),

                React.createElement('div', { className: "flex-1 relative flex flex-col items-center pt-8 overflow-hidden" },
                    // The Pyramid Board
                    React.createElement('div', { className: "relative w-[300px] h-[300px]" },
                        // Pins
                        Array.from({ length: ROWS }).map((_, row) => 
                            React.createElement('div', { key: row, className: "flex justify-center gap-6 mb-8" },
                                Array.from({ length: row + 3 }).map((_, col) => 
                                    React.createElement('div', { key: col, className: "w-2 h-2 rounded-full bg-white/20 shadow-[0_0_5px_rgba(255,255,255,0.2)]" })
                                )
                            )
                        ),
                        
                        // Active Balls
                        balls.map(ball => 
                            React.createElement('div', { 
                                key: ball.id,
                                className: "absolute w-4 h-4 rounded-full bg-pink-500 shadow-[0_0_10px_#ec4899] transition-all duration-300 ease-in",
                                style: {
                                    top: `${ball.row * 32}px`, // approximate spacing
                                    left: `calc(50% + ${ball.pos * 30}px - 8px)` // approximate spacing
                                }
                            })
                        )
                    ),

                    // Multiplier Bins
                    React.createElement('div', { className: "flex gap-1 mt-auto mb-4" },
                        MULTIPLIERS.map((m, i) => {
                            // Color code bins based on value
                            let colorClass = "bg-dark-800 text-gray-400";
                            if (m >= 10) colorClass = "bg-red-600 text-white shadow-[0_0_15px_#dc2626]";
                            else if (m >= 2) colorClass = "bg-pink-600 text-white";
                            else if (m < 1) colorClass = "bg-dark-700 text-gray-600";
                            
                            return React.createElement('div', { key: i, className: `w-8 h-10 flex items-center justify-center text-[10px] font-bold rounded ${colorClass}` }, 
                                `${m}x`
                            );
                        })
                    ),
                    
                    // History
                    React.createElement('div', { className: "absolute top-4 right-4 flex flex-col gap-1" },
                        history.map((h, i) => React.createElement('div', { key: i, className: "text-xs font-mono text-pink-500 bg-pink-500/10 px-2 py-1 rounded" }, `${h}x`))
                    )
                ),

                React.createElement(BetControls, {
                    bet, setBet, balance: user.coins,
                    playing: false, // Plinko allows multiple drops
                    onPlay: dropBall,
                    profit: 0
                })
            );
        };

        // --- GAME 8: DICE (Over/Under) ---
        const DiceGame = ({ user, onClose, onUpdateBalance }) => {
            const [bet, setBet] = useState(100);
            const [target, setTarget] = useState(50);
            const [rollResult, setRollResult] = useState(null);
            const [rolling, setRolling] = useState(false);
            const [direction, setDirection] = useState('over'); // 'over' or 'under'
            const [profit, setProfit] = useState(0);

            // House Edge: 2%
            // Win Chance calculation
            const winChance = direction === 'over' ? (100 - target) : target;
            // Multiplier = (98 / WinChance)
            const multiplier = (98 / winChance).toFixed(4);

            const rollDice = async () => {
                if (user.coins < bet) return alert("Insufficient coins");
                await onUpdateBalance(-bet);
                setRolling(true);
                setRollResult(null);
                setProfit(0);

                // Animation
                let count = 0;
                const interval = setInterval(() => {
                    setRollResult(Math.floor(Math.random() * 100));
                    count++;
                    if (count > 10) {
                        clearInterval(interval);
                        finalizeRoll();
                    }
                }, 50);
            };

            const finalizeRoll = async () => {
                const finalRoll = Math.random() * 100;
                setRollResult(finalRoll);
                setRolling(false);

                let win = false;
                if (direction === 'over' && finalRoll > target) win = true;
                if (direction === 'under' && finalRoll < target) win = true;

                if (win) {
                    const winAmt = bet * multiplier;
                    const prof = winAmt - bet;
                    setProfit(prof);
                    await onUpdateBalance(winAmt);
                    logGame(user.id, user.username, 'Dice', bet, winAmt, prof);
                } else {
                    logGame(user.id, user.username, 'Dice', bet, 0, -bet);
                }
            };

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-950" },
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-blue-400 font-display font-bold text-xl tracking-widest" }, "DICE PRO"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, "EDGE: 2%")
                ),

                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-6" },
                    
                    // Result Display
                    React.createElement('div', { className: "relative mb-12 w-full max-w-lg" },
                        React.createElement('div', { className: "h-4 bg-dark-800 rounded-full w-full relative overflow-hidden" },
                            React.createElement('div', { 
                                className: `absolute top-0 bottom-0 transition-all duration-300 ${direction === 'over' ? 'right-0 bg-green-500' : 'left-0 bg-green-500'} opacity-20`,
                                style: { width: `${winChance}%` } 
                            }),
                            // Target Marker
                            React.createElement('div', { 
                                className: "absolute top-0 bottom-0 w-1 bg-white z-10", 
                                style: { left: `${target}%` } 
                            }),
                            // Result Marker (if exists)
                            rollResult !== null && React.createElement('div', {
                                className: `absolute top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border-2 border-white z-20 shadow-lg transition-all duration-300 ${profit > 0 ? 'bg-green-500' : 'bg-red-500'}`,
                                style: { left: `${rollResult}%` }
                            })
                        ),
                        
                        // Numeric Result
                        React.createElement('div', { className: "text-center mt-8" },
                            React.createElement('div', { className: "text-5xl font-black font-mono text-white" }, 
                                rollResult !== null ? rollResult.toFixed(2) : "00.00"
                            )
                        )
                    ),

                    // Controls Box
                    React.createElement('div', { className: "bg-dark-900 p-6 rounded-2xl border border-white/10 w-full max-w-sm" },
                         React.createElement('div', { className: "flex justify-between items-center mb-6" },
                             React.createElement('div', { className: "flex flex-col" },
                                 React.createElement('span', { className: "text-xs text-gray-400" }, "Multiplier"),
                                 React.createElement('span', { className: "text-xl font-bold text-gold-500" }, `${multiplier}x`)
                             ),
                             React.createElement('div', { className: "flex bg-dark-800 p-1 rounded-lg" },
                                 React.createElement('button', { onClick: ()=>setDirection('under'), className: `px-3 py-1 rounded text-xs font-bold ${direction==='under'?'bg-blue-500 text-white':'text-gray-400'}` }, "UNDER"),
                                 React.createElement('button', { onClick: ()=>setDirection('over'), className: `px-3 py-1 rounded text-xs font-bold ${direction==='over'?'bg-blue-500 text-white':'text-gray-400'}` }, "OVER")
                             ),
                             React.createElement('div', { className: "flex flex-col text-right" },
                                 React.createElement('span', { className: "text-xs text-gray-400" }, "Win Chance"),
                                 React.createElement('span', { className: "text-xl font-bold text-white" }, `${winChance.toFixed(0)}%`)
                             )
                         ),
                         
                         React.createElement('input', {
                             type: "range", min: "2", max: "98", value: target,
                             onChange: (e) => setTarget(Number(e.target.value)),
                             className: "w-full mb-4 accent-blue-500"
                         })
                    )
                ),

                React.createElement(BetControls, {
                    bet, setBet, balance: user.coins,
                    playing: rolling,
                    onPlay: rollDice,
                    profit: profit
                })
            );
        };

        // --- GAME 9: WHEEL (Spin to Win) ---
        const WheelGame = ({ user, onClose, onUpdateBalance }) => {
            const [bet, setBet] = useState(100);
            const [spinning, setSpinning] = useState(false);
            const [rotation, setRotation] = useState(0);
            const [profit, setProfit] = useState(0);

            // Segments: [Multiplier, Color, AngleSize]
            // Simplified: 8 segments of equal size for CSS ease
            // 0: 0x (Gray), 1: 2x (Green), 2: 0x, 3: 3x (Blue), 4: 0x, 5: 5x (Gold), 6: 0x, 7: 2x
            const SEGMENTS = [0, 2, 0, 3, 0, 5, 0, 2];
            const COLORS = ['#374151', '#22c55e', '#374151', '#3b82f6', '#374151', '#eab308', '#374151', '#22c55e'];
            
            const spinWheel = async () => {
                if (user.coins < bet) return alert("Insufficient coins");
                await onUpdateBalance(-bet);
                setSpinning(true);
                setProfit(0);

                // Math: Weighted Random
                // Heavy weight on 0x (House Edge)
                const rand = Math.random();
                let outcomeIndex; 
                
                if (rand < 0.5) outcomeIndex = [0, 2, 4, 6][Math.floor(Math.random()*4)]; // 50% Loss
                else if (rand < 0.8) outcomeIndex = [1, 7][Math.floor(Math.random()*2)]; // 30% 2x
                else if (rand < 0.95) outcomeIndex = 3; // 15% 3x
                else outcomeIndex = 5; // 5% 5x

                // Calculate Rotation
                // Base spins (5 full rotations) + Angle to target segment
                const segmentAngle = 360 / 8;
                // Target angle needs to align with the pointer (usually at top 0deg)
                // We rotate the wheel so the segment lands at 0deg.
                // outcomeIndex 0 is at 0-45deg. To land it at top, we rotate -22.5deg?
                // Let's keep it simple: Just rotate to specific calculated degree.
                const targetAngle = 360 * 5 + (360 - (outcomeIndex * segmentAngle)); 
                
                // Add random noise within segment to look real
                const noise = Math.random() * 30 - 15; 
                const finalRot = rotation + targetAngle + noise;
                
                setRotation(finalRot);

                setTimeout(async () => {
                    setSpinning(false);
                    const mult = SEGMENTS[outcomeIndex];
                    if (mult > 0) {
                        const winAmt = bet * mult;
                        const prof = winAmt - bet;
                        setProfit(prof);
                        await onUpdateBalance(winAmt);
                        logGame(user.id, user.username, 'Wheel', bet, winAmt, prof);
                    } else {
                        logGame(user.id, user.username, 'Wheel', bet, 0, -bet);
                    }
                }, 3000); // 3s spin time
            };

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-950" },
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-purple-500 font-display font-bold text-xl tracking-widest" }, "MEGA WHEEL"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, "RISK: HIGH")
                ),

                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center overflow-hidden" },
                    // Pointer
                    React.createElement('div', { className: "absolute top-[20%] z-20" },
                        React.createElement('div', { className: "w-0 h-0 border-l-[15px] border-l-transparent border-r-[15px] border-r-transparent border-t-[30px] border-t-white drop-shadow-lg" })
                    ),

                    // The Wheel Container
                    React.createElement('div', { 
                        className: "relative w-[300px] h-[300px] rounded-full border-4 border-dark-800 shadow-[0_0_50px_rgba(255,255,255,0.1)] overflow-hidden transition-transform duration-[3000ms] cubic-bezier(0.1, 0.7, 0.1, 1)",
                        style: { transform: `rotate(${rotation}deg)` }
                    },
                        // Segments (Conic Gradient hack is easier, but mapping divs allows content)
                        // Using Conic Gradient for background
                        React.createElement('div', {
                            className: "absolute inset-0 w-full h-full",
                            style: {
                                background: `conic-gradient(
                                    ${COLORS[0]} 0% 12.5%, ${COLORS[1]} 12.5% 25%, 
                                    ${COLORS[2]} 25% 37.5%, ${COLORS[3]} 37.5% 50%, 
                                    ${COLORS[4]} 50% 62.5%, ${COLORS[5]} 62.5% 75%, 
                                    ${COLORS[6]} 75% 87.5%, ${COLORS[7]} 87.5% 100%
                                )`
                            }
                        }),
                        
                        // Text Labels (Rotated to center of segments)
                        SEGMENTS.map((seg, i) => 
                            React.createElement('div', {
                                key: i,
                                className: "absolute w-full h-full flex justify-center pt-4 font-bold text-white text-lg",
                                style: { transform: `rotate(${i * 45 + 22.5}deg)` }
                            }, seg + 'x')
                        )
                    )
                ),

                React.createElement(BetControls, {
                    bet, setBet, balance: user.coins,
                    playing: spinning,
                    onPlay: spinWheel,
                    profit: profit
                })
            );
        };

        // --- GAME 10: HiLo (Card Guessing) ---
        const HiLoGame = ({ user, onClose, onUpdateBalance }) => {
            const [currentCard, setCurrentCard] = useState(generateCard());
            const [bet, setBet] = useState(100);
            const [gameState, setGameState] = useState('IDLE'); // IDLE, ACTIVE
            const [streak, setStreak] = useState(0);
            const [profit, setProfit] = useState(0);

            // Card values: A=1, 2-9, 10, J=11, Q=12, K=13
            function generateCard() {
                const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
                const suits = ['â™ ', 'â™¥', 'â™£', 'â™¦'];
                const rankIdx = Math.floor(Math.random() * 13);
                return {
                    rank: ranks[rankIdx],
                    suit: suits[Math.floor(Math.random() * 4)],
                    value: rankIdx + 1,
                    color: Math.random() > 0.5 ? 'red' : 'black' // Simplified color logic
                };
            }

            const startGame = async () => {
                if (user.coins < bet) return alert("Insufficient coins");
                await onUpdateBalance(-bet);
                setGameState('ACTIVE');
                setStreak(0);
                setProfit(0);
                setCurrentCard(generateCard());
            };

            const guess = async (type) => { // 'hi' or 'lo'
                const nextCard = generateCard();
                let win = false;
                
                if (type === 'hi' && nextCard.value > currentCard.value) win = true;
                if (type === 'lo' && nextCard.value < currentCard.value) win = true;
                // House Edge: Ties are losses (or push, but loss is better for house) -> Here Loss
                
                setCurrentCard(nextCard);

                if (win) {
                    setStreak(s => s + 1);
                    // Calculate multiplier based on probability
                    // Simplified: Fixed 1.3x for correct guess for demo
                    // In production: calc probability (13 - currVal)/13 etc.
                    const roundProfit = bet * 0.3; // 30% gain per correct guess
                    setProfit(p => p + roundProfit);
                    
                    // Allow continue? For this simple version, we cash out automatically or accum
                    // Let's Accumulate.
                } else {
                    setGameState('IDLE');
                    logGame(user.id, user.username, 'HiLo', bet, 0, -bet);
                    setProfit(0); // Lost accumulated
                }
            };

            const cashOut = async () => {
                const totalWin = bet + profit;
                await onUpdateBalance(totalWin);
                logGame(user.id, user.username, 'HiLo', bet, totalWin, profit);
                setGameState('IDLE');
                setStreak(0);
            };

            return React.createElement('div', { className: "flex flex-col h-full bg-dark-950" },
                React.createElement('div', { className: "flex items-center justify-between p-4 glass border-b border-white/5" },
                    React.createElement('button', { onClick: onClose, className: "text-gray-400 hover:text-white" }, React.createElement(ChevronLeft)),
                    React.createElement('h2', { className: "text-white font-display font-bold text-xl tracking-widest" }, "HI-LO"),
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1 rounded-full text-xs font-mono text-gray-400" }, "TIE LOSES")
                ),

                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-6" },
                    // The Card
                    React.createElement('div', { className: "w-48 h-72 bg-white rounded-2xl shadow-2xl flex flex-col items-center justify-between p-4 mb-8 animate-pop border-8 border-gray-200" },
                        React.createElement('div', { className: `text-4xl font-bold self-start ${currentCard.suit === 'â™¥' || currentCard.suit === 'â™¦' ? 'text-red-600' : 'text-black'}` }, currentCard.rank + currentCard.suit),
                        React.createElement('div', { className: `text-8xl ${currentCard.suit === 'â™¥' || currentCard.suit === 'â™¦' ? 'text-red-600' : 'text-black'}` }, currentCard.suit),
                        React.createElement('div', { className: `text-4xl font-bold self-end rotate-180 ${currentCard.suit === 'â™¥' || currentCard.suit === 'â™¦' ? 'text-red-600' : 'text-black'}` }, currentCard.rank + currentCard.suit)
                    ),
                    
                    gameState === 'ACTIVE' && React.createElement('div', { className: "text-green-500 font-mono font-bold text-xl mb-4" }, 
                        `PROFIT: +${profit.toFixed(2)}`
                    ),

                    // Game Controls
                    gameState === 'ACTIVE' ? React.createElement('div', { className: "flex flex-col gap-3 w-full max-w-xs" },
                        React.createElement('div', { className: "flex gap-3" },
                            React.createElement(Button, { onClick: () => guess('hi'), full: true, className: "bg-emerald-600 border-emerald-500" }, 
                                React.createElement('div', { className: "flex flex-col items-center" }, React.createElement(ArrowUp), "HIGHER")
                            ),
                            React.createElement(Button, { onClick: () => guess('lo'), full: true, className: "bg-red-600 border-red-500" }, 
                                React.createElement('div', { className: "flex flex-col items-center" }, React.createElement(ArrowDown), "LOWER")
                            )
                        ),
                        React.createElement(Button, { onClick: cashOut, variant: 'gold', full: true }, "CASHOUT")
                    ) : React.createElement(BetControls, {
                        bet, setBet, balance: user.coins,
                        playing: false,
                        onPlay: startGame,
                        profit: 0
                    })
                )
            );
        };
        // End of PART 4// --- ADMIN DASHBOARD ---
        const AdminDashboard = ({ user, onClose }) => {
            const [activeTab, setActiveTab] = useState('logs');
            const [logs, setLogs] = useState([]);
            const [users, setUsers] = useState([]);

            // Fetch Game Logs (Real-time)
            useEffect(() => {
                if (activeTab === 'logs') {
                    const q = query(collection(db, "game_logs"), orderBy("timestamp", "desc"), limit(50));
                    const unsub = onSnapshot(q, (snapshot) => {
                        setLogs(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));
                    });
                    return () => unsub();
                }
            }, [activeTab]);

            // Fetch Users (Real-time)
            useEffect(() => {
                if (activeTab === 'users') {
                    const q = query(collection(db, "users"), limit(20));
                    const unsub = onSnapshot(q, (snapshot) => {
                        setUsers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));
                    });
                    return () => unsub();
                }
            }, [activeTab]);

            return React.createElement('div', { className: "absolute inset-0 z-50 bg-dark-950 flex flex-col animate-slide-up" },
                // Header
                React.createElement('div', { className: "flex items-center justify-between p-4 border-b border-white/10 bg-dark-900" },
                    React.createElement('h2', { className: "text-gold-500 font-bold text-xl flex items-center gap-2" }, 
                        React.createElement(ShieldCheck, { size: 24 }), "ADMIN PANEL"
                    ),
                    React.createElement('button', { onClick: onClose, className: "p-2 bg-dark-800 rounded-lg hover:bg-red-900/50 text-white" }, React.createElement(XCircle))
                ),

                // Tabs
                React.createElement('div', { className: "flex p-4 gap-4 border-b border-white/5" },
                    React.createElement('button', { onClick: () => setActiveTab('logs'), className: `px-4 py-2 rounded-lg font-bold ${activeTab === 'logs' ? 'bg-gold-500 text-black' : 'bg-dark-800 text-gray-400'}` }, "GAME LOGS"),
                    React.createElement('button', { onClick: () => setActiveTab('users'), className: `px-4 py-2 rounded-lg font-bold ${activeTab === 'users' ? 'bg-gold-500 text-black' : 'bg-dark-800 text-gray-400'}` }, "USERS"),
                ),

                // Content
                React.createElement('div', { className: "flex-1 overflow-auto p-4" },
                    
                    // TAB: GAME LOGS
                    activeTab === 'logs' && React.createElement('div', { className: "overflow-x-auto" },
                        React.createElement('table', { className: "w-full text-left border-collapse" },
                            React.createElement('thead', { className: "bg-dark-800 text-gray-400 text-xs uppercase" },
                                React.createElement('tr', {},
                                    React.createElement('th', { className: "p-3" }, "Time"),
                                    React.createElement('th', { className: "p-3" }, "User"),
                                    React.createElement('th', { className: "p-3" }, "Game"),
                                    React.createElement('th', { className: "p-3" }, "Bet"),
                                    React.createElement('th', { className: "p-3" }, "Result"),
                                    React.createElement('th', { className: "p-3" }, "Profit")
                                )
                            ),
                            React.createElement('tbody', { className: "text-sm text-gray-300 divide-y divide-white/5" },
                                logs.map(log => React.createElement('tr', { key: log.id, className: "hover:bg-white/5" },
                                    React.createElement('td', { className: "p-3 font-mono text-xs" }, log.date ? new Date(log.date).toLocaleTimeString() : 'N/A'),
                                    React.createElement('td', { className: "p-3" }, log.username),
                                    React.createElement('td', { className: "p-3 font-bold text-gold-500" }, log.game),
                                    React.createElement('td', { className: "p-3 font-mono" }, log.bet.toFixed(2)),
                                    React.createElement('td', { className: "p-3" }, 
                                        React.createElement('span', { className: `px-2 py-1 rounded text-xs font-bold ${log.result === 'WIN' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}` }, log.result)
                                    ),
                                    React.createElement('td', { className: `p-3 font-mono font-bold ${log.profit > 0 ? 'text-green-400' : 'text-red-400'}` }, 
                                        (log.profit > 0 ? '+' : '') + log.profit.toFixed(2)
                                    )
                                ))
                            )
                        )
                    ),

                    // TAB: USERS
                    activeTab === 'users' && React.createElement('div', { className: "grid gap-4" },
                        users.map(u => React.createElement('div', { key: u.id, className: "bg-dark-800 p-4 rounded-xl flex justify-between items-center" },
                            React.createElement('div', {},
                                React.createElement('div', { className: "font-bold text-white" }, u.username),
                                React.createElement('div', { className: "text-xs text-gray-500" }, u.id)
                            ),
                            React.createElement('div', { className: "font-mono text-gold-500" }, u.coins?.toFixed(2) || '0.00')
                        ))
                    )
                )
            );
        };

        // --- SIDEBAR NAVIGATION ---
        const Sidebar = ({ isOpen, onClose, setView, onLogout, user }) => {
            const items = [
                { id: 'home', label: 'Home', icon: Home },
                { id: 'casino', label: 'Casino Games', icon: Gamepad2 },
                { id: 'wallet', label: 'Wallet', icon: Wallet },
                { id: 'tasks', label: 'Tasks', icon: Trophy },
                { id: 'support', label: 'Support', icon: Settings },
            ];

            return React.createElement('div', { className: `fixed inset-0 z-40 ${isOpen ? 'pointer-events-auto' : 'pointer-events-none'}` },
                // Backdrop
                React.createElement('div', { 
                    className: `absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity ${isOpen ? 'opacity-100' : 'opacity-0'}`,
                    onClick: onClose
                }),
                // Panel
                React.createElement('div', { 
                    className: `absolute left-0 top-0 bottom-0 w-64 bg-dark-900 border-r border-white/10 shadow-2xl transition-transform duration-300 ${isOpen ? 'translate-x-0' : '-translate-x-full'}`
                },
                    // User Info
                    React.createElement('div', { className: "p-6 border-b border-white/5" },
                        React.createElement('div', { className: "w-12 h-12 rounded-full bg-gradient-to-tr from-gold-400 to-gold-600 flex items-center justify-center text-black font-bold text-xl mb-3" }, user.username[0].toUpperCase()),
                        React.createElement('div', { className: "font-bold text-white" }, user.username),
                        React.createElement('div', { className: "text-xs text-gold-500 font-mono" }, `ID: ${user.id.slice(0,6)}`)
                    ),
                    
                    // Nav Items
                    React.createElement('nav', { className: "p-4 space-y-2" },
                        items.map(item => React.createElement('button', {
                            key: item.id,
                            onClick: () => { setView(item.id); onClose(); },
                            className: "w-full flex items-center gap-3 p-3 rounded-xl text-gray-400 hover:bg-white/5 hover:text-white transition-colors"
                        }, React.createElement(item.icon, { size: 20 }), item.label))
                    ),

                    // Logout
                    React.createElement('div', { className: "absolute bottom-0 left-0 right-0 p-4 border-t border-white/5" },
                        React.createElement('button', { 
                            onClick: onLogout,
                            className: "w-full flex items-center gap-3 p-3 rounded-xl text-red-500 hover:bg-red-500/10 transition-colors"
                        }, React.createElement(LogOut, { size: 20 }), "Sign Out")
                    )
                )
            );
        };

        // --- AUTH SCREEN ---
        const AuthScreen = ({ onLogin }) => {
            const [isRegister, setIsRegister] = useState(false);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                
                // Simulate Auth / Real Firestore Auth
                try {
                    // For demo purposes, we do a simple query. In production, use firebase/auth
                    let uid;
                    if (isRegister) {
                        const res = await addDoc(collection(db, "users"), {
                            username: email.split('@')[0],
                            email,
                            password, // NOTE: In prod, never store plain text passwords
                            coins: 1000, // Welcome Bonus
                            role: 'user',
                            createdAt: serverTimestamp()
                        });
                        uid = res.id;
                    } else {
                        // Simple login query
                        const q = query(collection(db, "users"), where("email", "==", email), where("password", "==", password));
                        const snapshot = await getDocs(q);
                        if (snapshot.empty) throw new Error("Invalid credentials");
                        uid = snapshot.docs[0].id;
                    }
                    
                    localStorage.setItem('casino_uid', uid);
                    onLogin(uid);
                } catch (err) {
                    alert(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return React.createElement('div', { className: "h-screen flex items-center justify-center bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] bg-dark-950 p-6" },
                React.createElement('div', { className: "w-full max-w-sm bg-dark-900 border border-white/10 p-8 rounded-3xl shadow-2xl animate-pop" },
                    React.createElement('div', { className: "text-center mb-8" },
                        React.createElement('h1', { className: "text-4xl font-black text-gold-500 font-display mb-2" }, "CASINO ROYAL"),
                        React.createElement('p', { className: "text-gray-400 text-sm" }, "Secure â€¢ Fair â€¢ Elite")
                    ),
                    React.createElement('form', { onSubmit: handleSubmit, className: "space-y-4" },
                        React.createElement(Input, { value: email, onChange: e=>setEmail(e.target.value), placeholder: "Email / Username", icon: User }),
                        React.createElement(Input, { value: password, onChange: e=>setPassword(e.target.value), type: "password", placeholder: "Password", icon: Lock }),
                        React.createElement(Button, { full: true, loading: loading, onClick: handleSubmit }, isRegister ? "REGISTER NOW" : "LOGIN"),
                    ),
                    React.createElement('button', { 
                        onClick: () => setIsRegister(!isRegister),
                        className: "w-full text-center mt-6 text-xs text-gray-500 hover:text-white"
                    }, isRegister ? "Already have an account? Login" : "Create an account")
                )
            );
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home'); // home, casino, [game-name]
            const [menuOpen, setMenuOpen] = useState(false);
            const [showAdmin, setShowAdmin] = useState(false);

            // Auth Check
            useEffect(() => {
                const uid = localStorage.getItem('casino_uid');
                if (uid) fetchUser(uid);
            }, []);

            const fetchUser = (uid) => {
                const unsub = onSnapshot(doc(db, "users", uid), (doc) => {
                    if (doc.exists()) {
                        setUser({ id: doc.id, ...doc.data() });
                    }
                });
                return unsub;
            };

            const handleLogout = () => {
                localStorage.removeItem('casino_uid');
                setUser(null);
            };

            const handleBalanceUpdate = async (amount) => {
                if (!user) return;
                try {
                    const newBalance = user.coins + amount;
                    // Optimistic update done by snapshot, but we ensure write
                    await updateDoc(doc(db, "users", user.id), {
                        coins: newBalance
                    });
                } catch (e) {
                    console.error("Balance Error", e);
                }
            };

            if (!user) return React.createElement(AuthScreen, { onLogin: fetchUser });

            // Views Map
            const renderView = () => {
                switch (view) {
                    case 'game-crash': return React.createElement(CrashGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    case 'game-slots': return React.createElement(SlotsGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    case 'game-limbo': return React.createElement(LimboGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    case 'game-keno': return React.createElement(KenoGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    case 'game-coinflip': return React.createElement(CoinFlipGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    case 'game-mines': return React.createElement(MinesGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    case 'game-plinko': return React.createElement(PlinkoGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    case 'game-dice': return React.createElement(DiceGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    case 'game-wheel': return React.createElement(WheelGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    case 'game-hilo': return React.createElement(HiLoGame, { user, onClose: () => setView('casino'), onUpdateBalance: handleBalanceUpdate });
                    
                    case 'casino': return React.createElement('div', { className: "p-4 grid grid-cols-2 gap-4 pb-24" },
                        React.createElement(Card, { title: "Crash", icon: Rocket, color: "red", onClick: () => setView('game-crash') }),
                        React.createElement(Card, { title: "Slots", icon: Gem, color: "purple", onClick: () => setView('game-slots') }),
                        React.createElement(Card, { title: "Mines", icon: Bomb, color: "rose", isNew: true, onClick: () => setView('game-mines') }),
                        React.createElement(Card, { title: "Plinko", icon: Zap, color: "pink", onClick: () => setView('game-plinko') }),
                        React.createElement(Card, { title: "Limbo", icon: Target, color: "green", onClick: () => setView('game-limbo') }),
                        React.createElement(Card, { title: "CoinFlip", icon: Coins, color: "blue", onClick: () => setView('game-coinflip') }),
                        React.createElement(Card, { title: "Keno", icon: BarChart3, color: "emerald", onClick: () => setView('game-keno') }),
                        React.createElement(Card, { title: "Dice", icon: Dices, color: "blue", onClick: () => setView('game-dice') }),
                        React.createElement(Card, { title: "Wheel", icon: RotateCw, color: "purple", onClick: () => setView('game-wheel') }),
                        React.createElement(Card, { title: "Hi-Lo", icon: ArrowUp, color: "yellow", onClick: () => setView('game-hilo') }),
                    );

                    case 'wallet': return React.createElement('div', { className: "p-6 flex flex-col items-center justify-center h-full" },
                        React.createElement(Wallet, { size: 64, className: "text-gold-500 mb-4" }),
                        React.createElement('h2', { className: "text-2xl font-bold mb-2" }, "Your Balance"),
                        React.createElement('div', { className: "text-4xl font-mono text-white mb-8" }, user.coins.toFixed(2)),
                        React.createElement(Button, { full: true, className: "mb-4" }, "DEPOSIT"),
                        React.createElement(Button, { full: true, variant: "dark" }, "WITHDRAW")
                    );

                    default: // HOME
                        return React.createElement('div', { className: "p-6 space-y-6" },
                            React.createElement('div', { className: "bg-gradient-to-r from-gold-500 to-gold-700 rounded-3xl p-6 shadow-lg text-black" },
                                React.createElement('div', { className: "text-xs font-bold opacity-70 mb-1" }, "TOTAL BALANCE"),
                                React.createElement('div', { className: "text-4xl font-black font-mono" }, user.coins.toFixed(2)),
                                React.createElement('div', { className: "mt-4 flex gap-3" },
                                    React.createElement('button', { className: "bg-black/20 hover:bg-black/30 px-4 py-2 rounded-lg font-bold text-xs" }, "DEPOSIT"),
                                    React.createElement('button', { onClick: () => setView('casino'), className: "bg-black text-white px-4 py-2 rounded-lg font-bold text-xs" }, "PLAY NOW")
                                )
                            ),
                            React.createElement('div', {},
                                React.createElement('h3', { className: "font-bold text-gray-400 mb-4" }, "FEATURED GAMES"),
                                React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                    React.createElement(Card, { title: "Crash", icon: Rocket, color: "red", onClick: () => setView('game-crash') }),
                                    React.createElement(Card, { title: "Plinko", icon: Zap, color: "pink", isNew: true, onClick: () => setView('game-plinko') })
                                )
                            )
                        );
                }
            };

            return React.createElement('div', { className: "h-screen w-full bg-dark-950 text-white flex flex-col overflow-hidden font-sans" },
                // Top Bar
                React.createElement('div', { className: "h-16 border-b border-white/5 bg-dark-900 flex items-center justify-between px-4 shrink-0 z-30" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                        React.createElement('button', { onClick: () => setMenuOpen(true), className: "text-white" }, React.createElement(Menu)),
                        React.createElement('span', { className: "font-display font-black text-gold-500 text-xl tracking-wider" }, "ROYAL")
                    ),
                    React.createElement('div', { className: "flex gap-2 items-center" },
                        React.createElement('div', { className: "bg-dark-800 px-3 py-1.5 rounded-full border border-gold-500/20 flex items-center gap-2" },
                            React.createElement(Gem, { size: 14, className: "text-gold-500" }),
                            React.createElement('span', { className: "text-sm font-bold font-mono" }, user.coins.toFixed(0))
                        ),
                        // Admin Toggle (Hidden for normal users in prod, visible here for demo)
                        React.createElement('button', { onClick: () => setShowAdmin(true), className: "p-2 bg-dark-800 rounded-full text-gray-400 hover:text-white" }, React.createElement(ShieldCheck, { size: 18 }))
                    )
                ),

                // Main Content
                React.createElement('main', { className: "flex-1 overflow-hidden relative" },
                    renderView()
                ),

                // Sidebar & Modals
                React.createElement(Sidebar, { isOpen: menuOpen, onClose: () => setMenuOpen(false), setView, onLogout: handleLogout, user }),
                showAdmin && React.createElement(AdminDashboard, { user, onClose: () => setShowAdmin(false) })
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
