<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CD0777 Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: { 100: '#FFF9C4', 300: '#FDD835', 500: '#FFD700', 600: '#C0A000', 800: '#8A7000' },
                        dark: { 900: '#000000', 800: '#121212', 700: '#1E1E1E' }
                    },
                    backgroundImage: {
                        'luxury': 'linear-gradient(135deg, #1a1a1a 0%, #000 100%)',
                        'card-shine': 'linear-gradient(105deg, transparent 20%, rgba(255,215,0,0.4) 25%, transparent 30%)'
                    },
                    animation: {
                        'shine': 'shine 4s infinite linear'
                    },
                    keyframes: {
                        shine: { '0%': { backgroundPosition: '200% center' }, '100%': { backgroundPosition: '-200% center' } }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Oswald:wght@500&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #000; color: #fff; overflow: hidden; }
        .font-tech { font-family: 'Share Tech Mono', monospace; }
        .font-oswald { font-family: 'Oswald', sans-serif; }
        .glass-panel { background: rgba(30, 30, 30, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 215, 0, 0.15); }
        .gold-text { background: linear-gradient(to bottom, #FFD700, #FDB931); -webkit-background-clip: text; color: transparent; }
        input, select { outline: none; }
        /* Disable scrollbar */
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.294.0",
                "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
            }
        }
    </script>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { User, Gamepad2, LogOut, Send, CheckCircle, XCircle, ChevronRight, Lock, Gem, Home, CreditCard, Wallet, ShieldCheck, Trophy, Instagram, Facebook, ExternalLink, Plus, Trash2, Smartphone, Globe } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, where, getDocs, deleteDoc } from 'firebase/firestore';

        // =======================================================
        // üî¥ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ™ÿπÿØŸäŸÑ: ÿ∂ÿπ ŸÉŸàÿØ FIREBASE ŸáŸÜÿß üî¥
        // =======================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDJ5B7MncMfyjwb0ZnZ8p3d0bsoQAFqZQY",
  authDomain: "cd0777-casino.firebaseapp.com",
  projectId: "cd0777-casino",
  storageBucket: "cd0777-casino.firebasestorage.app",
  messagingSenderId: "320546250152",
  appId: "1:320546250152:web:730f6e581267b9b315919d"
        };
        // =======================================================

        let db; try { const app = initializeApp(firebaseConfig); db = getFirestore(app); } catch (e) { console.error(e); }

        const LINKS = {
            TELEGRAM: "https://t.me/cd0777cc",
            ONEXBET: "https://1xlite-81807.bar/mobile?bf=cb1696c403824_11662230653",
            INSTAGRAM: "https://www.instagram.com/p/DSEHfeWiAWo/?igsh=bWMxZTMxcGJoMWx6",
            FACEBOOK: "https://www.facebook.com/share/p/17gNCDYUYs/"
        };

        // --- COMPONENTS ---
        const Button = ({ children, onClick, disabled, variant='gold', full, className='' }) => {
            const styles = {
                gold: 'bg-gradient-to-b from-[#FFD700] to-[#B8860B] text-black shadow-[0_4px_15px_rgba(218,165,32,0.4)] border border-[#FFD700]',
                green: 'bg-gradient-to-r from-emerald-600 to-green-500 text-white shadow-[0_4px_15px_rgba(16,185,129,0.3)]',
                dark: 'bg-dark-800 text-gold-500 border border-gold-500/30'
            };
            return React.createElement('button', { onClick, disabled, className: `relative font-bold py-3 px-4 rounded-xl active:scale-95 transition-all disabled:opacity-50 disabled:grayscale ${styles[variant]} ${full?'w-full':''} ${className}` }, children);
        };

        const Input = (props) => React.createElement('input', { ...props, className: "w-full bg-dark-800 border border-white/10 p-3 rounded-xl text-white focus:border-gold-500 focus:shadow-[0_0_10px_rgba(255,215,0,0.2)] transition-all placeholder:text-gray-600" });

        // --- MAIN APP ---
        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('auth');
            const [notify, setNotify] = useState(null);

            useEffect(() => {
                const uid = localStorage.getItem('cd0777_uid');
                if (uid && db) {
                    return onSnapshot(doc(db, "users", uid), (s) => {
                        if (s.exists()) {
                            const u = { id: s.id, ...s.data() };
                            setUser(u);
                            if (view === 'auth') setView(u.role === 'admin' ? 'admin' : 'home');
                        }
                    });
                }
            }, []);

            const showMsg = (msg, type='success') => { setNotify({msg, type}); setTimeout(()=>setNotify(null), 3000); };
            const logout = () => { localStorage.removeItem('cd0777_uid'); setUser(null); setView('auth'); };

            if (!user && view === 'auth') return React.createElement(AuthScreen, { setUser, setView, showMsg });
            if (user?.role === 'admin' && view === 'admin') return React.createElement(AdminPanel, { user, logout });
            if (view === 'crash') return React.createElement(CrashGame, { user, back: ()=>setView('home'), showMsg });
            if (view === 'plinko') return React.createElement(PlinkoGame, { user, back: ()=>setView('home'), showMsg });

            return React.createElement('div', { className: "h-screen flex flex-col bg-black text-white relative overflow-hidden" },
                React.createElement('div', { className: "fixed inset-0 pointer-events-none bg-[radial-gradient(circle_at_top,_#222_0%,_#000_100%)]" }),
                notify && React.createElement('div', { className: `fixed top-6 left-1/2 -translate-x-1/2 z-[60] px-6 py-3 rounded-xl border shadow-2xl flex items-center gap-2 animate-bounce glass-panel` }, 
                    React.createElement('span', { className: "text-sm font-bold " + (notify.type==='error'?'text-red-400':'text-green-400') }, notify.msg)
                ),
                React.createElement('main', { className: "flex-1 overflow-y-auto p-4 pb-24 relative z-10" },
                    React.createElement(Header, { user, logout }),
                    view === 'home' && React.createElement(HomeScreen, { user, setView }),
                    view === 'tasks' && React.createElement(TasksScreen, { user, showMsg }),
                    view === 'profile' && React.createElement(ProfileScreen, { user, showMsg })
                ),
                React.createElement('nav', { className: "fixed bottom-0 w-full h-20 glass-panel z-50 flex justify-around items-center max-w-md left-0 right-0 mx-auto border-t-0 rounded-t-2xl" },
                    React.createElement(NavBtn, { icon: Home, label: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©", active: view==='home', onClick: ()=>setView('home') }),
                    React.createElement(NavBtn, { icon: Trophy, label: "ÿßŸÑŸÖŸáÿßŸÖ", active: view==='tasks', onClick: ()=>setView('tasks') }),
                    React.createElement(NavBtn, { icon: Wallet, label: "ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©", active: view==='profile', onClick: ()=>setView('profile') })
                )
            );
        }

        // --- HEADER ---
        function Header({ user, logout }) {
            return React.createElement('div', { className: "flex justify-between items-center mb-6 pb-4 border-b border-white/5" },
                React.createElement('div', { className: "flex items-center gap-2" },
                    React.createElement('div', { className: "w-10 h-10 rounded-lg bg-gradient-to-tr from-gold-600 to-gold-300 flex items-center justify-center text-black font-black shadow-lg shadow-gold-500/20" }, "CD"),
                    React.createElement('div', {}, React.createElement('div', { className: "font-oswald text-gold-500 text-lg leading-none" }, "CD0777"), React.createElement('div', { className: "text-[9px] text-gray-500 tracking-[0.3em] uppercase" }, "Exclusive"))
                ),
                React.createElement('div', { className: "flex items-center gap-3" },
                    React.createElement('div', { className: "bg-dark-800 px-3 py-1.5 rounded-full border border-white/10 flex items-center gap-2" },
                        React.createElement(Gem, { size: 14, className: "text-gold-500" }),
                        React.createElement('span', { className: "font-tech font-bold text-gold-500" }, user.coins?.toLocaleString() || 0)
                    ),
                    React.createElement('button', { onClick: logout, className: "text-gray-500 hover:text-red-500" }, React.createElement(LogOut, { size: 20 }))
                )
            );
        }
        const NavBtn = ({ icon: Icon, label, active, onClick }) => React.createElement('button', { onClick, className: `flex flex-col items-center gap-1 transition-all ${active?'text-gold-500 -translate-y-1 drop-shadow-[0_0_8px_rgba(255,215,0,0.5)]':'text-gray-600'}` }, React.createElement(Icon, { size: 24, strokeWidth: active?2.5:2 }), React.createElement('span', { className: "text-[10px] font-bold" }, label));

        // --- LUXURY CARD ---
        function HomeScreen({ user, setView }) {
            const isPending = user.status === 'pending';
            return React.createElement('div', { className: "space-y-6 animate-in fade-in zoom-in" },
                // Luxury Card Design
                React.createElement('div', { className: "relative aspect-[1.58/1] rounded-2xl overflow-hidden shadow-2xl shadow-black group transform transition-transform hover:scale-[1.01] border border-gold-500/20" },
                    React.createElement('div', { className: "absolute inset-0 bg-luxury" }),
                    // Texture
                    React.createElement('div', { className: "absolute inset-0 opacity-10", style: { backgroundImage: 'radial-gradient(circle at 50% 50%, #FFD700 1px, transparent 1px)', backgroundSize: '20px 20px' } }),
                    // Shine Effect
                    React.createElement('div', { className: "absolute inset-0 bg-card-shine bg-[length:200%_100%] animate-shine opacity-30" }),
                    
                    React.createElement('div', { className: "relative h-full p-6 flex flex-col justify-between z-10" },
                        React.createElement('div', { className: "flex justify-between items-start" },
                            React.createElement('div', {}, 
                                React.createElement('h2', { className: "font-oswald text-2xl gold-text tracking-widest" }, "CD0777"),
                                React.createElement('div', { className: "text-[8px] text-gold-600 tracking-[0.4em] uppercase" }, "Black Membership")
                            ),
                            React.createElement('div', { className: `px-2 py-0.5 rounded text-[9px] font-bold border ${!isPending ? 'border-green-500/50 text-green-400 bg-green-900/20' : 'border-yellow-600/50 text-yellow-500 bg-yellow-900/20'}` }, !isPending ? 'ACTIVE' : 'REVIEW')
                        ),
                        
                        // ID Section - Center & Embossed look
                        React.createElement('div', { className: "text-center my-auto" }, 
                            React.createElement('p', { className: "font-tech text-3xl text-white/90 tracking-[0.2em] drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)]" }, user.memberId)
                        ),
                        
                        React.createElement('div', { className: "flex justify-between text-[9px] uppercase text-gray-500 font-bold tracking-widest" },
                            React.createElement('div', {}, 
                                React.createElement('p', { className: "text-gold-600 mb-0.5" }, "CARD HOLDER"), 
                                React.createElement('p', { className: "text-gray-200" }, user.fullName.toUpperCase())
                            ),
                            React.createElement('div', { className: "text-right" }, 
                                React.createElement('p', { className: "text-gold-600 mb-0.5" }, "VALID THRU"), 
                                React.createElement('p', { className: "text-gray-200" }, "12/30")
                            )
                        )
                    )
                ),
                
                // Pending Alert
                isPending && React.createElement('div', { className: "glass-panel rounded-2xl p-4 space-y-3" },
                    React.createElement('h3', { className: "text-gold-500 text-sm font-bold flex items-center gap-2" }, React.createElement(Lock, {size:14}), "ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿπÿ∂ŸàŸäÿ©:"),
                    React.createElement('button', { onClick: ()=>window.open(LINKS.ONEXBET), className: "w-full bg-[#1a2b3c] p-3 rounded-xl flex items-center gap-3 border border-white/5" },
                        React.createElement('div', { className: "w-8 h-8 bg-white rounded flex items-center justify-center font-black text-black text-xs" }, "1X"),
                        React.createElement('div', { className: "text-right flex-1" }, React.createElement('div', { className: "text-xs font-bold" }, "ÿ≥ÿ¨ŸÑ ŸÅŸä 1XBET"), React.createElement('div', { className: "text-[10px] text-blue-200" }, "ŸÉŸàÿØ: CD0777"))
                    ),
                    React.createElement('button', { onClick: ()=>window.open(LINKS.TELEGRAM), className: "w-full bg-[#229ED9]/20 p-3 rounded-xl flex items-center gap-3 border border-white/5" },
                        React.createElement('div', { className: "w-8 h-8 bg-[#229ED9] rounded flex items-center justify-center text-white" }, React.createElement(Send, { size: 16 })),
                        React.createElement('div', { className: "text-right flex-1" }, React.createElement('div', { className: "text-xs font-bold" }, "ÿßŸÜÿ∂ŸÖ ŸÑÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ"), React.createElement('div', { className: "text-[10px] text-gray-300" }, "ŸÑŸÑÿ™ŸàÿµŸäÿßÿ™"))
                    )
                ),

                // Game Links
                React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                    React.createElement(GameCard, { title: "CRASH", sub: "ROCKET", color: "red", onClick: ()=>setView('crash') }),
                    React.createElement(GameCard, { title: "PLINKO", sub: "DROP", color: "purple", onClick: ()=>setView('plinko') })
                )
            );
        }

        const GameCard = ({ title, sub, color, onClick }) => 
            React.createElement('button', { onClick, className: `h-36 relative rounded-xl overflow-hidden border border-white/5 bg-dark-800 hover:border-${color}-500/50 transition-all group` },
                React.createElement('div', { className: `absolute inset-0 bg-gradient-to-t from-${color}-900/40 to-transparent opacity-50` }),
                React.createElement('div', { className: "absolute bottom-3 right-3 text-right z-10" },
                    React.createElement('h3', { className: "text-2xl font-black italic text-white" }, title),
                    React.createElement('p', { className: `text-[10px] text-${color}-300 tracking-widest` }, sub)
                )
            );

        // --- TASKS (HISTORY MODE) ---
        function TasksScreen({ user, showMsg }) {
            const [tasks, setTasks] = useState([]);
            useEffect(() => { if(db) onSnapshot(collection(db, "tasks"), s => setTasks(s.docs.map(d=>({id:d.id, ...d.data()})))); }, []);
            
            const handleTask = (t) => {
                window.open(t.url, '_blank');
                setTimeout(async () => {
                    if(!db) return;
                    const comp = user.completedTasks || [];
                    if(!comp.includes(t.id)) {
                        await updateDoc(doc(db, "users", user.id), { 
                            coins: user.coins + Number(t.reward), 
                            completedTasks: [...comp, t.id]
                        });
                        showMsg(`ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ${t.reward} ÿπŸÖŸÑÿ©!`);
                    }
                }, 3000);
            };

            const completed = user.completedTasks || [];

            return React.createElement('div', { className: "space-y-4" },
                React.createElement('h2', { className: "text-gold-500 font-bold text-lg" }, "ÿßŸÑŸÖŸáÿßŸÖ ÿßŸÑŸäŸàŸÖŸäÿ©"),
                tasks.length === 0 && React.createElement('div', { className: "text-center text-gray-500 py-10" }, "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸáÿßŸÖ ÿ≠ÿßŸÑŸäÿßŸã"),
                tasks.map(t => {
                    const isDone = completed.includes(t.id);
                    return React.createElement('div', { key: t.id, className: `p-4 rounded-xl flex justify-between items-center border ${isDone ? 'bg-dark-800 border-white/5 opacity-60' : 'bg-dark-800 border-gold-500/30'}` },
                        React.createElement('div', {}, 
                            React.createElement('div', { className: "font-bold text-sm text-white" }, t.title), 
                            React.createElement('div', { className: "text-xs text-gold-500" }, `+${t.reward} C`)
                        ),
                        isDone 
                        ? React.createElement('div', { className: "flex items-center gap-1 text-green-500 text-xs font-bold" }, React.createElement(CheckCircle, {size:14}), "ŸÖŸÉÿ™ŸÖŸÑ")
                        : React.createElement('button', { onClick: ()=>handleTask(t), className: "text-xs bg-gold-500 text-black px-4 py-2 rounded-lg font-bold hover:scale-105 transition-transform" }, "ÿ™ŸÜŸÅŸäÿ∞")
                    );
                })
            );
        }

        // --- WITHDRAWAL (SMART INPUTS) ---
        function ProfileScreen({ user, showMsg }) {
            const [mod, setMod] = useState(false); const [method, setMethod] = useState(''); 
            // Form States
            const [idVal, setIdVal] = useState('');
            const [phone, setPhone] = useState('');
            const [network, setNetwork] = useState('IAM');

            const conv = async () => { if(user.status!=='active') return showMsg('ÿ∫Ÿäÿ± ŸÖŸÅÿπŸÑ','error'); if(user.coins<1000) return showMsg('ÿßŸÑÿ≠ÿØ 1000','error'); const d=Math.floor(user.coins/1000); await updateDoc(doc(db,"users",user.id),{coins:user.coins-(d*1000),balance:user.balance+d}); showMsg('ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ'); };
            
            const submitWithdraw = async () => {
                let details = "";
                if(method === '1XBET') {
                    if(!idVal) return showMsg("ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖÿπÿ±ŸÅ (ID)", "error");
                    details = `ID: ${idVal}`;
                } else if (method === 'Mobile') {
                    if(!phone) return showMsg("ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ", "error");
                    details = `Phone: ${phone} | Net: ${network}`;
                } else {
                    details = `PayPal Email: ${idVal}`; // Placeholder
                }

                await addDoc(collection(db,"withdrawals"),{userId:user.id, userName:user.fullName, memberId:user.memberId, amount:user.balance, method, details, status:'pending', date:new Date().toLocaleDateString()});
                await updateDoc(doc(db,"users",user.id),{balance:0});
                setMod(false); setIdVal(''); setPhone(''); showMsg('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®');
            };

            const renderInputs = () => {
                if(method === '1XBET') return React.createElement(Input, { placeholder: "ÿ£ÿØÿÆŸÑ ŸÖÿπÿ±ŸÅ ÿßŸÑÿ≠ÿ≥ÿßÿ® (ID)", value: idVal, onChange: e=>setIdVal(e.target.value) });
                if(method === 'Mobile') return React.createElement('div', { className: "space-y-2" },
                    React.createElement(Input, { placeholder: "ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ", value: phone, onChange: e=>setPhone(e.target.value) }),
                    React.createElement('select', { value: network, onChange: e=>setNetwork(e.target.value), className: "w-full bg-dark-800 border border-white/10 p-3 rounded-xl text-white" },
                        React.createElement('option', {value:"IAM"}, "ÿßÿ™ÿµÿßŸÑÿßÿ™ ÿßŸÑŸÖÿ∫ÿ±ÿ® (IAM)"),
                        React.createElement('option', {value:"Orange"}, "ÿ£Ÿàÿ±ŸÜÿ¨ (Orange)"),
                        React.createElement('option', {value:"Inwi"}, "ÿ•ŸÜŸàŸä (Inwi)")
                    )
                );
                return React.createElement(Input, { placeholder: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä / ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™", value: idVal, onChange: e=>setIdVal(e.target.value) });
            };

            return React.createElement('div', { className: "space-y-6" },
                React.createElement('div', { className: "bg-gradient-to-br from-dark-800 to-black p-6 rounded-2xl border border-white/5 text-center" },
                    React.createElement('div', { className: "text-xs text-gray-500 uppercase tracking-widest" }, "ÿßŸÑÿ±ÿµŸäÿØ ÿßŸÑŸÇÿßÿ®ŸÑ ŸÑŸÑÿ≥ÿ≠ÿ®"),
                    React.createElement('div', { className: "text-4xl font-mono font-bold text-gold-500 my-2" }, `$${user.balance.toFixed(2)}`),
                    React.createElement('button', { onClick: conv, className: "text-xs bg-dark-700 text-gray-300 border border-white/10 px-4 py-2 rounded hover:bg-dark-800" }, "ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ÿ•ŸÑŸâ ÿ±ÿµŸäÿØ")
                ),
                React.createElement('div', { className: "space-y-2" }, 
                    ['1XBET','Mobile','PayPal'].map(m => React.createElement('button', { key: m, disabled: user.status!=='active', onClick: ()=>{setMethod(m);setMod(true)}, className: "w-full flex justify-between p-4 bg-dark-800 rounded-xl border border-white/5 disabled:opacity-50 hover:border-gold-500/50 transition-colors" }, 
                        React.createElement('span', { className: "font-bold text-white" }, m), 
                        user.status==='active' ? React.createElement(ChevronRight,{size:16, className:"text-gold-500"}) : React.createElement(Lock,{size:16, className:"text-red-500"})
                    ))
                ),
                mod && React.createElement('div', { className: "fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-6" },
                    React.createElement('div', { className: "w-full bg-[#111] p-6 rounded-2xl space-y-4 border border-gold-500/30" },
                        React.createElement('h3', { className: "text-gold-500 font-bold text-lg" }, `ÿ≥ÿ≠ÿ® ÿπÿ®ÿ± ${method}`),
                        renderInputs(),
                        React.createElement(Button, { full: true, onClick: submitWithdraw }, "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®"),
                        React.createElement('button', { onClick: ()=>setMod(false), className: "w-full text-gray-500 text-sm py-2" }, "ÿ•ŸÑÿ∫ÿßÿ°")
                    )
                )
            );
        }

        // --- GAMES (Robust & Crash-Proof) ---
        function CrashGame({ user, back, showMsg }) {
            const cvsRef = useRef(null); const [bet, setBet] = useState(100); const [st, setSt] = useState('IDLE'); const [cashed, setCashed] = useState(false); const gm = useRef({s:0, c:0, a:null, m:1.0});
            
            // Safe Betting: Update UI first, then DB (Optimistic UI) but handle errors
            const start = async () => {
                if(user.coins < bet) return showMsg('ÿ±ÿµŸäÿØ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸä', 'error');
                try {
                    // Start Game Logic
                    setSt('RUNNING'); setCashed(false);
                    await updateDoc(doc(db,"users",user.id),{coins:user.coins-bet});
                    
                    let c = 0.99/(1-Math.random()); if(Math.random()<0.05) c=1.0; if(c>50) c=50;
                    gm.current = {s:Date.now(), c:Math.max(1.0, c), a:null, m:1.0}; loop();
                } catch(e) {
                    setSt('IDLE'); showMsg('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ', 'error');
                }
            };

            const cash = async () => {
                if(st!=='RUNNING'||cashed) return;
                setCashed(true); // Lock button immediately
                const w = Math.floor(bet * gm.current.m);
                await updateDoc(doc(db,"users",user.id),{coins: user.coins + w}); // Add win (balance already deducted)
                showMsg(`ÿ±ÿ®ÿ≠ÿ™ ${w} ÿπŸÖŸÑÿ©!`,'success');
            };

            const loop = () => {
                const ctx = cvsRef.current?.getContext('2d'); if(!ctx) return;
                const {width:w, height:h} = cvsRef.current;
                const el = (Date.now()-gm.current.s)/1000;
                const nm = 1.0 + el*el*0.1 + el*0.05; gm.current.m = nm;
                if(nm>=gm.current.c) { setSt('CRASHED'); draw(ctx,w,h,gm.current.c,true); return; }
                draw(ctx,w,h,nm,false); gm.current.a = requestAnimationFrame(loop);
            };

            const draw = (ctx,w,h,v,cr) => {
                ctx.fillStyle='#000'; ctx.fillRect(0,0,w,h);
                // Grid
                ctx.strokeStyle='#222'; ctx.lineWidth=1; ctx.beginPath(); for(let i=0;i<w;i+=50){ctx.moveTo(i,0);ctx.lineTo(i,h)} for(let i=0;i<h;i+=50){ctx.moveTo(0,i);ctx.lineTo(w,i)} ctx.stroke();
                
                ctx.fillStyle=cr?'#ef4444':(cashed?'#10b981':'#fff'); ctx.font='bold 60px monospace'; ctx.textAlign='center'; ctx.fillText(`${v.toFixed(2)}x`,w/2,h/2);
                
                const t=Math.min((v-1)/5,1); const x=t*(w*0.8); const y=h-t*(h*0.8);
                ctx.beginPath(); ctx.moveTo(0,h); ctx.quadraticCurveTo(w/4,h,x,y);
                ctx.strokeStyle=cr?'#ef4444':(cashed?'#10b981':'#FFD700'); ctx.lineWidth=4; ctx.stroke();
                // Rocket
                ctx.beginPath(); ctx.arc(x,y,6,0,Math.PI*2); ctx.fillStyle='#fff'; ctx.fill();
            };
            useEffect(()=>{ if(cvsRef.current){cvsRef.current.width=cvsRef.current.offsetWidth; cvsRef.current.height=cvsRef.current.offsetHeight;} return ()=>cancelAnimationFrame(gm.current.a); },[]);

            return React.createElement('div', { className: "fixed inset-0 bg-black z-50 flex flex-col h-full" },
                React.createElement('div', { className: "flex justify-between p-4 bg-dark-800" }, React.createElement('button',{onClick:back,className:"text-gray-400"},React.createElement(ChevronRight)), React.createElement('span',{className:"text-gold-500 font-bold"},"CRASH"), React.createElement('span',{className:"font-mono"},user.coins)),
                React.createElement('div', { className: "flex-1 relative w-full" }, React.createElement('canvas', { ref: cvsRef, className: "w-full h-full" })),
                React.createElement('div', { className: "p-4 bg-dark-800 border-t border-white/10 flex gap-4 pb-8" },
                    React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), className: "w-24 bg-black border border-white/20 rounded-xl text-center text-white font-bold" }),
                    st === 'RUNNING' && !cashed ? React.createElement(Button, { full: true, variant: "green", onClick: cash }, "ÿ≥ÿ≠ÿ®") : React.createElement(Button, { full: true, disabled: st === 'RUNNING', onClick: start }, "ŸÑÿπÿ®")
                )
            );
        }

        function PlinkoGame({ user, back, showMsg }) {
            const cvsRef = useRef(null); const [bet, setBet] = useState(100); const eng = useRef({ balls: [] });
            
            const drop = async () => {
                if(user.coins < bet) return showMsg('ÿ±ÿµŸäÿØ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸä', 'error');
                try {
                    await updateDoc(doc(db,"users",user.id),{coins:user.coins-bet});
                    eng.current.balls.push({x:cvsRef.current.width/2, y:30, vx:Math.random()*2-1, vy:0, bet});
                    setTimeout(async()=>{
                        const m=Math.random()>0.5?(Math.random()>0.8?3:1.5):0.25; const w=Math.floor(bet*m);
                        await updateDoc(doc(db,"users",user.id),{coins: user.coins - bet + w}); // Simplified sync
                        if(w>bet) showMsg(`+${w} C`,'success');
                    }, 2500);
                } catch(e) { showMsg('ÿÆÿ∑ÿ£','error'); }
            };
            useEffect(() => {
                const cvs=cvsRef.current; if(!cvs) return; cvs.width=cvs.offsetWidth; cvs.height=cvs.offsetHeight;
                const ctx=cvs.getContext('2d'); const {width:w,height:h}=cvs; const ROWS=10; const GAP=w/(ROWS+2); const pegs=[]; for(let r=0;r<ROWS;r++) for(let c=0;c<=r;c++) pegs.push({x:w/2+(c-r/2)*GAP, y:50+r*GAP});
                const buckets=[8,3,1.5,0.25,0.25,1.5,3,8].map((v,i)=>({x:(w-8*GAP)/2+i*GAP, y:50+ROWS*GAP+30, w:GAP, h:40, v}));
                let anim;
                const update=()=>{
                    ctx.clearRect(0,0,w,h);
                    ctx.fillStyle='#fff'; pegs.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,3,0,Math.PI*2);ctx.fill()});
                    buckets.forEach(b=>{ctx.fillStyle=b.v<1?'#222':(b.v>=3?'#9333ea':'#eab308'); ctx.fillRect(b.x+1,b.y,b.w-2,b.h); ctx.fillStyle='#fff'; ctx.font='bold 10px Arial'; ctx.textAlign='center'; ctx.fillText(`${b.v}x`, b.x+b.w/2, b.y+25);});
                    eng.current.balls.forEach(b=>{b.vy+=0.25; b.vx*=0.99; b.x+=b.vx; b.y+=b.vy; pegs.forEach(p=>{if(Math.sqrt((b.x-p.x)**2+(b.y-p.y)**2)<9){b.vx=(Math.random()-0.5)*3; b.vy*=0.6; b.y+=2;}}); ctx.fillStyle='#eab308'; ctx.beginPath(); ctx.arc(b.x,b.y,6,0,Math.PI*2); ctx.fill();});
                    eng.current.balls=eng.current.balls.filter(b=>b.y<h+50); anim=requestAnimationFrame(update);
                }; update(); return ()=>cancelAnimationFrame(anim);
            }, []);
            return React.createElement('div', { className: "fixed inset-0 bg-black z-50 flex flex-col h-full" }, React.createElement('div', { className: "flex justify-between p-4 bg-dark-800" }, React.createElement('button',{onClick:back,className:"text-gray-400"},React.createElement(ChevronRight)), React.createElement('span',{className:"text-purple-500 font-bold"},"PLINKO"), React.createElement('span',{className:"font-mono"},user.coins)), React.createElement('div', { className: "flex-1 relative w-full" }, React.createElement('canvas', { ref: cvsRef, className: "w-full h-full" })), React.createElement('div', { className: "p-4 bg-dark-800 border-t border-white/10 flex gap-4 pb-8" }, React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), className: "w-24 bg-black border border-white/20 rounded-xl text-center text-white font-bold" }), React.createElement(Button, { full: true, onClick: drop }, "ÿ•ÿ≥ŸÇÿßÿ∑")));
        }

        // --- AUTH & ADMIN ---
        function AuthScreen({ setUser, setView, showMsg }) {
            const [isReg, setIsReg] = useState(false); const [f, setF] = useState({ u:'', p:'', n:'', ph:'' }); const [loading, setLoading] = useState(false);
            const submit = async () => {
                if(!f.u || !f.p) return showMsg('ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÜÿßŸÇÿµÿ©', 'error');
                if(f.u==='admin' && f.p==='admin123') { localStorage.setItem('cd0777_uid', 'admin'); setUser({role:'admin'}); setView('admin'); return; }
                if(!db) return showMsg('ÿÆÿ∑ÿ£ ÿßÿ™ÿµÿßŸÑ', 'error');
                setLoading(true);
                try {
                    if(isReg) {
                        const q = query(collection(db, "users"), where("username", "==", f.u)); if(!(await getDocs(q)).empty) throw new Error('ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã');
                        const sz = (await getDocs(collection(db, "users"))).size;
                        const nu = { username: f.u, password: f.p, fullName: f.n, phone: f.ph, memberId: `CD${1001+sz}`, role: 'user', status: 'pending', coins: 100, balance: 0, completedTasks: [] };
                        const ref = await addDoc(collection(db, "users"), nu); localStorage.setItem('cd0777_uid', ref.id); setUser({id:ref.id, ...nu}); setView('home');
                    } else {
                        const q = query(collection(db, "users"), where("username", "==", f.u), where("password", "==", f.p)); const s = await getDocs(q);
                        if(s.empty) throw new Error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™'); const d=s.docs[0]; localStorage.setItem('cd0777_uid', d.id); setUser({id:d.id, ...d.data()}); setView('home');
                    }
                } catch(e) { showMsg(e.message, 'error'); } setLoading(false);
            };
            return React.createElement('div', { className: "min-h-screen flex flex-col items-center justify-center p-6 bg-black" }, React.createElement('div', { className: "w-24 h-24 rounded-2xl bg-gradient-to-tr from-gold-600 to-gold-300 flex items-center justify-center text-4xl font-black text-black mb-8 shadow-2xl" }, "CD"), React.createElement('div', { className: "w-full max-w-sm space-y-4" }, isReg && React.createElement(Input, { placeholder: "ÿßŸÑÿßÿ≥ŸÖ", value: f.n, onChange: e=>setF({...f,n:e.target.value}) }), isReg && React.createElement(Input, { placeholder: "ÿßŸÑŸáÿßÿ™ŸÅ", value: f.ph, onChange: e=>setF({...f,ph:e.target.value}) }), React.createElement(Input, { placeholder: "User", value: f.u, onChange: e=>setF({...f,u:e.target.value}) }), React.createElement(Input, { type: "password", placeholder: "Pass", value: f.p, onChange: e=>setF({...f,p:e.target.value}) }), React.createElement(Button, { full: true, onClick: submit, disabled: loading }, loading ? '...' : (isReg ? 'ÿ™ÿ≥ÿ¨ŸäŸÑ' : 'ÿØÿÆŸàŸÑ')), React.createElement('button', { onClick: ()=>setIsReg(!isReg), className: "w-full text-center text-xs text-gray-500" }, isReg ? 'ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü' : 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®')));
        }

        function AdminPanel({ user, logout }) {
            const [tab, setTab] = useState('users'); const [data, setData] = useState({u:[], w:[], t:[]});
            const [newTask, setNewTask] = useState({title:'', url:'', reward: 500}); // New Task State

            useEffect(() => {
                if(!db) return;
                const u1 = onSnapshot(collection(db,"users"), s=>setData(p=>({...p, u:s.docs.map(d=>({id:d.id,...d.data()})).filter(x=>x.role!=='admin')})));
                const u2 = onSnapshot(collection(db,"withdrawals"), s=>setData(p=>({...p, w:s.docs.map(d=>({id:d.id,...d.data()}))})));
                const u3 = onSnapshot(collection(db,"tasks"), s=>setData(p=>({...p, t:s.docs.map(d=>({id:d.id,...d.data()}))})));
                return ()=>{u1();u2();u3();};
            }, []);

            const addTask = async () => {
                if(!newTask.title || !newTask.url) return;
                await addDoc(collection(db, "tasks"), { ...newTask, icon: 'IG' });
                setNewTask({title:'', url:'', reward: 500});
            };

            return React.createElement('div', { className: "min-h-screen bg-black p-4 text-xs space-y-4" },
                React.createElement('div', { className: "flex justify-between items-center" }, React.createElement('h1', { className: "text-lg text-gold-500 font-bold" }, "ADMIN"), React.createElement('button', { onClick: logout, className: "text-red-500 border border-red-900 px-3 py-1 rounded" }, "Exit")),
                React.createElement('div', { className: "flex gap-2" }, ['users','withdrawals','tasks'].map(t=>React.createElement('button',{key:t, onClick:()=>setTab(t), className:`flex-1 py-2 rounded border capitalize ${tab===t?'bg-gold-500 text-black':'bg-dark-800 border-white/10 text-gray-500'}`},t))),
                
                tab==='users' && data.u.map(u => React.createElement('div', { key: u.id, className: "bg-dark-800 p-3 rounded flex justify-between items-center border border-white/5" }, React.createElement('div', {}, React.createElement('div', { className: "text-gold-500 font-bold" }, u.memberId), React.createElement('div', { className: "text-gray-400" }, u.fullName)), React.createElement('button', { onClick: ()=>updateDoc(doc(db,"users",u.id),{status:u.status==='active'?'pending':'active'}), className: `px-3 py-1 rounded font-bold ${u.status==='active'?'bg-red-900/20 text-red-500':'bg-green-900/20 text-green-500'}` }, u.status==='active'?'Freeze':'Active'))),
                
                tab==='withdrawals' && data.w.map(w => React.createElement('div', { key: w.id, className: "bg-dark-800 p-3 rounded space-y-2 border border-white/5" }, React.createElement('div', { className: "flex justify-between" }, React.createElement('span', { className: "font-bold" }, w.userName), React.createElement('span', { className: "text-gold-500" }, `$${w.amount}`)), React.createElement('div', { className: "bg-black p-2 rounded text-gray-400 font-mono" }, `${w.method}: ${w.details}`), w.status==='pending' ? React.createElement(Button, { full: true, variant: "green", onClick: ()=>updateDoc(doc(db,"withdrawals",w.id),{status:'paid'}) }, "Pay") : React.createElement('div', { className: "text-center text-green-500 font-bold" }, "PAID"))),
                
                tab==='tasks' && React.createElement('div', { className: "space-y-4" },
                    React.createElement('div', { className: "bg-dark-800 p-3 rounded space-y-2 border border-white/5" },
                        React.createElement(Input, { placeholder: "Title", value: newTask.title, onChange: e=>setNewTask({...newTask, title:e.target.value}) }),
                        React.createElement(Input, { placeholder: "URL", value: newTask.url, onChange: e=>setNewTask({...newTask, url:e.target.value}) }),
                        React.createElement('div', { className: "flex gap-2" },
                            React.createElement('input', { type: "number", placeholder: "Points", value: newTask.reward, onChange: e=>setNewTask({...newTask, reward: Number(e.target.value)}), className: "bg-black border border-white/10 p-3 rounded-xl text-white text-center w-24" }),
                            React.createElement(Button, { full: true, onClick: addTask }, "Add Task")
                        )
                    ),
                    data.t.map(t => React.createElement('div', { key: t.id, className: "flex justify-between items-center bg-dark-800 p-3 rounded border border-white/5" }, 
                        React.createElement('div', {}, React.createElement('div', {className:"font-bold"}, t.title), React.createElement('div', {className:"text-gold-500 text-[10px]"}, t.reward + " C")), 
                        React.createElement('button', { onClick: ()=>deleteDoc(doc(db,"tasks",t.id)), className: "text-red-500" }, React.createElement(Trash2, { size: 16 }))
                    ))
                )
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
