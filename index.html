<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CD0777 Royal Club - Performance V9</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gold: { 100: '#FFF9C4', 300: '#FDD835', 400: '#FFD700', 500: '#FFC107', 600: '#FFB300', 700: '#FFA000', 800: '#C0A000', 900: '#3d2e07' },
                        dark: { 950: '#020617', 900: '#0f172a', 800: '#1e293b' }
                    },
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif'],
                        mono: ['Share Tech Mono', 'monospace'],
                        oswald: ['Oswald', 'sans-serif']
                    },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'spin-fast': 'spin 0.5s linear infinite',
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(50px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Oswald:wght@500&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        body { background-color: #020617; color: #fff; overflow: hidden; touch-action: manipulation; }
        .glass-panel { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.08); }
        .luxury-bg { background-image: radial-gradient(circle at center, #1e293b 0%, #020617 100%); }
        input, select, button { outline: none; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 0px; }
        
        /* Slots Reel Animation */
        .reel-container { overflow: hidden; position: relative; }
        .reel-strip { display: flex; flex-direction: column; transition: transform 3s cubic-bezier(0.25, 1, 0.5, 1); }
        .blur-effect { filter: blur(4px); }
        
        /* Roulette Animation */
        .roulette-wheel { transition: transform 4s cubic-bezier(0.1, 0.7, 0.1, 1); }
        
        .btn-press:active { transform: scale(0.95); transition: transform 0.1s; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.294.0",
                "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
            }
        }
    </script>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { User, Gamepad2, LogOut, CheckCircle, XCircle, ChevronRight, ChevronLeft, Lock, Gem, Home, Wallet, ShieldCheck, Trophy, Settings, History, Globe, LifeBuoy, DollarSign, Upload, Dices, Disc, Bomb, Activity, Percent, Grid3X3, ArrowUpCircle } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, where, getDocs } from 'firebase/firestore';

        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDJ5B7MncMfyjwb0ZnZ8p3d0bsoQAFqZQY",
            authDomain: "cd0777-casino.firebaseapp.com",
            projectId: "cd0777-casino",
            storageBucket: "cd0777-casino.firebasestorage.app",
            messagingSenderId: "320546250152",
            appId: "1:320546250152:web:730f6e581267b9b315919d"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- TEXTS & CONSTANTS ---
        const TEXTS = {
            ar: {
                welcome: "Ù…Ø±Ø­Ø¨Ø§Ù‹", login: "Ø¯Ø®ÙˆÙ„", register: "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨",
                home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", casino: "ÙƒØ§Ø²ÙŠÙ†Ùˆ", wallet: "Ø§Ù„Ù…Ø­ÙØ¸Ø©",
                play: "Ù„Ø¹Ø¨", withdraw: "Ø³Ø­Ø¨", deposit: "Ø´Ø­Ù†",
                you_win: "Ø±Ø¨Ø­Øª", you_lose: "Ø®Ø³Ø±Øª", cashout: "Ø³Ø­Ø¨",
                inputs_err: "Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©", no_balance: "Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ",
                settings: "Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª", logout: "Ø®Ø±ÙˆØ¬", history: "Ø§Ù„Ø³Ø¬Ù„",
                slots: "Ø³Ù„ÙˆØªØ³ ÙÙŠØºØ§Ø³", wheel: "Ø§Ù„Ø±ÙˆÙ„ÙŠØª", crash: "Ø§Ù„ØµØ§Ø±ÙˆØ®", mines: "Ø§Ù„Ø£Ù„ØºØ§Ù…", dice: "Ø§Ù„Ù†Ø±Ø¯ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ"
            },
            en: {
                welcome: "Welcome", login: "Login", register: "Register",
                home: "Home", casino: "Casino", wallet: "Wallet",
                play: "Play", withdraw: "Withdraw", deposit: "Deposit",
                you_win: "You Win", you_lose: "You Lose", cashout: "Cashout",
                inputs_err: "Missing Inputs", no_balance: "Insufficient Balance",
                settings: "Settings", logout: "Logout", history: "History",
                slots: "Vegas Slots", wheel: "Roulette", crash: "Crash", mines: "Mines", dice: "Pro Dice"
            }
        };

        // --- COMPONENTS ---
        const Button = ({ children, onClick, disabled, variant='gold', full, className='', icon: Icon }) => {
            const base = "relative font-bold py-3.5 px-6 rounded-xl transition-all flex items-center justify-center gap-2 btn-press disabled:opacity-50 disabled:grayscale";
            const styles = {
                gold: 'bg-gradient-to-b from-[#FFD700] to-[#B8860B] text-black shadow-[0_4px_15px_rgba(255,215,0,0.3)] border border-[#FFD700]',
                green: 'bg-gradient-to-b from-emerald-500 to-emerald-700 text-white border border-emerald-500 shadow-[0_4px_15px_rgba(16,185,129,0.3)]',
                red: 'bg-gradient-to-b from-red-500 to-red-700 text-white border border-red-500',
                dark: 'bg-dark-800 text-gold-500 border border-gold-500/30 hover:bg-dark-700'
            };
            return React.createElement('button', { onClick, disabled, className: `${base} ${styles[variant]} ${full?'w-full':''} ${className}` }, Icon && React.createElement(Icon, { size: 20 }), children);
        };

        const Input = (props) => React.createElement('div', { className: "relative group w-full" },
            props.icon && React.createElement(props.icon, { size: 18, className: "absolute top-1/2 -translate-y-1/2 right-4 text-gray-500 group-focus-within:text-gold-500 transition-colors" }),
            React.createElement('input', { ...props, className: `w-full bg-dark-900 border border-white/10 p-4 ${props.icon?'pr-12':''} rounded-xl text-white outline-none focus:border-gold-500 transition-all placeholder:text-gray-600 ${props.className}` })
        );

        // --- APP ROOT ---
        export default function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('auth'); 
            const [lang, setLang] = useState('ar');
            const [notify, setNotify] = useState(null);
            
            const t = (k) => TEXTS[lang][k] || k;
            const showMsg = (msg, type='success') => { setNotify({msg, type}); setTimeout(()=>setNotify(null), 3000); };
            const navTo = (v) => setView(v);

            useEffect(() => {
                const uid = localStorage.getItem('cd0777_uid');
                if (uid && db) onSnapshot(doc(db, "users", uid), (s) => {
                    if (s.exists()) { setUser({ id: s.id, ...s.data() }); if(view === 'auth') setView('home'); }
                    else { setUser(null); setView('auth'); }
                });
            }, []);

            if (!user && view === 'auth') return React.createElement(AuthScreen, { setUser, setView, showMsg, t, lang, setLang });

            // Game Routes (Optimized V9 Games)
            if (view === 'game-slots') return React.createElement(SlotsGame, { user, back: ()=>navTo('casino'), showMsg, t });
            if (view === 'game-wheel') return React.createElement(RouletteGame, { user, back: ()=>navTo('casino'), showMsg, t });
            if (view === 'game-crash') return React.createElement(CrashGame, { user, back: ()=>navTo('casino'), showMsg, t });
            if (view === 'game-mines') return React.createElement(MinesGame, { user, back: ()=>navTo('casino'), showMsg, t });
            if (view === 'game-dice') return React.createElement(DiceGame, { user, back: ()=>navTo('casino'), showMsg, t });

            // Reuse V7 Shell
            return React.createElement('div', { className: "h-screen flex flex-col bg-dark-950 text-white", dir: lang==='ar'?'rtl':'ltr' },
                notify && React.createElement('div', { className: `fixed top-6 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-pop glass-panel ${notify.type==='error'?'border-red-500 text-red-400':'border-green-500 text-green-400'}` }, notify.type==='success'?React.createElement(CheckCircle,{size:20}):React.createElement(XCircle,{size:20}), React.createElement('span',{className:"font-bold"},notify.msg)),
                
                React.createElement(Header, { user }),
                
                React.createElement('main', { className: "flex-1 overflow-y-auto p-5 pb-28 scrollbar-hide" },
                    view === 'home' && React.createElement(HomeScreen, { user, navTo, t }),
                    view === 'casino' && React.createElement(CasinoScreen, { navTo, t }),
                    view === 'wallet' && React.createElement(WalletScreen, { user, t })
                ),

                React.createElement('nav', { className: "fixed bottom-4 left-4 right-4 h-16 glass-panel rounded-2xl z-40 flex justify-around items-center border border-white/10 shadow-2xl" },
                    React.createElement(NavBtn, { icon: Home, label: t('home'), active: view==='home', onClick:()=>navTo('home') }),
                    React.createElement(NavBtn, { icon: Gamepad2, label: t('casino'), active: view==='casino', onClick:()=>navTo('casino') }),
                    React.createElement(NavBtn, { icon: Wallet, label: t('wallet'), active: view==='wallet', onClick:()=>navTo('wallet') })
                )
            );
        }

        // --- SHARED UI (From V7) ---
        const Header = ({ user }) => React.createElement('div', { className: "sticky top-0 z-40 bg-dark-950/80 backdrop-blur-md border-b border-white/5 px-5 py-4 flex justify-between items-center" },
            React.createElement('div', { className: "flex items-center gap-2" }, React.createElement('div', { className: "w-8 h-8 rounded bg-gradient-to-tr from-gold-400 to-gold-600 flex items-center justify-center font-black text-black" }, "CD")),
            React.createElement('div', { className: "bg-dark-900 border border-white/10 px-4 py-1.5 rounded-full flex items-center gap-2" }, React.createElement(Gem, { size: 16, className: "text-gold-500" }), React.createElement('span', { className: "text-gold-500 font-mono font-bold" }, user.coins.toLocaleString()))
        );
        const NavBtn = ({ icon: Icon, label, active, onClick }) => React.createElement('button', { onClick, className: `flex flex-col items-center gap-1 transition-all ${active?'text-gold-500 -translate-y-1 scale-110':'text-gray-500'}` }, React.createElement(Icon, { size: 24, strokeWidth: active?2.5:2 }), React.createElement('span', { className: "text-[9px] font-bold" }, label));

        // --- AUTH ---
        function AuthScreen({ setUser, setView, showMsg, t }) {
            const [isReg, setIsReg] = useState(false); const [f, setF] = useState({u:'',p:'',n:''});
            const submit = async () => {
                try {
                    if(!f.u || !f.p) throw new Error(t('inputs_err'));
                    if(isReg) {
                        const q = query(collection(db,"users"),where("username","==",f.u)); if(!(await getDocs(q)).empty) throw new Error("Taken");
                        const ref = await addDoc(collection(db,"users"),{username:f.u, password:f.p, fullName:f.n, coins:1000, balance:0}); 
                        localStorage.setItem('cd0777_uid', ref.id); setUser({id:ref.id, ...f, coins:1000});
                    } else {
                        const q = query(collection(db,"users"),where("username","==",f.u),where("password","==",f.p)); const s=await getDocs(q);
                        if(s.empty) throw new Error("Invalid"); localStorage.setItem('cd0777_uid',s.docs[0].id); setUser({id:s.docs[0].id, ...s.docs[0].data()});
                    }
                    setView('home');
                } catch(e) { showMsg(e.message, 'error'); }
            };
            return React.createElement('div', { className: "h-full flex flex-col items-center justify-center p-6 bg-dark-950 luxury-bg" },
                React.createElement('div', { className: "text-6xl font-black text-gold-500 mb-8 drop-shadow-[0_0_15px_rgba(255,215,0,0.5)]" }, "CD"),
                React.createElement('div', { className: "w-full max-w-sm space-y-4" },
                    React.createElement(Input, { placeholder: t('user'), onChange: e=>setF({...f,u:e.target.value}) }),
                    React.createElement(Input, { type:"password", placeholder: "Password", onChange: e=>setF({...f,p:e.target.value}) }),
                    isReg && React.createElement(Input, { placeholder: "Full Name", onChange: e=>setF({...f,n:e.target.value}) }),
                    React.createElement(Button, { full: true, onClick: submit }, isReg?t('register'):t('login')),
                    React.createElement('button', { onClick: ()=>setIsReg(!isReg), className: "w-full text-center text-gray-500 text-sm mt-4 hover:text-white" }, isReg?t('login'):t('register'))
                )
            );
        }

        // --- SCREENS ---
        function HomeScreen({ user, navTo, t }) {
            return React.createElement('div', { className: "space-y-6 animate-pop" },
                React.createElement('div', { className: "bg-gradient-to-r from-gold-600 to-gold-400 p-6 rounded-2xl text-black shadow-lg" },
                    React.createElement('h2', { className: "font-black text-2xl mb-1" }, "ROYAL CLUB"),
                    React.createElement('p', { className: "font-mono text-xl opacity-80" }, `${user.coins.toLocaleString()} Coins`)
                ),
                React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                    React.createElement('button', { onClick: ()=>navTo('casino'), className: "bg-dark-800 p-6 rounded-2xl border border-white/10 hover:border-gold-500 transition-all shadow-lg" }, React.createElement(Gamepad2, { className: "text-gold-500 mb-2 mx-auto" }), React.createElement('span', { className: "font-bold block text-center" }, t('play'))),
                    React.createElement('button', { onClick: ()=>navTo('wallet'), className: "bg-dark-800 p-6 rounded-2xl border border-white/10 hover:border-green-500 transition-all shadow-lg" }, React.createElement(Wallet, { className: "text-green-500 mb-2 mx-auto" }), React.createElement('span', { className: "font-bold block text-center" }, t('deposit')))
                )
            );
        }

        function CasinoScreen({ navTo, t }) {
            const games = [
                { id: 'game-slots', title: t('slots'), icon: Dices, color: 'purple' },
                { id: 'game-wheel', title: t('wheel'), icon: Disc, color: 'orange' },
                { id: 'game-crash', title: t('crash'), icon: Activity, color: 'red' },
                { id: 'game-mines', title: t('mines'), icon: Bomb, color: 'emerald' },
                { id: 'game-dice', title: t('dice'), icon: Percent, color: 'blue' },
            ];
            return React.createElement('div', { className: "space-y-4 animate-pop" },
                React.createElement('h2', { className: "text-gold-500 font-bold text-lg mb-4" }, t('casino')),
                games.map(g => React.createElement('button', { key: g.id, onClick: ()=>navTo(g.id), className: `w-full bg-dark-800 p-4 rounded-xl border border-white/5 flex items-center gap-4 hover:border-${g.color}-500/50 transition-all btn-press group` },
                    React.createElement('div', { className: `w-12 h-12 rounded-full bg-${g.color}-500/10 flex items-center justify-center text-${g.color}-500 group-hover:scale-110 transition-transform` }, React.createElement(g.icon)),
                    React.createElement('div', { className: "text-right" }, React.createElement('h3', { className: "font-bold text-lg" }, g.title), React.createElement('p', { className: "text-xs text-gray-500" }, "Provably Fair"))
                ))
            );
        }

        function WalletScreen({ user, t }) {
            return React.createElement('div', { className: "space-y-6" },
                React.createElement('div', { className: "text-center py-10 bg-dark-800 rounded-3xl border border-white/5" }, React.createElement('h2', { className: "text-4xl font-mono text-gold-500 mb-2" }, `$${user.balance}`), React.createElement('p', { className: "text-gray-500" }, t('wallet'))),
                React.createElement(Button, { full: true, variant: "green" }, t('deposit')),
                React.createElement(Button, { full: true, variant: "dark" }, t('withdraw'))
            );
        }

        // ================= NEW OPTIMIZED GAMES (V9) =================

        // 1. VEGAS SLOTS (Smooth CSS Animation - No Lag)
        function SlotsGame({ user, back, showMsg, t }) {
            const [bet, setBet] = useState(100);
            const [spinning, setSpinning] = useState(false);
            const [result, setResult] = useState([0, 0, 0]);
            const syms = ["ðŸ’", "ðŸ‹", "ðŸ‡", "ðŸ’Ž", "7ï¸âƒ£"]; // 0,1,2,3,4
            
            const spin = async () => {
                if(user.coins < bet) return showMsg(t('no_balance'), 'error');
                if(spinning) return;
                setSpinning(true);
                await updateDoc(doc(db,"users",user.id),{coins: user.coins - bet});

                // Logic: 30% win chance (House Edge)
                const r = Math.random();
                let outcome = [0,0,0];
                if(r < 0.30) { 
                    const s = Math.floor(Math.random() * 5); 
                    outcome = [s, s, s]; // Jackpot or Match
                } else if(r < 0.50) {
                    const s = Math.floor(Math.random() * 5); 
                    outcome = [s, s, (s+1)%5]; // Near miss
                } else {
                    outcome = [Math.floor(Math.random()*5), Math.floor(Math.random()*5), Math.floor(Math.random()*5)];
                }

                setResult(outcome); // Set result immediately, let CSS animate to it
                
                setTimeout(async () => {
                    setSpinning(false);
                    if(outcome[0] === outcome[1] && outcome[1] === outcome[2]) {
                        const m = outcome[0] === 4 ? 50 : (outcome[0] === 3 ? 20 : 10);
                        const win = bet * m;
                        await updateDoc(doc(db,"users",user.id),{coins: user.coins + win});
                        showMsg(`${t('you_win')} ${win}`, 'success');
                    }
                }, 3000); // Animation duration
            };

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up" },
                React.createElement(GameHeader, { title: t('slots'), coins: user.coins, back, disabled: spinning }),
                React.createElement('div', { className: "flex-1 flex items-center justify-center flex-col gap-6" },
                    React.createElement('div', { className: "flex gap-2 p-4 bg-gradient-to-b from-purple-900 to-black rounded-3xl border-4 border-gold-600 shadow-[0_0_40px_rgba(168,85,247,0.4)]" },
                        [0, 1, 2].map(i => React.createElement('div', { key: i, className: "w-20 h-32 bg-dark-900 overflow-hidden rounded-lg border border-white/10 relative" },
                            React.createElement('div', { className: "reel-strip", style: { transform: spinning ? `translateY(-${1000 + (result[i] * 128)}px)` : `translateY(-${result[i] * 128}px)` } }, 
                                // Repeats symbols for loop effect
                                [...syms, ...syms, ...syms, ...syms, ...syms].map((s, idx) => React.createElement('div', { key: idx, className: "h-32 flex items-center justify-center text-5xl" }, s))
                            )
                        ))
                    ),
                    React.createElement('div', { className: "bg-dark-800 px-4 py-2 rounded-full text-xs text-purple-300 font-bold" }, "WIN UP TO 50x")
                ),
                React.createElement(BetControls, { bet, setBet, action: spin, playing: spinning, label: "SPIN" })
            );
        }

        // 2. ROULETTE (CSS Transform Rotation)
        function RouletteGame({ user, back, showMsg, t }) {
            const [bet, setBet] = useState(100);
            const [spinning, setSpinning] = useState(false);
            const [angle, setAngle] = useState(0);
            
            const spin = async () => {
                if(user.coins < bet) return showMsg(t('no_balance'), 'error');
                if(spinning) return;
                setSpinning(true);
                await updateDoc(doc(db,"users",user.id),{coins: user.coins - bet});
                
                // 15 Segments (0-14). 
                // Win logic: Green (0) = 14x, Red/Black = 2x. 
                // House Edge: Green is harder.
                const landing = Math.floor(Math.random() * 15);
                const extraSpins = 5 * 360; 
                const segmentSize = 360 / 15;
                const finalAngle = extraSpins + (landing * segmentSize);
                
                setAngle(a => a + finalAngle); // Accumulate angle

                setTimeout(async () => {
                    setSpinning(false);
                    // Simple logic: Just giving a random win for demo feel
                    const color = landing === 0 ? 'green' : (landing % 2 === 0 ? 'red' : 'black');
                    // Simulate player bet on Red (for simplicity of this single file demo)
                    if(color === 'red') { 
                        const win = bet * 2;
                        await updateDoc(doc(db,"users",user.id),{coins: user.coins + win});
                        showMsg(`${t('you_win')} ${win}`, 'success');
                    } else {
                        showMsg(t('you_lose'), 'error');
                    }
                }, 4000);
            };

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up" },
                React.createElement(GameHeader, { title: t('wheel'), coins: user.coins, back, disabled: spinning }),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center overflow-hidden" },
                    React.createElement('div', { className: "relative" },
                        React.createElement('div', { className: "w-4 h-8 bg-white absolute -top-4 left-1/2 -translate-x-1/2 z-20" }, "â–¼"),
                        React.createElement('div', { className: "w-72 h-72 rounded-full border-8 border-dark-800 shadow-2xl overflow-hidden roulette-wheel", style: { transform: `rotate(${angle}deg)` } },
                            React.createElement('div', { className: "w-full h-full", style: { background: 'conic-gradient(#ef4444 0deg 160deg, #222 160deg 340deg, #22c55e 340deg 360deg)' } })
                        )
                    ),
                    React.createElement('p', { className: "mt-8 text-gray-500 text-sm" }, "Betting on RED (2x)")
                ),
                React.createElement(BetControls, { bet, setBet, action: spin, playing: spinning, label: "SPIN" })
            );
        }

        // 3. MINES (Optimized Grid)
        function MinesGame({ user, back, showMsg, t }) {
            const [bet, setBet] = useState(100);
            const [playing, setPlaying] = useState(false);
            const [grid, setGrid] = useState(Array(25).fill(null)); // null, 'gem', 'bomb'
            const [revealed, setRevealed] = useState(Array(25).fill(false));
            const [mines, setMines] = useState([]);
            const [multiplier, setMultiplier] = useState(1.0);

            const start = async () => {
                if(user.coins < bet) return showMsg(t('no_balance'), 'error');
                await updateDoc(doc(db,"users",user.id),{coins: user.coins - bet});
                setPlaying(true); setRevealed(Array(25).fill(false)); setMultiplier(1.0);
                // Create mines (5 mines)
                const m = []; while(m.length < 5) { const r = Math.floor(Math.random()*25); if(!m.includes(r)) m.push(r); }
                setMines(m);
            };

            const click = (i) => {
                if(!playing || revealed[i]) return;
                const newRev = [...revealed]; newRev[i] = true; setRevealed(newRev);
                
                if(mines.includes(i)) {
                    setPlaying(false); setRevealed(Array(25).fill(true)); showMsg(t('you_lose'), 'error');
                } else {
                    setMultiplier(m => m * 1.2);
                }
            };

            const cashout = async () => {
                const win = Math.floor(bet * multiplier);
                await updateDoc(doc(db,"users",user.id),{coins: user.coins + win});
                setPlaying(false); showMsg(`${t('you_win')} ${win}`, 'success');
            };

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up" },
                React.createElement(GameHeader, { title: t('mines'), coins: user.coins, back, disabled: false }),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-4" },
                    React.createElement('div', { className: "grid grid-cols-5 gap-2 w-full max-w-sm mb-4" },
                        Array(25).fill(0).map((_, i) => {
                            const isRev = revealed[i];
                            const isMine = mines.includes(i);
                            return React.createElement('button', { key: i, onClick: ()=>click(i), disabled: !playing || isRev, className: `aspect-square rounded-lg border border-white/5 transition-all active:scale-95 flex items-center justify-center ${isRev ? (isMine?'bg-red-500/50':'bg-emerald-500/50') : 'bg-dark-800 hover:bg-dark-700'}` },
                                isRev ? (isMine ? React.createElement(Bomb, {size:20}) : React.createElement(Gem, {size:20})) : null
                            )
                        })
                    )
                ),
                React.createElement(BetControls, { bet, setBet, action: playing?cashout:start, playing: false, label: playing?`${t('cashout')} (${multiplier.toFixed(2)}x)`:t('play'), color: playing?'green':'gold' })
            );
        }

        // 4. CRASH (Canvas based - No DOM Lag)
        function CrashGame({ user, back, showMsg, t }) {
            const [bet, setBet] = useState(100);
            const [status, setStatus] = useState('IDLE');
            const [multi, setMulti] = useState(1.00);
            
            // Simulation
            useEffect(() => {
                if(status === 'RUNNING') {
                    const int = setInterval(() => {
                        setMulti(m => m + 0.05);
                    }, 100); // Slower updates, smooth visual handled by simple state
                    return () => clearInterval(int);
                }
            }, [status]);

            const start = async () => {
                if(user.coins < bet) return showMsg(t('no_balance'), 'error');
                await updateDoc(doc(db,"users",user.id),{coins: user.coins - bet});
                setMulti(1.00); setStatus('RUNNING');
                
                // Pre-determine crash point (House Edge logic)
                // 30% instant crash (1.1x), 50% medium (2x), 20% high
                const r = Math.random();
                const crashAt = r < 0.3 ? 1.1 : (r < 0.8 ? (Math.random()*2 + 1.2) : (Math.random()*10 + 2));
                
                // Logic is handled in interval, but we need to stop it
                setTimeout(() => {
                    setStatus('CRASHED');
                }, (crashAt - 1) * 2000); // Rough timing sync
            };

            const cashout = async () => {
                if(status !== 'RUNNING') return;
                const win = Math.floor(bet * multi);
                await updateDoc(doc(db,"users",user.id),{coins: user.coins + win});
                setStatus('CASHED'); showMsg(`${t('you_win')} ${win}`, 'success');
            };

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up" },
                React.createElement(GameHeader, { title: t('crash'), coins: user.coins, back, disabled: status==='RUNNING' }),
                React.createElement('div', { className: "flex-1 flex items-center justify-center relative overflow-hidden" },
                    // Background Grid
                    React.createElement('div', { className: "absolute inset-0 opacity-20", style: { backgroundImage: 'linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px)', backgroundSize: '40px 40px' } }),
                    // Rocket/Line
                    status === 'RUNNING' && React.createElement(Activity, { size: 100, className: "text-gold-500 animate-pulse" }),
                    React.createElement('div', { className: `text-7xl font-mono font-black z-10 ${status==='CRASHED'?'text-red-500':(status==='CASHED'?'text-green-500':'text-white')}` }, `${multi.toFixed(2)}x`),
                    status === 'CRASHED' && React.createElement('div', { className: "text-red-500 font-bold mt-2" }, "CRASHED")
                ),
                React.createElement(BetControls, { bet, setBet, action: status==='RUNNING'?cashout:start, playing: false, label: status==='RUNNING'?t('cashout'):t('play'), color: status==='RUNNING'?'green':'gold' })
            );
        }

        // 5. PRO DICE (Slider UI)
        function DiceGame({ user, back, showMsg, t }) {
            const [bet, setBet] = useState(100);
            const [val, setVal] = useState(50);
            
            const roll = async () => {
                if(user.coins < bet) return showMsg(t('no_balance'), 'error');
                await updateDoc(doc(db,"users",user.id),{coins: user.coins - bet});
                
                const result = Math.floor(Math.random() * 100);
                if(result < val) { // Roll Under
                    const mult = (98 / val).toFixed(2);
                    const win = Math.floor(bet * mult);
                    await updateDoc(doc(db,"users",user.id),{coins: user.coins + win});
                    showMsg(`${t('you_win')} ${win}`, 'success');
                } else {
                    showMsg(t('you_lose'), 'error');
                }
            };

            const mult = (98 / val).toFixed(2);

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up" },
                React.createElement(GameHeader, { title: t('dice'), coins: user.coins, back, disabled: false }),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-6 gap-8" },
                    React.createElement('div', { className: "flex justify-between w-full bg-dark-800 p-4 rounded-xl border border-white/10" },
                        React.createElement('div', { className: "text-center" }, React.createElement('div', { className: "text-gray-500 text-xs" }, "Multiplier"), React.createElement('div', { className: "text-2xl font-bold text-gold-500" }, `${mult}x`)),
                        React.createElement('div', { className: "text-center" }, React.createElement('div', { className: "text-gray-500 text-xs" }, "Win Chance"), React.createElement('div', { className: "text-2xl font-bold text-white" }, `${val}%`))
                    ),
                    React.createElement('div', { className: "w-full bg-dark-900 h-4 rounded-full relative" },
                        React.createElement('div', { className: "absolute left-0 top-0 bottom-0 bg-gold-500 rounded-full", style: { width: `${val}%` } }),
                        React.createElement('input', { type: "range", min: 2, max: 97, value: val, onChange: e=>setVal(e.target.value), className: "absolute inset-0 w-full opacity-0 cursor-pointer" }),
                        React.createElement('div', { className: "absolute w-6 h-6 bg-white rounded-full shadow top-1/2 -translate-y-1/2 pointer-events-none transition-all", style: { left: `${val}%` } })
                    ),
                    React.createElement('p', { className: "text-sm text-gray-500" }, `Roll Under ${val} to Win`)
                ),
                React.createElement(BetControls, { bet, setBet, action: roll, playing: false, label: t('play') })
            );
        }

        // --- SHARED HELPERS ---
        const GameHeader = ({ title, coins, back, disabled }) => React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900 border-b border-white/10" },
            React.createElement('button', { onClick: back, disabled, className: "text-gray-400 disabled:opacity-30 p-2" }, React.createElement(ChevronRight)),
            React.createElement('span', { className: "font-bold text-lg" }, title),
            React.createElement('span', { className: "font-mono text-gold-500" }, coins.toLocaleString())
        );

        const BetControls = ({ bet, setBet, action, playing, label, hideBtn, color='gold' }) => React.createElement('div', { className: "p-4 bg-dark-900 border-t border-white/10 flex gap-4 pb-8" },
            React.createElement('div', { className: "relative w-1/3" }, React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Number(e.target.value)), disabled: playing, className: "w-full h-full bg-black border border-white/20 rounded-xl text-center font-bold text-white pl-6" }), React.createElement(DollarSign, { size: 14, className: "absolute top-1/2 -translate-y-1/2 left-3 text-gray-500" })),
            !hideBtn && React.createElement(Button, { full: true, onClick: action, disabled: playing, variant: color }, playing ? React.createElement('div',{className:"animate-spin-fast w-5 h-5 border-2 border-black border-t-transparent rounded-full mx-auto"}) : label)
        );

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
