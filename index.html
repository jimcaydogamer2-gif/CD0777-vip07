<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CD0777 Royal Club - Pro V9 (Performance Edition)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gold: { 100: '#FFF9C4', 300: '#FDD835', 400: '#FFD700', 500: '#FFC107', 600: '#FFB300', 700: '#FFA000', 800: '#C0A000', 900: '#3d2e07' },
                        dark: { 950: '#020617', 900: '#0f172a', 800: '#1e293b' }
                    },
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif'],
                        mono: ['Share Tech Mono', 'monospace'],
                        oswald: ['Oswald', 'sans-serif']
                    },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'pulse-glow': 'pulseGlow 2s infinite',
                        'number-roll': 'numberRoll 0.5s ease-out forwards'
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } },
                        slideUp: { '0%': { transform: 'translateY(100%)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 5px #FFD700' }, '50%': { boxShadow: '0 0 20px #FFD700' } }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Oswald:wght@500&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        body { background-color: #020617; color: #fff; overflow: hidden; touch-action: manipulation; }
        .glass-panel { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.08); }
        .gold-glow { text-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
        .luxury-bg { background-image: radial-gradient(circle at center, #1e293b 0%, #020617 100%); }
        input, select, button { outline: none; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 0px; }
        
        /* High Performance Range Slider */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 28px; width: 28px; border-radius: 50%; background: #FFD700; cursor: pointer; margin-top: -12px; box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); border: 4px solid #fff; transition: transform 0.1s; }
        input[type=range]::-webkit-slider-thumb:active { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; cursor: pointer; background: #334155; border-radius: 3px; }
        
        .btn-press:active { transform: scale(0.96); opacity: 0.9; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.294.0",
                "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
            }
        }
    </script>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { User, Gamepad2, LogOut, Send, CheckCircle, XCircle, ChevronRight, ChevronLeft, Lock, Gem, Home, CreditCard, Wallet, ShieldCheck, Trophy, Rocket, RefreshCw, Menu, X, Settings, History, Globe, LifeBuoy, Bomb, DollarSign, Percent, Zap, Disc, ArrowUpRight } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, where, getDocs } from 'firebase/firestore';

        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDJ5B7MncMfyjwb0ZnZ8p3d0bsoQAFqZQY",
            authDomain: "cd0777-casino.firebaseapp.com",
            projectId: "cd0777-casino",
            storageBucket: "cd0777-casino.firebasestorage.app",
            messagingSenderId: "320546250152",
            appId: "1:320546250152:web:730f6e581267b9b315919d"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- TEXTS & CONSTANTS ---
        const TEXTS = {
            ar: {
                welcome: "مرحباً", login: "دخول", register: "إنشاء حساب",
                name: "الاسم", phone: "الهاتف", user: "اسم المستخدم", pass: "كلمة المرور",
                home: "الرئيسية", casino: "الألعاب", wallet: "المحفظة",
                play: "بدء اللعب", withdraw: "سحب", deposit: "إيداع",
                limbo: "صاروخ الليمبو", dice: "النرد الكلاسيكي", mines: "حقل الألغام", keno: "كينو السريع",
                limbo_desc: "توقع ارتفاع الرقم", dice_desc: "تحكم بنسبة الفوز", mines_desc: "تجنب القنابل", keno_desc: "اختر أرقامك",
                target: "الهدف", payout: "المضاعف", win_chance: "فرصة الفوز", profit: "الربح المتوقع",
                you_win: "ربحت", you_lose: "حظ أوفر",
                settings: "الإعدادات", logout: "خروج", success: "نجاح", error: "خطأ", no_balance: "رصيد غير كافي"
            },
            en: {
                welcome: "Welcome", login: "Login", register: "Register",
                name: "Name", phone: "Phone", user: "Username", pass: "Password",
                home: "Home", casino: "Games", wallet: "Wallet",
                play: "Bet", withdraw: "Withdraw", deposit: "Deposit",
                limbo: "Limbo", dice: "Classic Dice", mines: "Mines", keno: "Speed Keno",
                limbo_desc: "Target Multiplier", dice_desc: "Adjust Win Chance", mines_desc: "Avoid Bombs", keno_desc: "Pick Numbers",
                target: "Target", payout: "Payout", win_chance: "Win Chance", profit: "Profit",
                you_win: "You Win", you_lose: "You Lose",
                settings: "Settings", logout: "Logout", success: "Success", error: "Error", no_balance: "No Balance"
            }
        };

        // --- COMPONENTS ---
        const Button = ({ children, onClick, disabled, variant='gold', full, className='', icon: Icon }) => {
            const base = "relative font-bold py-3.5 px-6 rounded-xl transition-all flex items-center justify-center gap-2 btn-press disabled:opacity-50 disabled:grayscale";
            const styles = {
                gold: 'bg-gradient-to-b from-[#FFD700] to-[#B8860B] text-black shadow-[0_4px_15px_rgba(255,215,0,0.3)] border border-[#FFD700]',
                green: 'bg-gradient-to-b from-emerald-500 to-emerald-700 text-white border border-emerald-500 shadow-[0_4px_15px_rgba(16,185,129,0.3)]',
                dark: 'bg-dark-800 text-gold-500 border border-gold-500/30 hover:bg-dark-700'
            };
            return React.createElement('button', { onClick, disabled, className: `${base} ${styles[variant]} ${full?'w-full':''} ${className}` }, Icon && React.createElement(Icon, { size: 20 }), children);
        };

        const Input = (props) => React.createElement('div', { className: "relative group w-full" },
            props.icon && React.createElement(props.icon, { size: 18, className: "absolute top-1/2 -translate-y-1/2 right-4 text-gray-500 group-focus-within:text-gold-500 transition-colors" }),
            React.createElement('input', { ...props, className: `w-full bg-dark-900 border border-white/10 p-4 ${props.icon?'pr-12':''} rounded-xl text-white outline-none focus:border-gold-500 transition-all placeholder:text-gray-600 ${props.className}` })
        );

        // --- APP ROOT ---
        export default function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('auth');
            const [lang, setLang] = useState('ar');
            const [notify, setNotify] = useState(null);
            const [menuOpen, setMenuOpen] = useState(false);

            const t = (k) => TEXTS[lang][k] || k;
            const showMsg = (msg, type='success') => { setNotify({msg, type}); setTimeout(()=>setNotify(null), 3000); };
            const navTo = (v) => { setView(v); setMenuOpen(false); };

            useEffect(() => {
                const uid = localStorage.getItem('cd0777_uid');
                if (uid && db) onSnapshot(doc(db, "users", uid), (s) => {
                    if (s.exists()) { setUser({ id: s.id, ...s.data() }); if(view === 'auth') setView('home'); }
                    else { setUser(null); setView('auth'); }
                });
            }, []);

            if (!user && view === 'auth') return React.createElement(AuthScreen, { setUser, setView, showMsg, t, lang, setLang });

            // Games
            if (view === 'game-limbo') return React.createElement(LimboGame, { user, back: ()=>navTo('casino'), showMsg, t });
            if (view === 'game-dice') return React.createElement(DiceGame, { user, back: ()=>navTo('casino'), showMsg, t });
            if (view === 'game-mines') return React.createElement(MinesGame, { user, back: ()=>navTo('casino'), showMsg, t });

            return React.createElement('div', { className: "h-screen flex flex-col bg-dark-950 text-white", dir: lang==='ar'?'rtl':'ltr' },
                notify && React.createElement('div', { className: `fixed top-6 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-pop glass-panel w-max ${notify.type==='error'?'border-red-500 text-red-400':'border-green-500 text-green-400'}` }, notify.type==='success'?React.createElement(CheckCircle,{size:20}):React.createElement(XCircle,{size:20}), React.createElement('span',{className:"font-bold"},notify.msg)),
                
                React.createElement(Header, { user, toggleMenu: ()=>setMenuOpen(true) }),
                menuOpen && React.createElement(Sidebar, { user, close: ()=>setMenuOpen(false), navTo, t, lang, setLang }),

                React.createElement('main', { className: "flex-1 overflow-y-auto p-5 pb-28" },
                    view === 'home' && React.createElement(HomeScreen, { user, navTo, t }),
                    view === 'casino' && React.createElement(CasinoScreen, { navTo, t }),
                    view === 'wallet' && React.createElement(WalletScreen, { user, t }),
                    view === 'settings' && React.createElement(SettingsScreen, { user, t })
                ),

                React.createElement('nav', { className: "fixed bottom-4 left-4 right-4 h-16 glass-panel rounded-2xl z-40 flex justify-around items-center border border-white/10 shadow-2xl" },
                    React.createElement(NavBtn, { icon: Home, label: t('home'), active: view==='home', onClick:()=>navTo('home') }),
                    React.createElement(NavBtn, { icon: Gamepad2, label: t('casino'), active: view==='casino', onClick:()=>navTo('casino') }),
                    React.createElement(NavBtn, { icon: Wallet, label: t('wallet'), active: view==='wallet', onClick:()=>navTo('wallet') })
                )
            );
        }

        // --- AUTH & CORE ---
        function AuthScreen({ setUser, setView, showMsg, t, lang, setLang }) {
            const [isReg, setIsReg] = useState(false); const [f, setF] = useState({u:'',p:'',n:'',ph:''});
            const submit = async () => {
                try {
                    if(!f.u || !f.p) throw new Error(t('inputs_err'));
                    if(isReg) {
                        const q = query(collection(db,"users"),where("username","==",f.u)); if(!(await getDocs(q)).empty) throw new Error("Taken");
                        const ref = await addDoc(collection(db,"users"),{username:f.u, password:f.p, fullName:f.n, coins:100, balance:0}); 
                        localStorage.setItem('cd0777_uid', ref.id); setUser({id:ref.id, ...f, coins:100});
                    } else {
                        const q = query(collection(db,"users"),where("username","==",f.u),where("password","==",f.p)); const s=await getDocs(q);
                        if(s.empty) throw new Error("Invalid"); localStorage.setItem('cd0777_uid',s.docs[0].id); setUser({id:s.docs[0].id, ...s.docs[0].data()});
                    }
                    setView('home');
                } catch(e) { showMsg(e.message, 'error'); }
            };
            return React.createElement('div', { className: "h-full flex flex-col items-center justify-center p-6 bg-dark-950 luxury-bg relative" },
                React.createElement('button', { onClick: ()=>setLang(lang==='ar'?'en':'ar'), className: "absolute top-6 right-6 text-xs bg-white/10 px-3 py-1 rounded-full text-gold-500 font-bold" }, lang.toUpperCase()),
                React.createElement('div', { className: "w-32 h-32 rounded-3xl bg-gradient-to-tr from-gold-400 to-gold-700 flex items-center justify-center text-6xl font-black text-black mb-8 shadow-2xl shadow-gold-500/20" }, "CD"),
                React.createElement('div', { className: "w-full max-w-sm space-y-4" },
                    isReg && React.createElement(Input, { icon: User, placeholder: t('name'), onChange: e=>setF({...f,n:e.target.value}) }),
                    React.createElement(Input, { icon: User, placeholder: t('user'), onChange: e=>setF({...f,u:e.target.value}) }),
                    React.createElement(Input, { icon: Lock, type: "password", placeholder: t('pass'), onChange: e=>setF({...f,p:e.target.value}) }),
                    React.createElement(Button, { full: true, onClick: submit }, isReg?t('register'):t('login')),
                    React.createElement('button', { onClick: ()=>setIsReg(!isReg), className: "w-full text-center text-xs text-gray-500 mt-4" }, isReg?t('login'):t('register'))
                )
            );
        }

        const Header = ({ user, toggleMenu }) => React.createElement('div', { className: "sticky top-0 z-40 bg-dark-950/80 backdrop-blur-md border-b border-white/5 px-5 py-4 flex justify-between items-center" },
            React.createElement('div', { className: "flex items-center gap-3" }, React.createElement('button', { onClick: toggleMenu, className: "p-2 bg-dark-900 rounded-xl text-gold-500 border border-white/5 btn-press" }, React.createElement(Menu, { size: 24 })), React.createElement('div', { className: "font-black text-gold-500 text-xl" }, "CD0777")),
            React.createElement('div', { className: "bg-dark-900 border border-white/10 px-4 py-1.5 rounded-full flex items-center gap-2" }, React.createElement(Gem, { size: 16, className: "text-gold-500" }), React.createElement('span', { className: "text-gold-500 font-mono font-bold" }, user.coins.toLocaleString()))
        );

        const Sidebar = ({ close, navTo, t, lang, setLang }) => React.createElement('div', { className: "fixed inset-0 z-50 flex" },
            React.createElement('div', { className: "absolute inset-0 bg-black/80 backdrop-blur-sm", onClick: close }),
            React.createElement('div', { className: "relative w-72 bg-dark-900 border-l border-gold-500/20 h-full p-6 shadow-2xl flex flex-col" },
                React.createElement('div', { className: "flex justify-between mb-8" }, React.createElement('h2',{className:"text-gold-500 font-bold text-2xl"}, "MENU"), React.createElement(X,{onClick:close})),
                [ {i:Home,l:'home'}, {i:Gamepad2,l:'casino'}, {i:Wallet,l:'wallet'}, {i:Settings,l:'settings'} ].map(x => React.createElement('button',{key:x.l, onClick:()=>navTo(x.l), className:"flex gap-4 p-4 text-gray-300 hover:bg-white/5 rounded-xl mb-2 w-full"}, React.createElement(x.i), t(x.l))),
                React.createElement('button', { onClick: ()=>setLang(lang==='ar'?'en':'ar'), className: "mt-auto w-full flex justify-between p-4 bg-black/20 rounded-xl" }, React.createElement(Globe), lang.toUpperCase())
            )
        );

        const NavBtn = ({ icon: Icon, label, active, onClick }) => React.createElement('button', { onClick, className: `flex flex-col items-center gap-1 transition-all ${active?'text-gold-500 -translate-y-1 scale-110':'text-gray-500'}` }, React.createElement(Icon, { size: 24, strokeWidth: active?2.5:2 }), React.createElement('span', { className: "text-[9px] font-bold" }, label));

        function HomeScreen({ user, navTo, t }) {
            return React.createElement('div', { className: "space-y-6 animate-pop" },
                React.createElement('div', { className: "bg-gradient-to-r from-gold-600 to-gold-400 p-6 rounded-2xl text-black shadow-lg" }, React.createElement('h2', { className: "font-black text-2xl mb-1" }, "VIP CLUB"), React.createElement('p', { className: "font-mono text-xl opacity-80" }, `${user.coins.toLocaleString()} Coins`)),
                React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                    React.createElement('button', { onClick: ()=>navTo('casino'), className: "bg-dark-800 p-6 rounded-2xl border border-white/10 hover:border-gold-500 transition-all flex flex-col items-center gap-2" }, React.createElement(Gamepad2, { className: "text-gold-500", size: 32 }), React.createElement('span', { className: "font-bold" }, t('play'))),
                    React.createElement('button', { onClick: ()=>navTo('wallet'), className: "bg-dark-800 p-6 rounded-2xl border border-white/10 hover:border-green-500 transition-all flex flex-col items-center gap-2" }, React.createElement(Wallet, { className: "text-green-500", size: 32 }), React.createElement('span', { className: "font-bold" }, t('deposit')))
                )
            );
        }

        // ==========================================
        // === ULTRA PERFORMANCE GAMES (LAG FREE) ===
        // ==========================================

        // 1. LIMBO (Rocket) - Pure Math, No Canvas
        function LimboGame({ user, back, showMsg, t }) {
            const [target, setTarget] = useState(2.0);
            const [bet, setBet] = useState(100);
            const [result, setResult] = useState(1.00);
            const [playing, setPlaying] = useState(false);
            const [win, setWin] = useState(null); // null, true, false

            const winChance = (98 / target).toFixed(2); // 98% RTP
            const profit = (bet * target - bet).toFixed(0);

            const play = async () => {
                if(user.coins < bet) return showMsg(t('no_balance'), 'error');
                setPlaying(true); setWin(null);
                await updateDoc(doc(db,"users",user.id), { coins: Number(user.coins) - Number(bet) });
                
                // Logic: Generate outcome immediately
                const outcome = (Math.random() * 100) < 98 ? (1 / (1 - Math.random()) * 0.98) : 0;
                const finalResult = Math.max(1.00, outcome).toFixed(2);
                const isWin = finalResult >= target;

                // Animation: Just count up numbers quickly
                let display = 1.00;
                const step = (finalResult - 1) / 20; // 20 frames
                const interval = setInterval(() => {
                    display += Math.max(0.05, step); // Speed up
                    if (display >= finalResult) {
                        clearInterval(interval);
                        setResult(finalResult);
                        finish(isWin, finalResult);
                    } else {
                        setResult(display.toFixed(2));
                    }
                }, 30);
            };

            const finish = async (isWin, val) => {
                setPlaying(false);
                setWin(isWin);
                if (isWin) {
                    const payout = Math.floor(bet * target);
                    await updateDoc(doc(db,"users",user.id), { coins: Number(user.coins) + payout });
                    showMsg(`${t('you_win')} ${payout}`, 'success');
                }
            };

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up" },
                React.createElement(GameHeader, { title: "LIMBO", coins: user.coins, back, disabled: playing }),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center" },
                    React.createElement('div', { className: "relative w-64 h-64 flex items-center justify-center" },
                        React.createElement('div', { className: `absolute inset-0 rounded-full border-4 ${win===true?'border-green-500 shadow-[0_0_30px_#10b981]':(win===false?'border-red-500':'border-dark-800')} transition-all duration-300` }),
                        React.createElement('div', { className: "text-center z-10" },
                            React.createElement('div', { className: `text-6xl font-black font-mono tracking-tighter ${win===true?'text-green-500':(win===false?'text-red-500':'text-white')}` }, result + "x"),
                            React.createElement('div', { className: "text-sm text-gray-500 mt-2" }, isNaN(result) ? "1.00x" : "RESULT")
                        ),
                        playing && React.createElement(Rocket, { className: "absolute text-gold-500 opacity-20 animate-pulse", size: 150 })
                    ),
                    React.createElement('div', { className: "w-full max-w-sm px-6 mt-8 space-y-6" },
                        React.createElement('div', { className: "bg-dark-900 p-4 rounded-xl border border-white/5 flex justify-between items-center" },
                            React.createElement('div', {}, React.createElement('p',{className:"text-xs text-gray-500"},t('target')), React.createElement('span',{className:"text-xl font-bold text-gold-500"}, target + "x")),
                            React.createElement('input', { type: "range", min: "1.01", max: "100", step: "0.01", value: target, onChange: e=>setTarget(e.target.value), disabled: playing })
                        ),
                        React.createElement('div', { className: "flex justify-between text-sm text-gray-400 font-mono" },
                            React.createElement('div', {}, `${t('win_chance')}: `, React.createElement('span',{className:"text-white"}, winChance, "%")),
                            React.createElement('div', {}, `${t('profit')}: `, React.createElement('span',{className:"text-green-500"}, profit))
                        )
                    )
                ),
                React.createElement(BetPanel, { bet, setBet, action: play, playing, label: t('play') })
            );
        }

        // 2. CLASSIC DICE - Range Slider, Ultra Smooth
        function DiceGame({ user, back, showMsg, t }) {
            const [val, setVal] = useState(50);
            const [bet, setBet] = useState(100);
            const [playing, setPlaying] = useState(false);
            const [lastRoll, setLastRoll] = useState(null);

            // Win if ROLL > val. (Over)
            const multiplier = (98 / (100 - val)).toFixed(4);
            const winChance = 100 - val;

            const roll = async () => {
                if(user.coins < bet) return showMsg(t('no_balance'), 'error');
                setPlaying(true);
                await updateDoc(doc(db,"users",user.id), { coins: Number(user.coins) - Number(bet) });

                // Instant result
                const result = Math.floor(Math.random() * 100); // 0-99
                
                setTimeout(async () => {
                    setLastRoll(result);
                    setPlaying(false);
                    const isWin = result >= val;
                    if(isWin) {
                        const win = Math.floor(bet * multiplier);
                        await updateDoc(doc(db,"users",user.id), { coins: Number(user.coins) + win });
                        showMsg(`${t('you_win')} ${win}`, 'success');
                    } else {
                        showMsg(t('you_lose'), 'error');
                    }
                }, 400); // Short delay for UI effect
            };

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up" },
                React.createElement(GameHeader, { title: "DICE", coins: user.coins, back, disabled: playing }),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center px-6" },
                    React.createElement('div', { className: "w-full max-w-md bg-dark-900 rounded-3xl p-8 border border-white/5 shadow-2xl relative overflow-hidden" },
                        React.createElement('div', { className: "flex justify-between mb-8" },
                            React.createElement('div', {}, React.createElement('div',{className:"text-xs text-gray-500 uppercase"},t('payout')), React.createElement('div',{className:"text-3xl font-bold text-gold-500"}, multiplier + "x")),
                            React.createElement('div', { className: "text-right" }, React.createElement('div',{className:"text-xs text-gray-500 uppercase"},t('win_chance')), React.createElement('div',{className:"text-3xl font-bold text-blue-500"}, winChance + "%"))
                        ),
                        React.createElement('div', { className: "relative h-16 bg-dark-800 rounded-xl mb-6 flex items-center px-2 border border-white/5" },
                            React.createElement('div', { className: `absolute top-0 bottom-0 left-0 bg-gradient-to-r from-red-500/20 to-red-500/5`, style: { width: `${val}%` } }),
                            React.createElement('div', { className: `absolute top-0 bottom-0 right-0 bg-gradient-to-l from-green-500/20 to-green-500/5`, style: { width: `${100-val}%` } }),
                            React.createElement('input', { type: "range", min: "2", max: "98", value: val, onChange: e=>setVal(Number(e.target.value)), disabled: playing, className: "z-20 w-full opacity-0 absolute inset-0 cursor-pointer" }),
                            // Custom Handle visual
                            React.createElement('div', { className: "absolute top-2 bottom-2 w-1.5 bg-white rounded pointer-events-none transition-all", style: { left: `${val}%` } }),
                            // Result visual
                            lastRoll !== null && React.createElement('div', { className: `absolute top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center font-bold rounded-lg border-2 z-10 transition-all duration-300 ${lastRoll >= val ? 'bg-green-500 text-black border-green-300' : 'bg-red-500 text-white border-red-300'}`, style: { left: `calc(${lastRoll}% - 20px)` } }, lastRoll)
                        ),
                        React.createElement('div', { className: "flex justify-between text-xs font-mono text-gray-500" }, React.createElement('span',{},"0"), React.createElement('span',{className:"text-white font-bold"}, val), React.createElement('span',{},"100"))
                    )
                ),
                React.createElement(BetPanel, { bet, setBet, action: roll, playing, label: t('play') })
            );
        }

        // 3. MINES - CSS Grid, No Canvas, Smooth
        function MinesGame({ user, back, showMsg, t }) {
            const [minesCount, setMinesCount] = useState(3);
            const [bet, setBet] = useState(100);
            const [status, setStatus] = useState('IDLE'); // IDLE, PLAYING, CASHED, LOST
            const [grid, setGrid] = useState(Array(25).fill({ revealed: false, isMine: false }));
            
            // RTP Math
            const getMultiplier = (revealedCount) => {
                let m = 1.0;
                // Simplified logic: Standard Mines multiplier
                // Actual formula: (25! / (25-mines)! / mines!) ... logic approx:
                for(let i=0; i<revealedCount; i++) m *= (1 + (minesCount / (25 - minesCount - i)));
                return m;
            };
            const revealed = grid.filter(c => c.revealed).length;
            const currentMulti = getMultiplier(revealed).toFixed(2);
            const currentWin = Math.floor(bet * currentMulti);

            const start = async () => {
                if(user.coins < bet) return showMsg(t('no_balance'), 'error');
                await updateDoc(doc(db,"users",user.id), { coins: Number(user.coins) - Number(bet) });
                
                // Generate Mines securely
                const newGrid = Array(25).fill(null).map(() => ({ revealed: false, isMine: false }));
                let placed = 0;
                while(placed < minesCount) {
                    const idx = Math.floor(Math.random() * 25);
                    if(!newGrid[idx].isMine) { newGrid[idx].isMine = true; placed++; }
                }
                setGrid(newGrid);
                setStatus('PLAYING');
            };

            const clickTile = async (idx) => {
                if(status !== 'PLAYING' || grid[idx].revealed) return;
                
                const tile = grid[idx];
                const newGrid = [...grid];
                newGrid[idx] = { ...tile, revealed: true };
                setGrid(newGrid);

                if(tile.isMine) {
                    setStatus('LOST');
                    showMsg(t('you_lose'), 'error');
                } else {
                    // Check if all safe tiles found
                    if(newGrid.filter(c => c.revealed && !c.isMine).length === (25 - minesCount)) {
                        cashout(newGrid);
                    }
                }
            };

            const cashout = async (finalGrid = grid) => {
                if(status !== 'PLAYING') return;
                const win = Math.floor(bet * getMultiplier(finalGrid.filter(c=>c.revealed && !c.isMine).length));
                await updateDoc(doc(db,"users",user.id), { coins: Number(user.coins) + win });
                setStatus('CASHED');
                showMsg(`${t('you_win')} ${win}`, 'success');
            };

            return React.createElement('div', { className: "fixed inset-0 bg-dark-950 z-50 flex flex-col h-full animate-slide-up" },
                React.createElement(GameHeader, { title: "MINES", coins: user.coins, back, disabled: status==='PLAYING' }),
                React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-4" },
                    status === 'PLAYING' && React.createElement('div', { className: "mb-4 bg-emerald-900/40 px-6 py-2 rounded-full border border-emerald-500/30 backdrop-blur" },
                        React.createElement('span', { className: "text-emerald-400 font-mono font-bold text-xl mr-2" }, currentMulti + "x"),
                        React.createElement('span', { className: "text-white text-sm" }, `Win: ${currentWin}`)
                    ),
                    React.createElement('div', { className: "grid grid-cols-5 gap-2 w-full max-w-[350px] aspect-square" },
                        grid.map((tile, i) => React.createElement('button', {
                            key: i,
                            onClick: () => clickTile(i),
                            disabled: status !== 'PLAYING' && !tile.revealed,
                            className: `rounded-lg transition-all duration-200 flex items-center justify-center text-2xl
                                ${tile.revealed 
                                    ? (tile.isMine ? 'bg-red-500/20 border-red-500' : 'bg-dark-800 border-emerald-500/50') 
                                    : 'bg-dark-800 border-white/10 hover:bg-dark-700 active:scale-95'}
                                border-2`
                        }, 
                        tile.revealed ? (tile.isMine ? React.createElement(Bomb, { className: "animate-pop text-red-500" }) : React.createElement(Gem, { className: "animate-pop text-emerald-400" })) : ''
                        ))
                    )
                ),
                React.createElement('div', { className: "p-4 bg-dark-900 border-t border-white/10" },
                    status === 'PLAYING' ? 
                    React.createElement(Button, { full: true, variant: "green", onClick: ()=>cashout() }, `${t('withdraw')} (${currentWin})`) :
                    React.createElement('div', { className: "space-y-4" },
                        React.createElement('div', { className: "flex justify-between items-center bg-black/30 p-3 rounded-xl" },
                            React.createElement('span', { className: "text-sm text-gray-400" }, "Mines"),
                            React.createElement('div', { className: "flex gap-2" }, [1,3,5,10].map(n => React.createElement('button', { key: n, onClick: ()=>setMinesCount(n), className: `w-8 h-8 rounded-lg font-bold text-sm ${minesCount===n?'bg-gold-500 text-black':'bg-dark-800 text-gray-400'}` }, n)))
                        ),
                        React.createElement(BetPanel, { bet, setBet, action: start, playing: false, label: t('play'), hideInput: true })
                    )
                )
            );
        }

        // --- SHARED UI ---
        const GameHeader = ({ title, coins, back, disabled }) => React.createElement('div', { className: "flex justify-between items-center p-4 bg-dark-900 border-b border-white/10 shrink-0" },
            React.createElement('button', { onClick: back, disabled, className: "text-gray-400 disabled:opacity-30 p-2 btn-press" }, React.createElement(ChevronRight)),
            React.createElement('span', { className: "font-bold text-lg text-gold-500" }, title),
            React.createElement('span', { className: "font-mono bg-black/40 px-3 py-1 rounded-lg text-sm" }, coins.toLocaleString())
        );

        const BetPanel = ({ bet, setBet, action, playing, label, hideInput }) => React.createElement('div', { className: "flex gap-4 items-center bg-dark-900 p-4 shrink-0 pb-safe" },
            !hideInput && React.createElement('div', { className: "relative w-1/3" },
                React.createElement('input', { type: "number", value: bet, onChange: e=>setBet(Math.max(1, Number(e.target.value))), disabled: playing, className: "w-full bg-black border border-white/20 rounded-xl py-3 pl-8 text-white font-bold" }),
                React.createElement(DollarSign, { size: 14, className: "absolute top-1/2 -translate-y-1/2 left-3 text-gold-500" })
            ),
            React.createElement(Button, { full: true, onClick: action, disabled: playing, className: "flex-1" }, playing ? React.createElement(RefreshCw, { className: "animate-spin" }) : label)
        );

        function WalletScreen({ user, t }) { return React.createElement('div', {className:"p-4 text-center"}, React.createElement('h1',{className:"text-gold-500 text-3xl font-bold"}, `$${user.balance}`)); }
        function SettingsScreen({ user, t }) { return React.createElement('div', {className:"p-4"}, "Settings"); }
        function CasinoScreen({ navTo, t }) {
            const games = [
                { id: 'game-limbo', title: t('limbo'), desc: t('limbo_desc'), icon: Rocket, color: 'purple' },
                { id: 'game-dice', title: t('dice'), desc: t('dice_desc'), icon: Disc, color: 'blue' },
                { id: 'game-mines', title: t('mines'), desc: t('mines_desc'), icon: Bomb, color: 'red' }
            ];
            return React.createElement('div', { className: "space-y-4 animate-pop" },
                games.map(g => React.createElement('button', { key: g.id, onClick: ()=>navTo(g.id), className: "w-full bg-dark-800 p-4 rounded-xl border border-white/5 flex items-center gap-4 hover:border-gold-500/50 transition-all btn-press" },
                    React.createElement('div', { className: `w-12 h-12 rounded-full bg-${g.color}-500/10 flex items-center justify-center text-${g.color}-500` }, React.createElement(g.icon)),
                    React.createElement('div', { className: "text-right" }, React.createElement('h3', { className: "font-bold text-lg" }, g.title), React.createElement('p', { className: "text-xs text-gray-500" }, g.desc))
                ))
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
