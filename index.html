<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CD0777 Premium Club</title>
    <!-- مكتبة التصميم -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: { 100: '#FFF9C4', 300: '#FDD835', 500: '#FFD700', 600: '#C0A000', 900: '#3d2e07' },
                        dark: { 900: '#000000', 800: '#0a0a0a', 700: '#151515' }
                    },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'glow': 'glow 2s ease-in-out infinite alternate'
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } },
                        glow: { 'from': { boxShadow: '0 0 10px #FFD700' }, 'to': { boxShadow: '0 0 20px #FFD700, 0 0 10px #FFD700' } }
                    }
                }
            }
        }
    </script>
    <!-- الخطوط -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Oswald:wght@500&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #000; color: #fff; overflow: hidden; user-select: none; }
        .font-tech { font-family: 'Share Tech Mono', monospace; }
        .font-oswald { font-family: 'Oswald', sans-serif; }
        .glass-panel { background: rgba(20, 20, 20, 0.85); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 215, 0, 0.15); }
        .gold-glow { text-shadow: 0 0 10px rgba(255, 215, 0, 0.6); }
        input, select { outline: none; }
        ::-webkit-scrollbar { width: 0px; }
        .typing-effect { border-left: 2px solid #FFD700; white-space: pre-wrap; overflow: hidden; animation: blink-caret 0.75s step-end infinite; }
        @keyframes blink-caret { from, to { border-color: transparent } 50% { border-color: #FFD700; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- استدعاء المكتبات -->
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.294.0",
                "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
            }
        }
    </script>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { User, Gamepad2, LogOut, Send, CheckCircle, XCircle, ChevronRight, Lock, Gem, Home, CreditCard, Wallet, ShieldCheck, Trophy, Instagram, Facebook, ExternalLink, Plus, Trash2, Smartphone, Zap, Check, Dices, RefreshCw, Sparkles, BrainCircuit, Menu, X, AlertTriangle } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, where, getDocs, orderBy, deleteDoc } from 'firebase/firestore';

        // =======================================================
        // ✅ تم دمج بياناتك بنجاح ✅
        // =======================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDJ5B7MncMfyjwb0ZnZ8p3d0bsoQAFqZQY",
            authDomain: "cd0777-casino.firebaseapp.com",
            projectId: "cd0777-casino",
            storageBucket: "cd0777-casino.firebasestorage.app",
            messagingSenderId: "320546250152",
            appId: "1:320546250152:web:730f6e581267b9b315919d"
        };
        // =======================================================

        const GEMINI_API_KEY = ""; // اتركه فارغاً إلا إذا كان لديك مفتاح AI

        // تهيئة النظام
        let db = null;
        let configError = "";
        try {
             const app = initializeApp(firebaseConfig);
             db = getFirestore(app);
             console.log("Firebase Connected Successfully");
        } catch (e) { 
            console.error(e); 
            configError = "خطأ في الاتصال بقاعدة البيانات. تأكد من تفعيل Firestore في وضع الاختبار (Test Mode)."; 
        }

        // الروابط
        const LINKS = {
            TELEGRAM: "https://t.me/cd0777cc",
            ONEXBET: "https://1xlite-81807.bar/mobile?bf=cb1696c403824_11662230653",
            INSTAGRAM: "https://www.instagram.com/p/DSEHfeWiAWo/?igsh=bWMxZTMxcGJoMWx6",
            FACEBOOK: "https://www.facebook.com/share/p/17gNCDYUYs/"
        };

        // --- GEMINI AI (Optional) ---
        async function askGemini(prompt, sys) {
            if (!GEMINI_API_KEY) return "خدمة العراف غير مفعلة (مفتاح API مفقود).";
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: sys }] } })
                });
                const data = await res.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "النجوم صامتة...";
            } catch (e) { return "خطأ في الاتصال بالعراف."; }
        }

        // --- UI COMPONENTS ---
        const Button = ({ children, onClick, disabled, variant='gold', full, className='' }) => {
            const styles = {
                gold: 'bg-gradient-to-b from-[#FFD700] to-[#C0A000] text-black shadow-[0_4px_15px_rgba(255,215,0,0.3)] border border-[#FFD700]',
                green: 'bg-gradient-to-r from-emerald-600 to-green-500 text-white border border-emerald-400 shadow-[0_4px_15px_rgba(16,185,129,0.3)]',
                red: 'bg-gradient-to-r from-red-600 to-red-800 text-white border-red-500',
                dark: 'bg-zinc-900 text-yellow-500 border border-yellow-500/30',
                ai: 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white border border-purple-400 shadow-[0_0_15px_rgba(147,51,234,0.5)]'
            };
            return React.createElement('button', { onClick, disabled, className: `relative font-bold py-3 px-6 rounded-xl active:scale-95 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:grayscale ${styles[variant]} ${full?'w-full':''} ${className}` }, children);
        };

        const Input = (props) => React.createElement('input', { ...props, className: "w-full bg-zinc-900 border border-white/10 p-4 rounded-xl text-white outline-none focus:border-yellow-500 transition-all placeholder:text-zinc-600" });

        // --- APP ---
        export default function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('auth');
            const [notify, setNotify] = useState(null);
            const [menuOpen, setMenuOpen] = useState(false);

            useEffect(() => {
                const uid = localStorage.getItem('cd0777_uid');
                if (uid && db) {
                    const unsub = onSnapshot(doc(db, "users", uid), (s) => {
                        if (s.exists()) {
                            const u = { id: s.id, ...s.data() };
                            setUser(u);
                            if (view === 'auth') setView(u.role === 'admin' ? 'admin' : 'home');
                        }
                    }, (err) => {
                        console.log("Session reset required");
                    });
                    return () => unsub();
                }
            }, []);

            const showMsg = (msg, type='success') => { setNotify({msg, type}); setTimeout(() => setNotify(null), 3000); };
            const logout = () => { localStorage.removeItem('cd0777_uid'); setUser(null); setView('auth'); };
            const navTo = (v) => { setView(v); setMenuOpen(false); };

            if(configError) return React.createElement('div', {className:"h-screen flex items-center justify-center text-red-500 bg-black p-4 text-center"}, React.createElement('div',{}, React.createElement(AlertTriangle,{size:48, className:"mx-auto mb-4"}), React.createElement('h1',{className:"text-2xl font-bold"},"خطأ في الإعدادات"), React.createElement('p',{},configError)));

            if(!user && view === 'auth') return React.createElement(AuthScreen, { onLogin:(u)=>{setUser(u); setView(u.role==='admin'?'admin':'home');}, showMsg });
            if(user?.role === 'admin' && view === 'admin') return React.createElement(AdminPanel, { user, logout });
            
            // Full Screen Games
            if(view === 'game-crash') return React.createElement(CrashGame, { user, back:()=>navTo('casino'), showMsg });
            if(view === 'game-plinko') return React.createElement(PlinkoGame, { user, back:()=>navTo('casino'), showMsg });
            if(view === 'oracle') return React.createElement(OracleScreen, { user, back:()=>navTo('home'), showMsg });

            return React.createElement('div', { className: "h-screen bg-black text-white flex flex-col overflow-hidden relative selection:bg-yellow-500 selection:text-black" },
                React.createElement('div', { className: "fixed inset-0 pointer-events-none bg-[radial-gradient(circle_at_top_right,_#1a1a1a_0%,_#000000_60%)]" }),
                notify && React.createElement('div', { className: `fixed top-6 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-xl shadow-2xl border flex items-center gap-3 animate-pop glass-panel ${notify.type==='error'?'bg-red-950 border-red-500':'bg-green-950 border-green-500'}` }, notify.type==='success'?React.createElement(CheckCircle,{size:20}):React.createElement(XCircle,{size:20}), React.createElement('span',{className:"font-bold text-sm"},notify.msg)),
                
                // Header
                React.createElement(Header, { user, toggleMenu: ()=>setMenuOpen(true) }),
                
                // Sidebar
                menuOpen && React.createElement('div', { className: "fixed inset-0 z-50 flex" },
                    React.createElement('div', { className: "absolute inset-0 bg-black/80 backdrop-blur-sm", onClick:()=>setMenuOpen(false) }),
                    React.createElement('div', { className: "relative w-64 bg-[#111] border-l border-white/10 h-full p-6 shadow-2xl flex flex-col animate-shake" },
                        React.createElement('div', { className: "flex justify-between items-center mb-8 border-b border-white/10 pb-4" }, React.createElement('h2',{className:"text-yellow-500 font-bold text-xl"},"القائمة"), React.createElement('button',{onClick:()=>setMenuOpen(false), className:"text-gray-400"},React.createElement(X))),
                        React.createElement('nav', { className: "space-y-3 flex-1" },
                            React.createElement(SidebarBtn, { icon: Home, label: "الرئيسية", onClick:()=>navTo('home'), active:view==='home' }),
                            React.createElement(SidebarBtn, { icon: Dices, label: "الكازينو", onClick:()=>navTo('casino'), active:view==='casino' }),
                            React.createElement(SidebarBtn, { icon: Trophy, label: "المهام", onClick:()=>navTo('tasks'), active:view==='tasks' }),
                            React.createElement(SidebarBtn, { icon: Wallet, label: "المحفظة", onClick:()=>navTo('profile'), active:view==='profile' })
                        ),
                        React.createElement('button', { onClick:logout, className: "mt-auto w-full flex items-center justify-center gap-2 text-red-500 p-3 bg-red-900/10 rounded-xl font-bold" }, React.createElement(LogOut,{size:18}), "خروج")
                    )
                ),

                React.createElement('main', { className: "flex-1 overflow-y-auto p-4 pb-10 z-10 scrollbar-hide" },
                    view === 'home' && React.createElement(HomeScreen, { user, navTo }),
                    view === 'casino' && React.createElement(CasinoScreen, { navTo }),
                    view === 'tasks' && React.createElement(TasksScreen, { user, showMsg }),
                    view === 'profile' && React.createElement(ProfileScreen, { user, showMsg })
                )
            );
        }

        // --- COMPONENTS ---
        const Header = ({ user, toggleMenu }) => React.createElement('div', { className: "sticky top-0 z-40 bg-[#080808]/90 backdrop-blur-md border-b border-white/5 px-4 py-3 flex justify-between items-center" },
            React.createElement('div', { className: "flex items-center gap-3" },
                React.createElement('button', { onClick: toggleMenu, className: "p-2 bg-[#1a1a1a] rounded-lg text-yellow-500 border border-white/5 active:scale-90" }, React.createElement(Menu, { size: 24 })),
                React.createElement('div', { className: "w-8 h-8 rounded-lg bg-gradient-to-tr from-yellow-500 to-yellow-700 flex items-center justify-center font-bold text-black text-xs shadow-lg" }, "CD")
            ),
            React.createElement('div', { className: "bg-[#111] border border-white/10 px-3 py-1.5 rounded-full flex items-center gap-2 shadow-inner" }, React.createElement(Gem, { size: 14, className: "text-yellow-500" }), React.createElement('span', { className: "text-yellow-500 font-mono font-bold text-sm" }, user.coins.toLocaleString()))
        );

        const SidebarBtn = ({ icon: Icon, label, onClick, active }) => React.createElement('button', { onClick, className: `w-full flex items-center gap-4 p-3 rounded-xl transition-all active:scale-95 ${active ? 'bg-gradient-to-r from-yellow-500 to-yellow-600 text-black font-bold shadow-lg shadow-yellow-500/20' : 'text-gray-400 hover:bg-white/5 hover:text-white'}` }, React.createElement(Icon, { size: 20 }), React.createElement('span', {}, label));

        // --- SCREENS ---
        function HomeScreen({ user, navTo }) {
            const isPending = user.status === 'pending';
            return React.createElement('div', { className: "space-y-6 animate-pop" },
                // Card
                React.createElement('div', { className: "relative aspect-[1.58/1] w-full rounded-2xl overflow-hidden shadow-2xl group border border-yellow-500/20" },
                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-br from-[#1a1a1a] via-[#050505] to-[#000]" }),
                    React.createElement('div', { className: "absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]" }),
                    React.createElement('div', { className: "absolute -top-32 -right-32 w-64 h-64 bg-yellow-500/10 blur-[80px] rounded-full animate-pulse" }),
                    React.createElement('div', { className: "relative z-10 h-full p-6 flex flex-col justify-between" },
                        React.createElement('div', { className: "flex justify-between items-start" },
                            React.createElement('div', {}, React.createElement('div', { className: "text-yellow-500 font-bold text-xl tracking-[0.2em] flex items-center gap-2" }, "CD0777", React.createElement(ShieldCheck,{size:16})), React.createElement('div', { className: "text-[8px] text-gray-500 uppercase tracking-widest bg-black/50 px-2 py-0.5 rounded-full" }, "Premium")),
                            React.createElement('div', { className: "w-12 h-9 bg-gradient-to-br from-yellow-400 to-yellow-700 rounded-md opacity-90 shadow-inner flex items-center justify-center border border-white/20" }, React.createElement('div', { className: "w-full h-[1px] bg-black/30" }))
                        ),
                        React.createElement('div', { className: "pl-1" }, React.createElement('p', { className: "text-gray-500 text-[8px] uppercase tracking-widest" }, "Balance"), React.createElement('p', { className: "font-mono text-4xl text-white tracking-widest drop-shadow-lg flex items-center gap-1" }, React.createElement('span', { className: "text-yellow-500 text-2xl" }, "$"), user.balance.toFixed(2))),
                        React.createElement('div', { className: "flex justify-between items-end" },
                            React.createElement('div', {}, React.createElement('p', { className: "text-[7px] text-yellow-600 uppercase mb-0.5" }, "HOLDER"), React.createElement('p', { className: "font-mono text-gray-200 text-sm tracking-wide uppercase" }, user.fullName)),
                            React.createElement('div', { className: "text-right" }, React.createElement('p', { className: "text-[7px] text-yellow-600 uppercase mb-0.5" }, "ID"), React.createElement('p', { className: "font-mono text-white text-lg tracking-widest" }, user.memberId))
                        )
                    )
                ),
                // AI Oracle Btn
                React.createElement('button', { onClick: ()=>navTo('oracle'), className: "w-full bg-gradient-to-r from-purple-900 to-indigo-900 p-4 rounded-2xl border border-purple-500/30 flex items-center justify-between group active:scale-95" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                        React.createElement('div', { className: "w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-300 animate-pulse" }, React.createElement(Sparkles, { size: 24 })),
                        React.createElement('div', { className: "text-right" }, React.createElement('h3', { className: "font-bold text-white" }, "العراف الذكي ✨"), React.createElement('p', { className: "text-[10px] text-purple-300" }, "اسأل الذكاء الاصطناعي عن حظك"))
                    ),
                    React.createElement(ChevronRight, { className: "text-purple-500" })
                ),
                isPending && React.createElement('div', { className: "space-y-2" },
                    React.createElement('button', { onClick: ()=>window.open(LINKS.ONEXBET), className: "w-full bg-[#1a2b3c] p-3 rounded-xl flex items-center gap-3 border border-[#2c4a68] hover:border-yellow-500 transition-all active:scale-95" }, React.createElement('div', { className: "w-10 h-10 bg-white rounded flex items-center justify-center font-black text-[#1a2b3c] text-xs shadow-lg" }, "1X"), React.createElement('div', { className: "text-right flex-1" }, React.createElement('div', { className: "font-bold text-white text-xs" }, "اربط مع 1XBET"), React.createElement('div', { className: "text-[10px] text-blue-300" }, "الكود: CD0777")), React.createElement(ExternalLink, { size: 16, className: "text-gray-500" })),
                    React.createElement('button', { onClick: ()=>window.open(LINKS.TELEGRAM), className: "w-full bg-[#1c2732] p-3 rounded-xl flex items-center gap-3 border border-[#229ED9]/30 hover:border-yellow-500 transition-all active:scale-95" }, React.createElement('div', { className: "w-10 h-10 bg-[#229ED9] rounded flex items-center justify-center text-white shadow-lg" }, React.createElement(Send, { size: 16 })), React.createElement('div', { className: "text-right flex-1" }, React.createElement('div', { className: "font-bold text-white text-xs" }, "قناة التليجرام"), React.createElement('div', { className: "text-[10px] text-gray-400" }, "تابع التوصيات")), React.createElement(ExternalLink, { size: 16, className: "text-gray-500" }))
                ),
                React.createElement('button', { onClick: ()=>navTo('casino'), className: "w-full h-24 relative rounded-2xl overflow-hidden group active:scale-95 border border-white/5 hover:border-yellow-500/50" },
                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-r from-purple-900/60 to-indigo-900/60" }),
                    React.createElement('div', { className: "absolute inset-0 flex items-center justify-between p-6" },
                        React.createElement('div', {}, React.createElement('h3', { className: "text-xl font-black italic text-white" }, "PLAY & WIN"), React.createElement('p', { className: "text-[10px] text-purple-200" }, "ادخل الكازينو الآن")),
                        React.createElement(Gamepad2, { size: 40, className: "text-white/20 group-hover:text-white/60" })
                    )
                )
            );
        }

        // --- ORACLE ---
        function OracleScreen({ user, back }) {
            const [res, setRes] = useState(""); const [load, setLoad] = useState(false);
            const ask = async () => { if(load)return; setLoad(true); setRes(""); try{ const r=await askGemini(`المستخدم ${user.fullName} (${user.memberId})، رصيد ${user.coins}. توقع حظ غامض وقصير.`, "أنت عراف كازينو غامض."); setRes(r); }catch{ setRes("النجوم صامتة..."); } setLoad(false); };
            return React.createElement('div', { className: "fixed inset-0 bg-black z-50 flex flex-col" },
                React.createElement('div', { className: "flex justify-between items-center p-4 bg-zinc-900 border-b border-purple-500/20" }, React.createElement('button',{onClick:back,className:"text-zinc-400"},React.createElement(ChevronRight)), React.createElement('span',{className:"font-bold text-purple-400 flex gap-2"},React.createElement(Sparkles), "العراف"), React.createElement('div',{className:"w-6"})),
                React.createElement('div', { className: "flex-1 p-6 flex flex-col items-center justify-center space-y-8 bg-[radial-gradient(circle_at_center,_#3b0764_0%,_#000000_100%)]" },
                    React.createElement('div', { className: `w-32 h-32 rounded-full border-4 border-purple-500 flex items-center justify-center shadow-[0_0_50px_#a855f7] ${load?'animate-spin border-t-transparent':'animate-bounce'}` }, React.createElement(BrainCircuit, { size: 64, className: "text-purple-300" })),
                    React.createElement('div', { className: "w-full bg-black/50 border border-purple-500/30 p-6 rounded-2xl min-h-[100px] text-center flex items-center justify-center" }, load ? React.createElement('p',{className:"text-purple-400 animate-pulse"},"جاري الاتصال...") : (res ? React.createElement('p',{className:"text-white font-bold typing-effect"},res) : React.createElement('p',{className:"text-zinc-500 text-sm"},"اضغط لكشف الحظ"))),
                    React.createElement(Button, { onClick:ask, variant:'ai', full:true, disabled:load }, load?"...":"اكشف حظي")
                )
            );
        }

        // --- CASINO ---
        function CasinoScreen({ navTo }) {
            return React.createElement('div', { className: "space-y-4 animate-pop" },
                React.createElement('h2', { className: "text-yellow-500 font-bold text-lg flex gap-2" }, React.createElement(Dices), "صالة الألعاب"),
                React.createElement('div', { className: "grid gap-4" },
                    React.createElement(GameCard, { title:"CRASH", sub:"ROCKET • 1000x", color:"red", icon:Zap, onClick:()=>navTo('game-crash') }),
                    React.createElement(GameCard, { title:"PLINKO", sub:"DROP • HIGH RISK", color:"purple", icon:Gem, onClick:()=>navTo('game-plinko') })
                )
            );
        }
        const GameCard = ({ title, sub, color, icon: Icon, onClick }) => React.createElement('button', { onClick, className: `relative h-40 rounded-2xl overflow-hidden border border-white/5 bg-zinc-900 hover:border-${color}-500/50 transition-all group w-full text-right active:scale-95 shadow-lg` }, React.createElement('div', { className: `absolute inset-0 bg-gradient-to-t from-${color}-900/80 to-transparent` }), React.createElement('div', { className: `absolute top-4 left-4 text-${color}-500/20 group-hover:text-${color}-500/40 transition-colors transform group-hover:scale-110 duration-500` }, React.createElement(Icon, { size: 80 })), React.createElement('div', { className: "absolute bottom-4 right-4 z-10" }, React.createElement('h3', { className: "text-3xl font-black text-white italic drop-shadow-md" }, title), React.createElement('p', { className: `text-xs text-${color}-300 font-bold uppercase tracking-widest` }, sub)));

        // --- TASKS ---
        function TasksScreen({ user, syncUser, showNotify }) {
            const [tasks, setTasks] = useState([]);
            useEffect(() => { if(db) onSnapshot(collection(db, "tasks"), s => setTasks(s.docs.map(d=>({id:d.id, ...d.data()})))); }, []);
            const handleTask = (t) => { window.open(t.url, '_blank'); setTimeout(async () => { if(!db)return; const comp = user.completedTasks || []; if(!comp.includes(t.id)) { await updateDoc(doc(db,"users",user.id),{coins:user.coins+Number(t.reward),completedTasks:[...comp,t.id]}); showNotify(`+${t.reward} C`); } }, 3000); };
            const comp = user.completedTasks || [];
            return React.createElement('div', { className: "space-y-4" }, React.createElement('h2', { className: "text-yellow-500 font-bold text-lg" }, "المهام اليومية"), tasks.map(t => { const isDone = comp.includes(t.id); return React.createElement('div', { key: t.id, className: `bg-[#111] border p-4 rounded-xl flex justify-between items-center ${isDone?'border-white/5 opacity-50':'border-yellow-500/30'}` }, React.createElement('div', { className: "flex items-center gap-3" }, React.createElement('div', { className: "w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-xl" }, t.icon==='IG'?React.createElement(Instagram):React.createElement(Facebook)), React.createElement('div', {}, React.createElement('div', { className: "font-bold text-sm" }, t.title), React.createElement('div', { className: "text-xs text-yellow-500" }, `+${t.reward} C`))), isDone ? React.createElement('span', { className: "text-green-500 text-xs font-bold bg-green-900/10 px-3 py-1 rounded-lg" }, "تم") : React.createElement('button', { onClick: ()=>handleTask(t), className: "bg-yellow-500 text-black px-4 py-2 rounded-lg text-xs font-bold active:scale-95" }, "تنفيذ")); }));
        }

        // --- PROFILE ---
        function ProfileScreen({ user, syncUser, showMsg }) {
            const [mod, setMod] = useState(false); const [method, setMethod] = useState(''); const [val1, setVal1] = useState(''); const [val2, setVal2] = useState('IAM'); const [convAmt, setConvAmt] = useState('');
            const convert = async () => { if(user.status!=='active') return showMsg('غير مفعل','error'); const amt=parseInt(convAmt); if(!amt||amt<1000) return showMsg('الحد 1000','error'); if(user.coins<amt) return showMsg('رصيد غير كافي','error'); const d=Math.floor(amt/1000); await updateDoc(doc(db,"users",user.id),{coins:user.coins-(d*1000),balance:user.balance+d}); setConvAmt(''); showMsg('تم التحويل'); };
            const withdraw = async () => { if(!val1) return showMsg('بيانات ناقصة','error'); let det = val1; if(method==='Mobile') det=`${val1} | ${val2}`; await addDoc(collection(db,"withdrawals"),{userId:user.id, userName:user.fullName, memberId:user.memberId, amount:user.balance, method, details:det, status:'pending', date:new Date().toLocaleDateString()}); await updateDoc(doc(db,"users",user.id),{balance:0}); setMod(false); showMsg('تم الطلب'); };
            return React.createElement('div', { className: "space-y-6" },
                React.createElement('div', { className: "bg-gradient-to-br from-zinc-900 to-black p-6 rounded-2xl border border-white/10 text-center shadow-lg" }, React.createElement('div', { className: "text-xs text-zinc-500 uppercase tracking-widest" }, "الرصيد"), React.createElement('div', { className: "text-5xl font-mono font-bold text-yellow-500 gold-glow" }, `$${user.balance.toFixed(2)}`)),
                React.createElement('div', { className: "bg-zinc-900 p-4 rounded-2xl border border-white/5" }, React.createElement('h3', { className: "text-sm font-bold text-white mb-2 flex items-center gap-2" }, React.createElement(RefreshCw, {size:14}), "تحويل النقاط"), React.createElement('div', { className: "flex gap-2 mb-1" }, React.createElement('input', { type: "number", placeholder: "النقاط", value: convAmt, onChange: e=>setConvAmt(e.target.value), className: "bg-black border border-white/10 rounded-lg p-2 flex-1 text-white text-center outline-none" }), React.createElement('button', { onClick: convert, className: "bg-yellow-500 text-black font-bold px-4 rounded-lg text-xs active:scale-95" }, "تحويل")), React.createElement('p', { className: "text-[9px] text-zinc-500 text-center" }, "1000 = $1")),
                React.createElement('div', { className: "space-y-2" }, ['1XBET','Mobile Recharge','PayPal'].map(m => React.createElement('button', { key: m, disabled: user.status!=='active', onClick: ()=>{setMethod(m);setMod(true);setVal1('');}, className: "w-full flex justify-between p-4 bg-[#111] border border-white/5 rounded-xl disabled:opacity-50 active:scale-95 transition-transform hover:border-yellow-500/30" }, React.createElement('span', { className: "font-bold text-white" }, m), user.status==='active'?React.createElement(ChevronRight,{size:16}):React.createElement(Lock,{size:16,className:"text-red-500"})))),
                mod && React.createElement('div', { className: "fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-6 animate-in fade-in" }, React.createElement('div', { className: "w-full bg-[#111] p-6 rounded-2xl space-y-4 border border-white/10 shadow-2xl" }, React.createElement('h3', { className: "text-yellow-500 font-bold text-lg" }, `سحب عبر ${method}`), React.createElement(Input, { placeholder: method==='Mobile'?'رقم الهاتف':'البيانات', value: val1, onChange: e=>setVal1(e.target.value) }), method==='Mobile' && React.createElement('select', { value: val2, onChange: e=>setVal2(e.target.value), className: "w-full bg-zinc-950 p-3 rounded-xl border border-white/10 text-white" }, React.createElement('option',{value:"IAM"},"IAM"), React.createElement('option',{value:"Orange"},"Orange"), React.createElement('option',{value:"Inwi"},"Inwi")), React.createElement('div', { className: "flex gap-2" }, React.createElement(Button, { full: true, onClick: withdraw }, "تأكيد"), React.createElement('button', { onClick: ()=>setMod(false), className: "w-full py-3 bg-white/5 rounded-xl text-xs active:scale-95" }, "إلغاء"))))
            );
        }

        // --- AUTH & ADMIN ---
        function AuthScreen({ onLogin, showMsg }) {
            const [isReg, setIsReg] = useState(false); const [f, setF] = useState({u:'', p:'', n:'', ph:''}); const [loading, setLoading] = useState(false);
            const submit = async () => {
                if(!f.u || !f.p) return showMsg('البيانات ناقصة', 'error');
                if(f.u==='admin' && f.p==='admin123') { localStorage.setItem('cd0777_uid', 'admin'); onLogin({role:'admin'}); return; }
                if(!db) return showMsg('خطأ قاعدة بيانات', 'error');
                setLoading(true);
                try {
                    if(isReg) {
                        const q = query(collection(db, "users"), where("username", "==", f.u)); if(!(await getDocs(q)).empty) throw new Error('موجود مسبقاً');
                        const sz = (await getDocs(collection(db, "users"))).size;
                        const nu = { username: f.u, password: f.p, fullName: f.n, phone: f.ph, memberId: `CD${1001+sz}`, role: 'user', status: 'pending', coins: 100, balance: 0, completedTasks: [] };
                        const ref = await addDoc(collection(db, "users"), nu); localStorage.setItem('cd0777_uid', ref.id); onLogin({id:ref.id, ...nu});
                    } else {
                        const q = query(collection(db, "users"), where("username", "==", f.u), where("password", "==", f.p)); const s = await getDocs(q);
                        if(s.empty) throw new Error('خطأ'); const d=s.docs[0]; localStorage.setItem('cd0777_uid', d.id); onLogin({id:d.id, ...d.data()});
                    }
                } catch(e) { showMsg(e.message, 'error'); } setLoading(false);
            };
            return React.createElement('div', { className: "min-h-screen flex flex-col items-center justify-center p-6 bg-black" }, React.createElement('div', { className: "w-24 h-24 rounded-2xl bg-gradient-to-tr from-yellow-400 to-yellow-600 flex items-center justify-center text-4xl font-black text-black mb-8 shadow-2xl" }, "CD"), React.createElement('div', { className: "w-full max-w-sm space-y-4" }, isReg && React.createElement(Input, { placeholder: "الاسم", value: f.n, onChange: e=>setF({...f,n:e.target.value}) }), isReg && React.createElement(Input, { placeholder: "الهاتف", value: f.ph, onChange: e=>setF({...f,ph:e.target.value}) }), React.createElement(Input, { placeholder: "User", value: f.u, onChange: e=>setF({...f,u:e.target.value}) }), React.createElement(Input, { type: "password", placeholder: "Pass", value: f.p, onChange: e=>setF({...f,p:e.target.value}) }), React.createElement(Button, { full: true, onClick: submit, disabled: loading }, loading?'...':(isReg?'تسجيل':'دخول')), React.createElement('button', { onClick: ()=>setIsReg(!isReg), className: "w-full text-center text-xs text-zinc-500" }, isReg?'لديك حساب؟':'حساب جديد')));
        }

        function AdminPanel({ user, logout }) {
            const [tab, setTab] = useState('users'); const [data, setData] = useState({u:[], w:[], t:[]});
            useEffect(() => { if(!db) return; const u1 = onSnapshot(collection(db,"users"), s=>setData(p=>({...p, u:s.docs.map(d=>({id:d.id,...d.data()})).filter(x=>x.role!=='admin')}))); const u2 = onSnapshot(collection(db,"withdrawals"), s=>setData(p=>({...p, w:s.docs.map(d=>({id:d.id,...d.data()}))}))); const u3 = onSnapshot(collection(db,"tasks"), s=>setData(p=>({...p, t:s.docs.map(d=>({id:d.id,...d.data()}))}))); return ()=>{u1();u2();u3();}; }, []);
            const toggleUser = async (u) => await updateDoc(doc(db,"users",u.id),{status:u.status==='active'?'pending':'active'});
            const pay = async (id) => await updateDoc(doc(db,"withdrawals",id),{status:'paid'});
            return React.createElement('div', { className: "min-h-screen bg-zinc-950 p-4 text-xs space-y-4" }, React.createElement('div', { className: "flex justify-between items-center" }, React.createElement('h1', { className: "text-lg text-yellow-500 font-bold" }, "ADMIN"), React.createElement('button', { onClick: logout, className: "text-red-500 border border-red-900 px-3 py-1 rounded" }, "Exit")), React.createElement('div', { className: "flex gap-2" }, ['users','withdrawals'].map(t=>React.createElement('button',{key:t, onClick:()=>setTab(t), className:`flex-1 py-2 rounded border capitalize ${tab===t?'bg-yellow-500 text-black border-yellow-500':'bg-zinc-900 border-white/10 text-gray-500'}`},t))), tab==='users' && data.u.map(u => React.createElement('div', { key: u.id, className: "bg-zinc-900 p-3 rounded flex justify-between items-center border border-white/5" }, React.createElement('div', {}, React.createElement('div', { className: "text-yellow-500 font-bold" }, u.memberId), React.createElement('div', { className: "text-zinc-400" }, u.fullName)), React.createElement('button', { onClick: ()=>toggleUser(u), className: `px-3 py-1 rounded font-bold ${u.status==='active'?'bg-red-900/20 text-red-500':'bg-green-900/20 text-green-500'}` }, u.status==='active'?'تجميد':'تفعيل'))), tab==='withdrawals' && data.w.map(w => React.createElement('div', { key: w.id, className: "bg-zinc-900 p-3 rounded space-y-2 border border-white/5" }, React.createElement('div', { className: "flex justify-between" }, React.createElement('span', { className: "font-bold" }, w.userName), React.createElement('span', { className: "text-yellow-500" }, `$${w.amount}`)), React.createElement('div', { className: "bg-black p-2 rounded text-zinc-400 font-mono" }, `${w.method}: ${w.details}`), w.status==='pending' ? React.createElement(Button, { full: true, variant: "green", onClick: ()=>pay(w.id) }, "تأكيد الدفع") : React.createElement('div', { className: "text-center text-green-500 font-bold" }, "تم الدفع"))));
        }

        // --- GAMES (Placeholders for brevity in preview, copy full logic from above) ---
        function CrashGame({ user, back }) { return React.createElement('div',{className:"p-10 text-white"},"لعبة Crash (كما في الكود السابق) ",React.createElement('button',{onClick:back,className:"text-red-500"},"رجوع")); }
        function PlinkoGame({ user, back }) { return React.createElement('div',{className:"p-10 text-white"},"لعبة Plinko (كما في الكود السابق) ",React.createElement('button',{onClick:back,className:"text-red-500"},"رجوع")); }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
